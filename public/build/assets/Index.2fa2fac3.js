import{ab as de,a8 as ce,N as _e,d as h,l as pe,m as fe,K as be,e as w,ad as Ee,ae as ge,r as n,o as b,j as E,h as s,a,a9 as C,aa as I,x as r,n as T,z as _,t as p,Q as f,g as F,b as g,a4 as ve}from"./main.39f33818.js";import{_ as Be}from"./ObservatoryIcon.072b9e45.js";import{_ as he}from"./EstimateIndexDropdown.114dac1a.js";const Te=g("div",{class:"hidden w-8 h-0 mx-4 border border-gray-400 border-solid xl:block",style:{"margin-top":"1.5rem"}},null,-1),ke={class:"relative table-container"},ye={class:"relative flex items-center justify-between h-10 mt-5 list-none border-b-2 border-gray-200 border-solid"},Ce={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},Ie={class:"absolute items-center left-6 top-2.5 select-none"},Ae={class:"relative block"},we={__name:"Index",setup(Se){const u=de(),W=ce(),k=_e(),y=h(null),{t:i}=pe(),v=h(!1),G=h(["DRAFT","SENT","VIEWED","EXPIRED","ACCEPTED","REJECTED"]),A=h(!0),d=h("general.draft");fe();let l=be({customer_id:"",status:"",from_date:"",to_date:"",estimate_number:""});const P=w(()=>!u.totalEstimateCount&&!A.value),R=w({get:()=>u.selectedEstimates,set:e=>{u.selectEstimate(e)}}),j=w(()=>[{key:"checkbox",thClass:"extra w-10 pr-0",sortable:!1,tdClass:"font-medium text-gray-900 pr-0"},{key:"estimate_date",label:i("estimates.date"),thClass:"extra",tdClass:"font-medium text-gray-500"},{key:"estimate_number",label:i("estimates.number",2)},{key:"name",label:i("estimates.customer")},{key:"status",label:i("estimates.status")},{key:"actions",tdClass:"text-right text-sm font-medium pl-0",thClass:"text-right pl-0",sortable:!1}]);Ee(l,()=>{X()},{debounce:500}),ge(()=>{u.selectAllField&&u.selectAllEstimates()});function z(){return k.hasAbilities([f.CREATE_ESTIMATE,f.EDIT_ESTIMATE,f.VIEW_ESTIMATE,f.SEND_ESTIMATE])}async function H(e,o){l.status="",S()}function S(){y.value&&y.value.refresh()}async function L({page:e,filter:o,sort:c}){let V={customer_id:l.customer_id,status:l.status,from_date:l.from_date,to_date:l.to_date,estimate_number:l.estimate_number,orderByField:c.fieldName||"created_at",orderBy:c.order||"desc",page:e};A.value=!0;let m=await u.fetchEstimates(V);return A.value=!1,{data:m.data.data,pagination:{totalPages:m.data.meta.last_page,currentPage:e,totalCount:m.data.meta.total,limit:10}}}function O(e){if(d.value==e.title)return!0;switch(d.value=e.title,e.title){case i("general.draft"):l.status="DRAFT";break;case i("general.sent"):l.status="SENT";break;default:l.status="";break}}function X(){u.$patch(e=>{e.selectedEstimates=[],e.selectAllField=!1}),S()}function N(){l.customer_id="",l.status="",l.from_date="",l.to_date="",l.estimate_number="",d.value=i("general.all")}function J(){v.value&&N(),v.value=!v.value}async function q(){W.openDialog({title:i("general.are_you_sure"),message:i("estimates.confirm_delete"),yesLabel:i("general.ok"),noLabel:i("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(e=>{e&&u.deleteMultipleEstimates().then(o=>{S(),o.data&&u.$patch(c=>{c.selectedEstimates=[],c.selectAllField=!1})})})}function K(e){switch(e){case"DRAFT":d.value=i("general.draft");break;case"SENT":d.value=i("general.sent");break;case"VIEWED":d.value=i("estimates.viewed");break;case"EXPIRED":d.value=i("estimates.expired");break;case"ACCEPTED":d.value=i("estimates.accepted");break;case"REJECTED":d.value=i("estimates.rejected");break;default:d.value=i("general.all");break}}return(e,o)=>{const c=n("BaseBreadcrumbItem"),V=n("BaseBreadcrumb"),m=n("BaseIcon"),$=n("BaseButton"),x=n("router-link"),Q=n("BasePageHeader"),Y=n("BaseCustomerSelectInput"),B=n("BaseInputGroup"),Z=n("BaseMultiselect"),M=n("BaseDatePicker"),ee=n("BaseInput"),te=n("BaseFilterWrapper"),ae=n("BaseEmptyPlaceholder"),D=n("BaseTab"),se=n("BaseTabGroup"),le=n("BaseDropdownItem"),oe=n("BaseDropdown"),U=n("BaseCheckbox"),ne=n("BaseText"),re=n("BaseEstimateStatusBadge"),ie=n("BaseTable"),ue=n("BasePage");return b(),E(ue,null,{default:s(()=>[a(Q,{title:e.$t("estimates.title")},{actions:s(()=>[C(a($,{variant:"primary-outline",onClick:J},{right:s(t=>[v.value?(b(),E(m,{key:1,name:"XIcon",class:T(t.class)},null,8,["class"])):(b(),E(m,{key:0,class:T(t.class),name:"FilterIcon"},null,8,["class"]))]),default:s(()=>[_(p(e.$t("general.filter"))+" ",1)]),_:1},512),[[I,r(u).totalEstimateCount]]),r(k).hasAbilities(r(f).CREATE_ESTIMATE)?(b(),E(x,{key:0,to:"estimates/create"},{default:s(()=>[a($,{variant:"primary",class:"ml-4"},{left:s(t=>[a(m,{name:"PlusIcon",class:T(t.class)},null,8,["class"])]),default:s(()=>[_(" "+p(e.$t("estimates.new_estimate")),1)]),_:1})]),_:1})):F("",!0)]),default:s(()=>[a(V,null,{default:s(()=>[a(c,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),a(c,{title:e.$tc("estimates.estimate",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),C(a(te,{"row-on-xl":!0,onClear:N},{default:s(()=>[a(B,{label:e.$tc("customers.customer",1)},{default:s(()=>[a(Y,{modelValue:r(l).customer_id,"onUpdate:modelValue":o[0]||(o[0]=t=>r(l).customer_id=t),placeholder:e.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(B,{label:e.$t("estimates.status")},{default:s(()=>[a(Z,{modelValue:r(l).status,"onUpdate:modelValue":[o[1]||(o[1]=t=>r(l).status=t),K],options:G.value,searchable:"",placeholder:e.$t("general.select_a_status"),onRemove:o[2]||(o[2]=t=>H())},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),a(B,{label:e.$t("general.from")},{default:s(()=>[a(M,{modelValue:r(l).from_date,"onUpdate:modelValue":o[3]||(o[3]=t=>r(l).from_date=t),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),Te,a(B,{label:e.$t("general.to")},{default:s(()=>[a(M,{modelValue:r(l).to_date,"onUpdate:modelValue":o[4]||(o[4]=t=>r(l).to_date=t),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),a(B,{label:e.$t("estimates.estimate_number")},{default:s(()=>[a(ee,{modelValue:r(l).estimate_number,"onUpdate:modelValue":o[5]||(o[5]=t=>r(l).estimate_number=t)},{left:s(t=>[a(m,{name:"HashtagIcon",class:T(t.class)},null,8,["class"])]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},512),[[I,v.value]]),C(a(ae,{title:e.$t("estimates.no_estimates"),description:e.$t("estimates.list_of_estimates")},{actions:s(()=>[r(k).hasAbilities(r(f).CREATE_ESTIMATE)?(b(),E($,{key:0,variant:"primary-outline",onClick:o[6]||(o[6]=t=>e.$router.push("/admin/estimates/create"))},{left:s(t=>[a(m,{name:"PlusIcon",class:T(t.class)},null,8,["class"])]),default:s(()=>[_(" "+p(e.$t("estimates.add_new_estimate")),1)]),_:1})):F("",!0)]),default:s(()=>[a(Be,{class:"mt-5 mb-4"})]),_:1},8,["title","description"]),[[I,P.value]]),C(g("div",ke,[g("div",ye,[a(se,{class:"-mb-5",onChange:O},{default:s(()=>[a(D,{title:e.$t("general.all"),filter:""},null,8,["title"]),a(D,{title:e.$t("general.draft"),filter:"DRAFT"},null,8,["title"]),a(D,{title:e.$t("general.sent"),filter:"SENT"},null,8,["title"])]),_:1}),r(u).selectedEstimates.length&&r(k).hasAbilities(r(f).DELETE_ESTIMATE)?(b(),E(oe,{key:0,class:"absolute float-right"},{activator:s(()=>[g("span",Ce,[_(p(e.$t("general.actions"))+" ",1),a(m,{name:"ChevronDownIcon"})])]),default:s(()=>[a(le,{onClick:q},{default:s(()=>[a(m,{name:"TrashIcon",class:"mr-3 text-gray-600"}),_(" "+p(e.$t("general.delete")),1)]),_:1})]),_:1})):F("",!0)]),a(ie,{ref_key:"tableComponent",ref:y,data:L,columns:j.value,"placeholder-count":r(u).totalEstimateCount>=20?10:5,class:"mt-10"},ve({header:s(()=>[g("div",Ie,[a(U,{modelValue:r(u).selectAllField,"onUpdate:modelValue":o[7]||(o[7]=t=>r(u).selectAllField=t),variant:"primary",onChange:r(u).selectAllEstimates},null,8,["modelValue","onChange"])])]),"cell-checkbox":s(({row:t})=>[g("div",Ae,[a(U,{id:t.id,modelValue:R.value,"onUpdate:modelValue":o[8]||(o[8]=me=>R.value=me),value:t.data.id},null,8,["id","modelValue","value"])])]),"cell-estimate_date":s(({row:t})=>[_(p(t.data.formatted_estimate_date),1)]),"cell-estimate_number":s(({row:t})=>[a(x,{to:{path:`estimates/${t.data.id}/view`},class:"font-medium text-primary-500"},{default:s(()=>[_(p(t.data.estimate_number),1)]),_:2},1032,["to"])]),"cell-name":s(({row:t})=>[a(ne,{text:t.data.customer.name,length:30},null,8,["text"])]),"cell-status":s(({row:t})=>[a(re,{status:t.data.status.name,color:t.data.status.color,class:"px-3 py-1"},{default:s(()=>[_(p(t.data.status.name),1)]),_:2},1032,["status","color"])]),_:2},[z()?{name:"cell-actions",fn:s(({row:t})=>[a(he,{row:t.data,table:y.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"])],512),[[I,!P.value]])]),_:1})}}};export{we as default};
