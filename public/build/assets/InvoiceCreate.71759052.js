var Y=Object.defineProperty,A=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var x=(t,e,a)=>e in t?Y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,L=(t,e)=>{for(var a in e||(e={}))Q.call(e,a)&&x(t,a,e[a]);if(q)for(var a of q(e))W.call(e,a)&&x(t,a,e[a]);return t},T=(t,e)=>A(t,K(e));import{r as l,o as d,e as j,f as o,u as n,w as c,J as X,G as Z,aN as ee,B as C,k as p,L as g,M as w,S as ne,O as te,aP as oe,T as ae,C as ie,l as f,j as V,h as B,t as M,m as se,i as le,U as ce,F as re}from"./vendor.ae2d842a.js";import{i as P,b as ue,m as de,q as me}from"./main.88a58514.js";import{_ as ve,a as ge,b as _e,c as pe,d as fe}from"./SalesTax.e2be5681.js";import{_ as be}from"./ExchangeRateConverter.9ec2bb40.js";/* empty css                                                  */import{_ as Ie}from"./TaxTypeModal.02c4537d.js";import"./DragIcon.b567ebba.js";import"./exchange-rate.8fabf773.js";const ye={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},we={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(t){const e=P();return(a,r)=>{const $=l("BaseCustomerSelectPopup"),u=l("BaseDatePicker"),m=l("BaseInputGroup"),h=l("BaseInput"),b=l("BaseInputGrid");return d(),j("div",ye,[o($,{modelValue:n(e).newInvoice.customer,"onUpdate:modelValue":r[0]||(r[0]=i=>n(e).newInvoice.customer=i),valid:t.v.customer_id,"content-loading":t.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),o(b,{class:"col-span-12 lg:col-span-7"},{default:c(()=>[o(m,{label:a.$t("invoices.invoice_date"),"content-loading":t.isLoading,required:"",error:t.v.invoice_date.$error&&t.v.invoice_date.$errors[0].$message},{default:c(()=>[o(u,{modelValue:n(e).newInvoice.invoice_date,"onUpdate:modelValue":r[1]||(r[1]=i=>n(e).newInvoice.invoice_date=i),"content-loading":t.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(m,{label:a.$t("invoices.due_date"),"content-loading":t.isLoading},{default:c(()=>[o(u,{modelValue:n(e).newInvoice.due_date,"onUpdate:modelValue":r[2]||(r[2]=i=>n(e).newInvoice.due_date=i),"content-loading":t.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),o(m,{label:a.$t("invoices.invoice_number"),"content-loading":t.isLoading,error:t.v.invoice_number.$error&&t.v.invoice_number.$errors[0].$message,required:""},{default:c(()=>[o(h,{modelValue:n(e).newInvoice.invoice_number,"onUpdate:modelValue":r[3]||(r[3]=i=>n(e).newInvoice.invoice_number=i),"content-loading":t.isLoading,onInput:r[4]||(r[4]=i=>t.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(be,{store:n(e),"store-prop":"newInvoice",v:t.v,"is-loading":t.isLoading,"is-edit":t.isEdit,"customer-currency":n(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},Be=["onSubmit"],$e={class:"flex"},he={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},Se=B("div",{class:"relative w-full lg:w-1/2 lg:mr-4"},null,-1),Pe={setup(t){const e=P(),a=ue(),r=de(),$=me(),{t:u}=X();let m=Z(),h=ee();const b="newInvoice";let i=C(!1);C(!1),C(["customer","company","customerCustom","invoice","invoiceCustom"]);let I=p(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),E=p(()=>_.value?u("invoices.edit_invoice"):u("invoices.new_invoice"));const F=p(()=>a.selectedCompanySettings.sales_tax_us_enabled==="YES"&&$.salesTaxUSEnabled);let _=p(()=>m.name==="invoices.edit");const N={invoice_date:{required:g.withMessage(u("validation.required"),w)},reference_number:{maxLength:g.withMessage(u("validation.price_maxlength"),ne(255))},customer_id:{required:g.withMessage(u("validation.required"),w)},invoice_number:{required:g.withMessage(u("validation.required"),w)},exchange_rate:{required:te(function(){return g.withMessage(u("validation.required"),w),e.showExchangeRate}),decimal:g.withMessage(u("validation.valid_exchange_rate"),oe)}},y=ae(N,p(()=>e.newInvoice),{$scope:b});r.resetCustomFields(),y.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(_.value),ie(()=>e.newInvoice.customer,s=>{s&&s.currency?e.newInvoice.selectedCurrency=s.currency:e.newInvoice.selectedCurrency=a.selectedCompanyCurrency});async function U(){if(y.value.$touch(),y.value.$invalid)return!1;i.value=!0;let s=T(L({},e.newInvoice),{sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax});try{const v=await(_.value?e.updateInvoice:e.addInvoice)(s);h.push(`/admin/invoices/${v.data.data.id}/view`)}catch(S){console.error(S)}i.value=!1}return(s,S)=>{const v=l("BaseBreadcrumbItem"),G=l("BaseBreadcrumb"),k=l("BaseButton"),D=l("router-link"),R=l("BaseIcon"),H=l("BasePageHeader"),O=l("BaseScrollPane"),z=l("BasePage");return d(),j(re,null,[o(ve),o(ge),o(Ie),n(F)&&(!n(I)||n(m).query.customer)?(d(),f(_e,{key:0,store:n(e),"is-edit":n(_),"store-prop":"newInvoice",customer:n(e).newInvoice.customer},null,8,["store","is-edit","customer"])):V("",!0),o(z,{class:"relative invoice-create-page"},{default:c(()=>[B("form",{onSubmit:ce(U,["prevent"])},[o(H,{title:n(E)},{actions:c(()=>[s.$route.name==="invoices.edit"?(d(),f(D,{key:0,to:`/invoices/pdf/${n(e).newInvoice.unique_hash}`,target:"_blank"},{default:c(()=>[o(k,{class:"mr-3",variant:"primary-outline",type:"button"},{default:c(()=>[B("span",$e,M(s.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):V("",!0),o(k,{loading:n(i),disabled:n(i),variant:"primary",type:"submit"},{left:c(J=>[n(i)?V("",!0):(d(),f(R,{key:0,name:"SaveIcon",class:se(J.class)},null,8,["class"]))]),default:c(()=>[le(" "+M(s.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:c(()=>[o(G,null,{default:c(()=>[o(v,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),o(v,{title:s.$tc("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),s.$route.name==="invoices.edit"?(d(),f(v,{key:0,title:s.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(d(),f(v,{key:1,title:s.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),o(we,{v:n(y),"is-loading":n(I),"is-edit":n(_)},null,8,["v","is-loading","is-edit"]),o(O,null,{default:c(()=>[o(pe,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(I),"item-validation-scope":b,store:n(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),B("div",he,[Se,o(fe,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(I),store:n(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,Be)]),_:1})],64)}}};export{Pe as default};
