import{as as ne,aw as ae,I as oe,H as se,l as ie,M as re,m as le,N as ue,d as $,e as c,v as me,Q as ce,r as s,o as y,j as h,h as i,a as o,b as E,x as n,aH as M,z as N,t as k,g as A,n as de,w as pe,p as S,q as _e,L as Ie,aj as ge,aI as fe}from"./main.d9f009a5.js";import{_ as ve}from"./ItemUnitModal.e1cd6417.js";const ye={__name:"Create",setup(Be){const{getItemDecimalPrecisionMultiplier:T}=fe,t=ne(),V=ae(),v=oe(),L=se(),{t:d}=ie(),B=re(),q=le(),z=ue(),_=$(!1),b=$(L.selectedCompanySettings.tax_per_item);let r=$(!1);t.$reset(),R();const D=c({get:()=>t.currentItem.price/100,set:e=>{t.currentItem.price=Math.round(e*100)}}),x=c({get:()=>{const e=t.currentItem.precision_price;return parseFloat(e)>0?e/T(M):e},set:e=>{if(parseFloat(e)>0){let a=Math.round(e*T(M)),u=Math.round(e*100);g("precision_price",a),g("price",u)}else g("precision_price",e),g("price",e)}});function g(e,a){t.currentItem[e]=a}const P=c({get:()=>{var e,a;return(a=(e=t==null?void 0:t.currentItem)==null?void 0:e.taxes)==null?void 0:a.map(u=>{if(u)return{...u,tax_type_id:u.id,tax_name:u.name+" ("+u.percent+"%)"}})},set:e=>{t.currentItem.taxes=e}}),f=c(()=>B.name==="items.edit"),w=c(()=>f.value?d("items.edit_item"):d("items.new_item")),F=c(()=>V.taxTypes.map(e=>({...e,tax_type_id:e.id,tax_name:e.name+" ("+e.percent+"%)"}))),G=c(()=>b.value==="YES"),H=c(()=>({currentItem:{name:{required:S.withMessage(d("validation.required"),_e),minLength:S.withMessage(d("validation.name_min_length",{count:3}),Ie(3))},description:{maxLength:S.withMessage(d("validation.description_maxlength"),ge(65e3))}}})),m=me(H,t);async function j(){v.openModal({title:d("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function R(){if(r.value=!0,await t.fetchItemUnits({limit:"all"}),z.hasAbilities(ce.VIEW_TAX_TYPE)&&await V.fetchTaxTypes({limit:"all"}),f.value){let e=B.params.id;await t.fetchItem(e),t.currentItem.tax_per_item===1?b.value="YES":b.value="NO"}r.value=!1}async function Y(){if(m.value.currentItem.$touch(),m.value.currentItem.$invalid)return!1;_.value=!0;try{let a={id:B.params.id,...t.currentItem};t.currentItem&&t.currentItem.taxes&&(a.taxes=t.currentItem.taxes.map(p=>({tax_type_id:p.tax_type_id,amount:D.value*p.percent,percent:p.percent,name:p.name,collective_tax:0}))),await(f.value?t.updateItem:t.addItem)(a),_.value=!1,q.push("/admin/items"),e()}catch{_.value=!1;return}function e(){v.closeModal(),setTimeout(()=>{t.resetCurrentItem(),v.$reset(),m.value.$reset()},300)}}return(e,a)=>{const u=s("BaseBreadcrumbItem"),p=s("BaseBreadcrumb"),O=s("BasePageHeader"),Q=s("BaseInput"),I=s("BaseInputGroup"),W=s("BaseItemMoney"),C=s("BaseIcon"),X=s("BaseSelectAction"),U=s("BaseMultiselect"),J=s("BaseTextarea"),K=s("BaseButton"),Z=s("BaseInputGrid"),ee=s("BaseCard"),te=s("BasePage");return y(),h(te,null,{default:i(()=>[o(O,{title:w.value},{default:i(()=>[o(p,null,{default:i(()=>[o(u,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),o(u,{title:e.$tc("items.item",2),to:"/admin/items"},null,8,["title"]),o(u,{title:w.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),o(ve),E("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:pe(Y,["prevent"])},[o(ee,{class:"w-full"},{default:i(()=>[o(Z,{layout:"one-column"},{default:i(()=>[o(I,{label:e.$t("items.name"),"content-loading":n(r),required:"",error:n(m).currentItem.name.$error&&n(m).currentItem.name.$errors[0].$message},{default:i(()=>[o(Q,{modelValue:n(t).currentItem.name,"onUpdate:modelValue":a[0]||(a[0]=l=>n(t).currentItem.name=l),"content-loading":n(r),invalid:n(m).currentItem.name.$error,onInput:a[1]||(a[1]=l=>n(m).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(I,{label:e.$t("items.price"),"content-loading":n(r)},{default:i(()=>[o(W,{modelValue:x.value,"onUpdate:modelValue":a[2]||(a[2]=l=>x.value=l),"content-loading":n(r),"item-precision":n(M)},null,8,["modelValue","content-loading","item-precision"])]),_:1},8,["label","content-loading"]),o(I,{"content-loading":n(r),label:e.$t("items.unit")},{default:i(()=>[o(U,{modelValue:n(t).currentItem.unit_id,"onUpdate:modelValue":a[3]||(a[3]=l=>n(t).currentItem.unit_id=l),"content-loading":n(r),label:"name",options:n(t).itemUnits,"value-prop":"id",placeholder:e.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:i(()=>[o(X,{onClick:j},{default:i(()=>[o(C,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),N(" "+k(e.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),G.value?(y(),h(I,{key:0,label:e.$t("items.taxes"),"content-loading":n(r)},{default:i(()=>[o(U,{modelValue:P.value,"onUpdate:modelValue":a[4]||(a[4]=l=>P.value=l),"content-loading":n(r),options:F.value,mode:"tags",label:"tax_name",class:"w-full","value-prop":"id","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):A("",!0),o(I,{label:e.$t("items.description"),"content-loading":n(r),error:n(m).currentItem.description.$error&&n(m).currentItem.description.$errors[0].$message},{default:i(()=>[o(J,{modelValue:n(t).currentItem.description,"onUpdate:modelValue":a[5]||(a[5]=l=>n(t).currentItem.description=l),"content-loading":n(r),name:"description",row:2,rows:"2",onInput:a[6]||(a[6]=l=>n(m).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),E("div",null,[o(K,{"content-loading":n(r),type:"submit",loading:_.value},{left:i(l=>[_.value?A("",!0):(y(),h(C,{key:0,name:"SaveIcon",class:de(l.class)},null,8,["class"]))]),default:i(()=>[N(" "+k(f.value?e.$t("items.update_item"):e.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],32)]),_:1})}}};export{ye as default};
