import{I as A,l as j,r as v,o as f,c as q,b as l,z as U,t as w,a as o,h as c,n as z,d as L,N as ie,e as k,x as t,Q as W,j as S,aR as ae,g as N,O as re,aS as se,F as E,i as le,aT as ce,M as J,aU as K,J as ue,K as de,E as Q,f as me,aq as ge,H as ve,ag as fe,ax as ye,ac as pe,u as _e,m as be,p as R,q as P,ah as D,W as Ie,v as we,w as $e}from"./main.39f33818.js";import{_ as he,a as Re,b as qe,c as Be}from"./SalesTax.d8acd53a.js";import{_ as Se}from"./CreateTotal.86f846ae.js";import{_ as xe}from"./ExchangeRateConverter.dc52e7cf.js";import{_ as Ce}from"./CreateCustomFields.cdbea52e.js";import{u as Ve,_ as ke}from"./NoteModal.de8381ff.js";import{_ as Ne}from"./TaxTypeModal.0e6a88a8.js";import"./DragIcon.f997cd14.js";import"./exchange-rate.9aebc4c4.js";import"./payment.f0dc0eff.js";/* empty css                                                  */const Me={class:"flex text-gray-800 font-medium text-sm mb-2"},Pe=l("span",{class:"text-sm text-red-500"}," *",-1),Fe={__name:"SelectTemplateButton",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(e){const i=e,y=A(),{t:n}=j();function _(){let u="";i.storeProp=="newEstimate"?u=n("estimates.mark_as_default_estimate_template_description"):i.storeProp=="newInvoice"&&(u=n("invoices.mark_as_default_invoice_template_description")),y.openModal({title:n("general.choose_template"),componentName:"SelectTemplate",data:{templates:i.store.templates,store:i.store,storeProp:i.storeProp,isMarkAsDefault:i.isMarkAsDefault,markAsDefaultDescription:u}})}return(u,x)=>{const b=v("BaseIcon"),d=v("BaseButton");return f(),q("div",null,[l("label",Me,[U(w(u.$t("general.select_template"))+" ",1),Pe]),o(d,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:_},{right:c(g=>[o(b,{name:"PencilIcon",class:z(g.class)},null,8,["class"])]),default:c(()=>[U(" "+w(e.store[e.storeProp].template_name),1)]),_:1})])}}},Le={class:"w-full"},Te={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},Ue={class:"relative grid bg-white"},Ee={class:"relative p-4"},De={key:0,class:"relative flex flex-col overflow-auto list max-h-36"},Oe=["onClick"],Ae={class:"flex justify-between px-2"},je={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},ze={key:1,class:"flex justify-center p-5 text-gray-400"},Ge={class:"text-base text-gray-500"},He={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},We={__name:"SelectNotePopup",props:{type:{type:String,default:null}},emits:["select"],setup(e,{emit:i}){const y=e,n=i;L(null);const{t:_}=j(),u=L(null),x=A(),b=Ve(),d=ie(),g=k(()=>u.value?b.notes.filter(function(a){return a.name.toLowerCase().indexOf(u.value.toLowerCase())!==-1}):b.notes);async function F(){await b.fetchNotes({filter:{},orderByField:"",orderBy:"",type:y.type?y.type:""})}function B(a,I){n("select",{...b.notes[a]}),u.value=null,I()}function r(){x.openModal({title:_("settings.customization.notes.add_note"),componentName:"NoteModal",size:"lg",data:y.type})}return(a,I)=>{const $=v("BaseIcon"),M=v("BaseInput");return f(),q(E,null,[o(ke),l("div",Le,[o(t(ce),null,{default:c(({isOpen:p})=>[t(d).hasAbilities(t(W).VIEW_NOTE)?(f(),S(t(ae),{key:0,class:z([p?"":"text-opacity-90","flex items-center z-10 font-medium text-primary-400 focus:outline-none focus:border-none"]),onClick:F},{default:c(()=>[o($,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),U(" "+w(a.$t("general.insert_note")),1)]),_:2},1032,["class"])):N("",!0),o(re,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:c(()=>[o(t(se),{class:"absolute z-20 px-4 mt-3 sm:px-0 w-screen max-w-full left-0 top-3"},{default:c(({close:h})=>[l("div",Te,[l("div",Ue,[l("div",Ee,[o(M,{modelValue:u.value,"onUpdate:modelValue":I[0]||(I[0]=C=>u.value=C),placeholder:a.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),g.value.length>0?(f(),q("div",De,[(f(!0),q(E,null,le(g.value,(C,s)=>(f(),q("div",{key:s,tabindex:"2",class:"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0",onClick:G=>B(s,h)},[l("div",Ae,[l("label",je,w(C.name),1)])],8,Oe))),128))])):(f(),q("div",ze,[l("label",Ge,w(a.$t("general.no_note_found")),1)]))]),t(d).hasAbilities(t(W).MANAGE_NOTE)?(f(),q("button",{key:0,type:"button",class:"h-10 flex items-center justify-center w-full px-2 py-3 bg-gray-200 border-none outline-none",onClick:r},[o($,{name:"CheckCircleIcon",class:"text-primary-400"}),l("label",He,w(a.$t("settings.customization.notes.add_new_note")),1)])):N("",!0)])]),_:1})]),_:1})]),_:1})])],64)}}},Je={class:"mb-6"},Ke={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},Qe={class:"text-gray-800 font-medium mb-4 text-sm"},Ye={__name:"CreateNotesField",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(e){const i=e;function y(n){i.store[i.storeProp].notes=""+n.notes}return(n,_)=>{const u=v("BaseCustomInput");return f(),q("div",Je,[l("div",Ke,[o(We,{type:e.type,onSelect:y},null,8,["type"])]),l("label",Qe,w(n.$t("invoices.notes")),1),o(u,{modelValue:e.store[e.storeProp].notes,"onUpdate:modelValue":_[0]||(_[0]=x=>e.store[e.storeProp].notes=x),"content-loading":e.store.isFetchingInitialSettings,fields:e.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},Xe={class:"col-span-5 pr-0"},Ze={class:"flex mt-7"},et={class:"relative w-20 mt-8"},tt={class:"ml-2"},nt={class:"p-0 mb-1 leading-snug text-left text-black"},ot={class:"p-0 m-0 text-xs leading-tight text-left text-gray-500",style:{"max-width":"480px"}},it={class:"grid grid-cols-1 col-span-7 gap-4 mt-8 lg:gap-6 lg:mt-0 lg:grid-cols-2"},at={__name:"RecurringInvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(e){const i=e,y=J(),n=K(),_=ue(),u=L(!1),x=de([{label:"None",value:"NONE"},{label:"Date",value:"DATE"},{label:"Count",value:"COUNT"}]),b=k(()=>n.newRecurringInvoice.selectedFrequency&&n.newRecurringInvoice.selectedFrequency.value==="CUSTOM"),d=k(()=>i.isEdit?_.config.recurring_invoice_status.update_status:_.config.recurring_invoice_status.create_status);Q(()=>n.newRecurringInvoice.selectedFrequency,r=>{n.isFetchingInitialSettings||(r&&r.value!=="CUSTOM"?n.newRecurringInvoice.frequency=r.value:n.newRecurringInvoice.frequency=null)}),me(()=>{y.params.id||B()});function g(r){return n.newRecurringInvoice.limit_by===r}const F=ge(()=>{B()},500);async function B(){const r=n.newRecurringInvoice.frequency;if(!r)return;u.value=!0;let a={starts_at:n.newRecurringInvoice.starts_at,frequency:r};try{await n.fetchRecurringInvoiceFrequencyDate(a)}catch(I){console.error(I),u.value=!1}u.value=!1}return(r,a)=>{const I=v("BaseCustomerSelectPopup"),$=v("BaseSwitch"),M=v("BaseDatePicker"),p=v("BaseInputGroup"),h=v("BaseMultiselect"),C=v("BaseInput");return f(),q(E,null,[l("div",Xe,[o(I,{modelValue:t(n).newRecurringInvoice.customer,"onUpdate:modelValue":a[0]||(a[0]=s=>t(n).newRecurringInvoice.customer=s),valid:e.v.customer_id,"content-loading":e.isLoading,type:"recurring-invoice"},null,8,["modelValue","valid","content-loading"]),l("div",Ze,[l("div",et,[o($,{modelValue:t(n).newRecurringInvoice.send_automatically,"onUpdate:modelValue":a[1]||(a[1]=s=>t(n).newRecurringInvoice.send_automatically=s),class:"absolute -top-4"},null,8,["modelValue"])]),l("div",tt,[l("p",nt,w(r.$t("recurring_invoices.send_automatically")),1),l("p",ot,w(r.$t("recurring_invoices.send_automatically_desc")),1)])])]),l("div",it,[o(p,{label:r.$t("recurring_invoices.starts_at"),"content-loading":e.isLoading,required:"",error:e.v.starts_at.$error&&e.v.starts_at.$errors[0].$message},{default:c(()=>[o(M,{modelValue:t(n).newRecurringInvoice.starts_at,"onUpdate:modelValue":a[2]||(a[2]=s=>t(n).newRecurringInvoice.starts_at=s),"content-loading":e.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:e.v.starts_at.$error,onChange:a[3]||(a[3]=s=>B())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(p,{label:r.$t("recurring_invoices.next_invoice_date"),"content-loading":e.isLoading,required:""},{default:c(()=>[o(M,{modelValue:t(n).newRecurringInvoice.next_invoice_at,"onUpdate:modelValue":a[4]||(a[4]=s=>t(n).newRecurringInvoice.next_invoice_at=s),"content-loading":e.isLoading,"calendar-button":!0,disabled:!0,loading:u.value,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","loading"])]),_:1},8,["label","content-loading"]),o(p,{label:r.$t("recurring_invoices.limit_by"),"content-loading":e.isLoading,class:"lg:mt-0",required:"",error:e.v.limit_by.$error&&e.v.limit_by.$errors[0].$message},{default:c(()=>[o(h,{modelValue:t(n).newRecurringInvoice.limit_by,"onUpdate:modelValue":a[5]||(a[5]=s=>t(n).newRecurringInvoice.limit_by=s),"content-loading":e.isLoading,options:x,label:"label",invalid:e.v.limit_by.$error,"value-prop":"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),g("DATE")?(f(),S(p,{key:0,label:r.$t("recurring_invoices.limit_date"),"content-loading":e.isLoading,required:g("DATE"),error:e.v.limit_date.$error&&e.v.limit_date.$errors[0].$message},{default:c(()=>[o(M,{modelValue:t(n).newRecurringInvoice.limit_date,"onUpdate:modelValue":a[6]||(a[6]=s=>t(n).newRecurringInvoice.limit_date=s),"content-loading":e.isLoading,invalid:e.v.limit_date.$error,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):N("",!0),g("COUNT")?(f(),S(p,{key:1,label:r.$t("recurring_invoices.count"),"content-loading":e.isLoading,required:g("COUNT"),error:e.v.limit_count.$error&&e.v.limit_count.$errors[0].$message},{default:c(()=>[o(C,{modelValue:t(n).newRecurringInvoice.limit_count,"onUpdate:modelValue":a[7]||(a[7]=s=>t(n).newRecurringInvoice.limit_count=s),"content-loading":e.isLoading,invalid:e.v.limit_count.$error,type:"number"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):N("",!0),o(p,{label:r.$t("recurring_invoices.status"),required:"","content-loading":e.isLoading,error:e.v.status.$error&&e.v.status.$errors[0].$message},{default:c(()=>[o(h,{modelValue:t(n).newRecurringInvoice.status,"onUpdate:modelValue":a[8]||(a[8]=s=>t(n).newRecurringInvoice.status=s),options:d.value,"content-loading":e.isLoading,invalid:e.v.status.$error,placeholder:r.$t("recurring_invoices.select_a_status"),"value-prop":"value",label:"value"},null,8,["modelValue","options","content-loading","invalid","placeholder"])]),_:1},8,["label","content-loading","error"]),o(p,{label:r.$t("recurring_invoices.frequency.select_frequency"),required:"","content-loading":e.isLoading,error:e.v.selectedFrequency.$error&&e.v.selectedFrequency.$errors[0].$message},{default:c(()=>[o(h,{modelValue:t(n).newRecurringInvoice.selectedFrequency,"onUpdate:modelValue":a[9]||(a[9]=s=>t(n).newRecurringInvoice.selectedFrequency=s),"content-loading":e.isLoading,options:t(n).frequencies,label:"label",invalid:e.v.selectedFrequency.$error,object:"",onChange:B},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),b.value?(f(),S(p,{key:2,label:r.$t("recurring_invoices.frequency.title"),"content-loading":e.isLoading,required:"",error:e.v.frequency.$error&&e.v.frequency.$errors[0].$message},{default:c(()=>[o(C,{modelValue:t(n).newRecurringInvoice.frequency,"onUpdate:modelValue":[a[10]||(a[10]=s=>t(n).newRecurringInvoice.frequency=s),t(F)],"content-loading":e.isLoading,disabled:!b.value,invalid:e.v.frequency.$error,loading:u.value},null,8,["modelValue","content-loading","disabled","invalid","loading","onUpdate:modelValue"])]),_:1},8,["label","content-loading","error"])):N("",!0),o(xe,{store:t(n),"store-prop":"newRecurringInvoice",v:e.v,"is-loading":e.isLoading,"is-edit":e.isEdit,"customer-currency":t(n).newRecurringInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])])],64)}}},rt={class:"flex"},st={class:"grid-cols-12 gap-8 mt-6 mb-8 lg:grid"},lt={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},ct={class:"w-full relative lg:w-1/2"},O="newRecurringInvoice",wt={__name:"RecurringInvoiceCreate",setup(e){const i=K(),y=ve(),n=fe(),_=ye(),u=A(),x=pe(),b=_e(),{t:d}=j();let g=L(!1);const F=L(["customer","company","customerCustom","invoice","invoiceCustom"]);let B=J(),r=be(),a=k(()=>i.isFetchingInvoice||i.isFetchingInitialSettings),I=k(()=>$.value?d("recurring_invoices.edit_invoice"):d("recurring_invoices.new_invoice")),$=k(()=>B.name==="recurring-invoices.edit");const M=k(()=>y.selectedCompanySettings.sales_tax_us_enabled==="YES"&&_.salesTaxUSEnabled),p={starts_at:{required:R.withMessage(d("validation.required"),P)},status:{required:R.withMessage(d("validation.required"),P)},frequency:{required:R.withMessage(d("validation.required"),P)},limit_by:{required:R.withMessage(d("validation.required"),P)},limit_date:{required:R.withMessage(d("validation.required"),D(function(){return i.newRecurringInvoice.limit_by==="DATE"}))},limit_count:{required:R.withMessage(d("validation.required"),D(function(){return i.newRecurringInvoice.limit_by==="COUNT"}))},selectedFrequency:{required:R.withMessage(d("validation.required"),P)},customer_id:{required:R.withMessage(d("validation.required"),P)},exchange_rate:{required:D(function(){return R.withMessage(d("validation.required"),P),i.showExchangeRate}),decimal:R.withMessage(d("validation.valid_exchange_rate"),Ie)}},h=we(p,k(()=>i.newRecurringInvoice),{$scope:O});i.resetCurrentRecurringInvoice(),i.fetchRecurringInvoiceInitialSettings($.value),n.resetCustomFields(),h.value.$reset,Q(()=>i.newRecurringInvoice.customer,m=>{m&&m.currency?i.newRecurringInvoice.currency=m.currency:i.newRecurringInvoice.currency=y.selectedCompanyCurrency});async function C(){if(h.value.$touch(),h.value.$invalid)return!1;g.value=!0;let m={...i.newRecurringInvoice,sub_total:i.getSubTotal,total:i.getTotal,tax:i.getTotalTax};if(m.customer&&!m.customer.email&&m.send_automatically){b.showNotification({type:"error",message:d("recurring_invoices.add_customer_email")}),s(),g.value=!1;return}B.params.id?i.updateRecurringInvoice(m).then(V=>{V.data.data&&r.push(`/admin/recurring-invoices/${V.data.data.id}/view`),g.value=!1}).catch(V=>{g.value=!1}):G(m)}async function s(){let m=i.newRecurringInvoice.customer.id;await x.fetchCustomer(m),u.openModal({title:d("customers.edit_customer"),componentName:"CustomerModal"})}function G(m){i.addRecurringInvoice(m).then(V=>{V.data.data&&r.push(`/admin/recurring-invoices/${V.data.data.id}/view`),g.value=!1}).catch(V=>{g.value=!1})}return(m,V)=>{const T=v("BaseBreadcrumbItem"),Y=v("BaseBreadcrumb"),H=v("BaseButton"),X=v("router-link"),Z=v("BaseIcon"),ee=v("BasePageHeader"),te=v("BaseScrollPane"),ne=v("BasePage");return f(),q(E,null,[o(he),o(Re),o(Ne),M.value&&!t(a)?(f(),S(qe,{key:0,store:t(i),"store-prop":"newRecurringInvoice","is-edit":t($),customer:t(i).newRecurringInvoice.customer},null,8,["store","is-edit","customer"])):N("",!0),o(ne,{class:"relative invoice-create-page"},{default:c(()=>[l("form",{onSubmit:$e(C,["prevent"])},[o(ee,{title:t(I)},{actions:c(()=>[o(X,{to:`/invoices/pdf/${t(i).newRecurringInvoice.unique_hash}`},{default:c(()=>[m.$route.name==="invoices.edit"?(f(),S(H,{key:0,target:"_blank",class:"mr-3",variant:"primary-outline",type:"button"},{default:c(()=>[l("span",rt,w(m.$t("general.view_pdf")),1)]),_:1})):N("",!0)]),_:1},8,["to"]),o(H,{loading:t(g),disabled:t(g),variant:"primary",type:"submit"},{left:c(oe=>[t(g)?N("",!0):(f(),S(Z,{key:0,name:"SaveIcon",class:z(oe.class)},null,8,["class"]))]),default:c(()=>[U(" "+w(m.$t("recurring_invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:c(()=>[o(Y,null,{default:c(()=>[o(T,{title:m.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),o(T,{title:m.$t("recurring_invoices.title",2),to:"/admin/recurring-invoices"},null,8,["title"]),m.$route.name==="invoices.edit"?(f(),S(T,{key:0,title:m.$t("recurring_invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(f(),S(T,{key:1,title:t(I),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),l("div",st,[o(at,{v:t(h),"is-loading":t(a),"is-edit":t($)},null,8,["v","is-loading","is-edit"])]),o(te,null,{default:c(()=>[o(Be,{currency:t(i).newRecurringInvoice.currency,"is-loading":t(a),"item-validation-scope":O,store:t(i),"store-prop":"newRecurringInvoice"},null,8,["currency","is-loading","store"]),l("div",lt,[l("div",ct,[o(Ye,{store:t(i),"store-prop":"newRecurringInvoice",fields:F.value,type:"Invoice"},null,8,["store","fields"]),o(Ce,{type:"Invoice","is-edit":t($),"is-loading":t(a),store:t(i),"store-prop":"newRecurringInvoice","custom-field-scope":O,class:"mb-6"},null,8,["is-edit","is-loading","store"]),o(Fe,{store:t(i),"store-prop":"newRecurringInvoice"},null,8,["store"])]),o(Se,{currency:t(i).newRecurringInvoice.currency,"is-loading":t(a),store:t(i),"store-prop":"newRecurringInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{wt as default};
