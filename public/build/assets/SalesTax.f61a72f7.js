import{H as ne,as as fe,ab as ye,M as Te,l as re,e as u,aH as R,d as F,E as xe,an as J,p as D,q as Y,aJ as _e,aj as oe,ay as Me,v as me,r as S,o as h,c as z,b as s,a as d,x as o,j as k,aL as de,h as v,g as K,z as L,aM as ce,t as T,aI as ge,aN as Ce,ap as ke,F as he,I as ie,N as Ve,i as qe,n as W,aw as ve,u as De,L as Le,f as be,w as $e,J as Ee,K as Ae}from"./main.cc3f84c4.js";import{D as Ue,d as ze}from"./DragIcon.95e14e0e.js";const je={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},Ne={colspan:"5",class:"p-0 text-left align-top pt-2"},Fe={class:"w-full"},Oe=s("colgroup",null,[s("col",{style:{width:"30%","min-width":"280px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}})],-1),Ge={class:"px-2 py-2 text-left align-top"},Xe={class:"flex justify-start"},Re={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},Ye={class:"px-2 py-2 text-right align-top"},He={class:"px-2 py-2 text-left align-top"},Je={class:"flex flex-col"},Ke={class:"flex-auto flex-fill bd-highlight"},Qe={class:"relative w-full"},We={class:"px-2 py-2 text-left align-top"},Ze={class:"flex flex-col"},et={class:"flex-auto flex-fill bd-highlight"},tt={class:"relative w-full"},at={class:"px-2 py-2 text-right align-top"},st={class:"flex items-center justify-end text-sm"},ot={class:"flex items-center justify-center w-6 h-10 mx-2"},nt={class:"px-12 pb-4 text-right"},rt={class:"text-sm pr-6"},it={class:"text-sm pr-6"},lt={class:"text-sm"},dt={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(m,{emit:x}){const{getItemDecimalPrecisionMultiplier:p}=ge,e=m,c=ne(),M=fe(),i=ye();Te();const{t:b}=re(),V=u({get:()=>i.newEstimate.show_price_breakdown}),n=u({get:()=>e.itemData.quantity,set:a=>{X("quantity",parseFloat(a))}});u({get:()=>{const a=e.itemData.price;return parseFloat(a)>0?a/100:a},set:a=>{if(parseFloat(a)>0){let r=Math.round(a*100);X("price",r)}else X("price",a)}});const C=u({get:()=>{const a=e.itemData.precision_price;return parseFloat(a)>0?a/p(R):a},set:a=>{if(parseFloat(a)>0){let r=Math.round(a*p(R)),B=Math.round(a*100);X("precision_price",r),X("price",B)}else X("precision_price",a),X("price",a)}}),q=u({get:()=>I(_)}),A=u({get:()=>I(O)}),E=u({get:()=>I(H)});function I(a){return a.value.toLocaleString("es-MX",{style:"currency",currency:"MXN"})}F(null);const f=F(null),$=F(null),w=F(null),U=u(()=>e.itemData.precision_price*e.itemData.quantity),l=u(()=>e.itemData.precision_price*e.itemData.quantity/p(R)),g=u({get:()=>{var r;let a=(r=f.value)!=null?r:t.value/n.value;return $.value=a,a},set:a=>{t.value=a*n.value,f.value=parseFloat(a)}}),t=u({get:()=>{let a=_.value+O.value+H.value;return w.value=a,a},set:a=>{let r=Math.round((t.value+Number.EPSILON)*100)/100,B=Math.round((parseFloat(a)+Number.EPSILON)*100)/100;r!==B&&y(parseFloat(a))}});function y(a){let r=n.value,B=e.itemData.ieps,N=1.16,se=V.value?(a/r-B)/N+B:(a/r-B)/N;r>0&&se>0&&a>0&&(n.value=r,C.value=se)}const _=u({get:()=>V.value?l.value-H.value:l.value}),H=u({get:()=>e.itemData.quantity*e.itemData.ieps}),O=u({get:()=>_.value*.16});xe(()=>V.value,a=>{console.log($.value,w.value),y(w.value)}),u(()=>l.value-e.itemData.discount_val);const G=u(()=>e.currency?e.currency:c.selectedCompanyCurrency),Z=u(()=>e.store[e.storeProp].items.length!=1),ee=u(()=>Math.round(J.exports.sumBy(e.itemData.taxes,function(a){return a.compound_tax?0:a.amount}))),te=u(()=>Math.round(J.exports.sumBy(e.itemData.taxes,function(a){return a.compound_tax?a.amount:0}))),Q=u(()=>ee.value+te.value),le={name:{required:D.withMessage(b("validation.required"),Y)},quantity:{required:D.withMessage(b("validation.required"),Y),minValue:D.withMessage(b("validation.qty_must_greater_than_zero"),_e(0)),maxLength:D.withMessage(b("validation.amount_maxlength"),oe(20))},price:{required:D.withMessage(b("validation.required"),Y),minValue:D.withMessage(b("validation.number_length_minvalue"),_e(1)),maxLength:D.withMessage(b("validation.price_maxlength"),oe(20))},discount_val:{between:D.withMessage(b("validation.discount_maxlength"),Me(0,u(()=>U.value)))},description:{maxLength:D.withMessage(b("validation.notes_maxlength"),oe(65e3))}},P=me(le,u(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function Ie(a){e.store.$patch(B=>{B[e.storeProp].items[e.index].taxes[a.index]=a.item});let r=e.itemData.taxes[e.itemData.taxes.length-1];(r==null?void 0:r.tax_type_id)!==0&&e.store.$patch(B=>{B[e.storeProp].items[e.index].taxes.push({...Ce,id:ke.raw()})}),ae()}function we(a){X("name",a)}function Se(a){e.store.$patch(r=>{if(r[e.storeProp].items[e.index].name=a.name,r[e.storeProp].items[e.index].price=a.price,r[e.storeProp].items[e.index].item_id=a.id,r[e.storeProp].items[e.index].description=a.description,r[e.storeProp].items[e.index].precision=a.precision,r[e.storeProp].items[e.index].precision_price=a.precision_price,r[e.storeProp].items[e.index].ieps=a.ieps,a.unit&&(r[e.storeProp].items[e.index].unit_name=a.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&a.taxes){let B=0;a.taxes.forEach(N=>{Ie({index:B,item:{...N}}),B++})}r[e.storeProp].exchange_rate&&(r[e.storeProp].items[e.index].price/=r[e.storeProp].exchange_rate)}),M.fetchItems(),ae()}function ae(){var B,N;let a=(N=(B=e.store[e.storeProp])==null?void 0:B.items[e.index])==null?void 0:N.taxes;a||(a=[]);let r={...e.store[e.storeProp].items[e.index],index:e.index,total:t.value,sub_total:U.value,totalSimpleTax:ee.value,totalCompoundTax:te.value,totalTax:Q.value,tax:Q.value,taxes:[...a]};e.store.updateItem(r)}function X(a,r){e.store.$patch(B=>{B[e.storeProp].items[e.index][a]=r}),ae()}return(a,r)=>{const B=S("BaseItemSelect"),N=S("BaseInput"),se=S("BaseContentPlaceholdersText"),Be=S("BaseContentPlaceholders"),Pe=S("BaseIcon");return h(),z("tr",je,[s("td",Ne,[s("table",Fe,[Oe,s("tbody",null,[s("tr",null,[s("td",Ge,[s("div",Xe,[s("div",Re,[d(Ue)]),d(B,{type:"Invoice",item:m.itemData,invalid:o(P).name.$error,"invalid-description":o(P).description.$error,taxes:m.itemData.taxes,index:m.index,"store-prop":m.storeProp,store:m.store,onSearch:we,onSelect:Se},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),s("td",Ye,[d(N,{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=j=>n.value=j),invalid:o(P).quantity.$error,"content-loading":m.loading,type:"number",small:"",min:"0",step:"any",onChange:r[1]||(r[1]=j=>ae()),onInput:r[2]||(r[2]=j=>o(P).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),s("td",He,[s("div",Je,[s("div",Ke,[s("div",Qe,[(h(),k(de,{key:G.value,modelValue:C.value,"onUpdate:modelValue":r[3]||(r[3]=j=>C.value=j),invalid:o(P).price.$error,"content-loading":m.loading,currency:G.value,"item-precision":o(R)},null,8,["modelValue","invalid","content-loading","currency","item-precision"]))])])])]),s("td",We,[s("div",Ze,[s("div",et,[s("div",tt,[(h(),k(de,{key:G.value,modelValue:g.value,"onUpdate:modelValue":r[4]||(r[4]=j=>g.value=j),invalid:o(P).price.$error,"content-loading":m.loading,currency:G.value,"item-precision":o(R)},null,8,["modelValue","invalid","content-loading","currency","item-precision"]))])])])]),s("td",at,[s("div",st,[s("span",null,[m.loading?(h(),k(Be,{key:0},{default:v(()=>[d(se,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),k(de,{key:G.value,modelValue:t.value,"onUpdate:modelValue":r[5]||(r[5]=j=>t.value=j),currency:G.value,"item-precision":2},null,8,["modelValue","currency"]))]),s("div",ot,[Z.value?(h(),k(Pe,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:r[6]||(r[6]=j=>m.store.removeItem(m.index))})):K("",!0)])])])])])]),s("div",nt,[d(ce,null,{default:v(()=>[L("Monto Base:")]),_:1}),L(),s("span",rt,T(q.value),1),d(ce,null,{default:v(()=>[L("IEPS:")]),_:1}),L(),s("span",it,T(E.value),1),d(ce,null,{default:v(()=>[L("IVA (16%): ")]),_:1}),L(),s("span",lt,T(A.value),1)])])])}}},ct={class:"text-center item-table min-w-full"},ut=s("colgroup",null,[s("col",{style:{width:"30%","min-width":"280px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}})],-1),pt={class:"bg-white border border-gray-200 border-solid"},mt={class:"px-2 text-sm not-italic font-medium text-left gap-2 text-gray-700 border-t border-b border-gray-200 border-solid"},vt={class:"py-3"},_t={key:1,class:"pl-10"},ft={key:1},yt={key:1},xt={key:1},gt={key:1,class:"pr-10 column-heading"},jt={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(m){const x=m,p=ne(),e=u(()=>x.currency?x.currency:p.selectedCompanyCurrency);return(c,M)=>{const i=S("BaseContentPlaceholdersText"),b=S("BaseContentPlaceholders"),V=S("BaseIcon");return h(),z(he,null,[s("table",ct,[ut,s("thead",pt,[s("tr",mt,[s("th",vt,[m.isLoading?(h(),k(b,{key:0},{default:v(()=>[d(i,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),z("span",_t,T(c.$tc("items.item",2)),1))]),s("th",null,[m.isLoading?(h(),k(b,{key:0},{default:v(()=>[d(i,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),z("span",ft,T(c.$t("invoices.item.quantity")),1))]),s("th",null,[m.isLoading?(h(),k(b,{key:0},{default:v(()=>[d(i,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),z("span",yt,T(c.$t("invoices.item.price")),1))]),s("th",null,[m.isLoading?(h(),k(b,{key:0},{default:v(()=>[d(i,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),z("span",xt," Precio de Venta "))]),s("th",null,[m.isLoading?(h(),k(b,{key:0},{default:v(()=>[d(i,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),z("span",gt,T(c.$t("invoices.item.amount")),1))])])]),d(o(ze),{modelValue:m.store[m.storeProp].items,"onUpdate:modelValue":M[0]||(M[0]=n=>m.store[m.storeProp].items=n),"item-key":"id",tag:"tbody",handle:".handle"},{item:v(({element:n,index:C})=>[(h(),k(dt,{key:n.id,index:C,"item-data":n,loading:m.isLoading,currency:e.value,"item-validation-scope":m.itemValidationScope,"invoice-items":m.store[m.storeProp].items,store:m.store,"store-prop":m.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),s("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:M[1]||(M[1]=(...n)=>m.store.addItem&&m.store.addItem(...n))},[d(V,{name:"PlusCircleIcon",class:"mr-2"}),L(" "+T(c.$t("general.add_new_item")),1)])],64)}}},ht={class:"flex justify-between w-full"},bt={class:"px-8 py-8 sm:p-6"},$t={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},It=["onClick"],wt=["src","alt"],St=["alt","src"],Bt={key:1,class:"z-0 flex ml-3 pt-5"},Pt={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Nt={__name:"SelectTemplateModal",setup(m){const x=ie(),p=Ve(),e=F(""),c=u(()=>x.active&&x.componentName==="SelectTemplate"),M=u(()=>x.title);function i(){x.data.store[x.data.storeProp].template_name?e.value=x.data.store[x.data.storeProp].template_name:e.value=x.data.templates[0]}async function b(){await x.data.store.setTemplate(e.value),!x.data.store.isEdit&&x.data.isMarkAsDefault&&(x.data.storeProp=="newEstimate"?await p.updateUserSettings({settings:{default_estimate_template:e.value}}):x.data.storeProp=="newInvoice"&&await p.updateUserSettings({settings:{default_invoice_template:e.value}})),n()}function V(){return new URL("/img/tick.png",self.location)}function n(){x.closeModal(),setTimeout(()=>{x.$reset()},300)}return(C,q)=>{const A=S("BaseIcon"),E=S("BaseCheckbox"),I=S("BaseButton"),f=S("BaseModal");return h(),k(f,{show:c.value,onClose:n,onOpen:i},{header:v(()=>[s("div",ht,[L(T(M.value)+" ",1),d(A,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:n})])]),default:v(()=>[s("div",bt,[o(x).data?(h(),z("div",$t,[(h(!0),z(he,null,qe(o(x).data.templates,($,w)=>(h(),z("div",{key:w,class:W([{"border border-solid border-primary-500":e.value===$.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:U=>e.value=$.name},[s("img",{src:$.path,alt:$.name,class:"w-full min-h-[100px]"},null,8,wt),e.value===$.name?(h(),z("img",{key:0,alt:$.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:V()},null,8,St)):K("",!0),s("span",{class:W(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":e.value===$.name,"text-gray-600":e.value!=$.name}])},T($.name),3)],10,It))),128))])):K("",!0),o(x).data.store.isEdit?K("",!0):(h(),z("div",Bt,[d(E,{modelValue:o(x).data.isMarkAsDefault,"onUpdate:modelValue":q[0]||(q[0]=$=>o(x).data.isMarkAsDefault=$),"set-initial-value":!1,variant:"primary",label:C.$t("general.mark_as_default"),description:o(x).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),s("div",Pt,[d(I,{class:"mr-3",variant:"primary-outline",onClick:n},{default:v(()=>[L(T(C.$t("general.cancel")),1)]),_:1}),d(I,{variant:"primary",onClick:q[1]||(q[1]=$=>b())},{left:v($=>[d(A,{name:"SaveIcon",class:W($.class)},null,8,["class"])]),default:v(()=>[L(" "+T(C.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},Tt={class:"flex justify-between w-full"},Mt={class:"item-modal"},Ct={class:"px-8 py-8 sm:p-6"},kt={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ft={__name:"ItemModal",emits:["newItem"],setup(m,{emit:x}){const{getItemDecimalPrecisionMultiplier:p}=ge,e=ie(),c=fe(),M=ne(),i=ve();ye(),De();const{t:b}=re(),V=F(!1),n=F(M.selectedCompanySettings.tax_per_item),C=u(()=>e.active&&e.componentName==="ItemModal"),q=(t,y)=>{c.$patch(_=>{_.currentItem[t]=y})},A=u({get:()=>{const t=c.currentItem.price;return parseFloat(t)>0?t/100:t},set:t=>{if(parseFloat(t)>0){let y=Math.round(t*100);q("price",y)}else q("price",t)}}),E=u({get:()=>{const t=c.currentItem.precision_price;return parseFloat(t)>0?t/p(R):t},set:t=>{if(parseFloat(t)>0){let y=Math.round(t*p(R)),_=Math.round(t*100);q("precision_price",y),q("price",_)}else q("precision_price",t),q("price",t)}}),I=u({get:()=>c.currentItem.taxes.map(t=>{if(t)return{...t,tax_type_id:t.id,tax_name:t.name+" ("+t.percent+"%)"}}),set:t=>{c.$patch(y=>{y.currentItem.taxes=t})}}),f=u(()=>n.value==="YES"),$={name:{required:D.withMessage(b("validation.required"),Y),minLength:D.withMessage(b("validation.name_min_length",{count:3}),Le(3))},description:{maxLength:D.withMessage(b("validation.description_maxlength",{count:255}),oe(255))}},w=me($,u(()=>c.currentItem)),U=u(()=>i.taxTypes.map(t=>({...t,tax_name:t.name+" ("+t.percent+"%)"})));be(()=>{w.value.$reset(),c.fetchItemUnits({limit:"all"})});async function l(){if(w.value.$touch(),w.value.$invalid)return!0;let t={...c.currentItem,taxes:c.currentItem.taxes.map(_=>({tax_type_id:_.id,amount:A.value*_.percent,percent:_.percent,name:_.name,collective_tax:0}))};V.value=!0,await(c.isEdit?c.updateItem:c.addItem)(t).then(_=>{V.value=!1,_.data.data&&e.data&&e.refreshData(_.data.data),g()})}function g(){e.closeModal(),setTimeout(()=>{c.resetCurrentItem(),e.$reset(),w.value.$reset()},300)}return(t,y)=>{const _=S("BaseIcon"),H=S("BaseInput"),O=S("BaseInputGroup"),G=S("BaseItemMoney"),Z=S("BaseMultiselect"),ee=S("BaseTextarea"),te=S("BaseInputGrid"),Q=S("BaseButton"),le=S("BaseModal");return h(),k(le,{show:C.value,onClose:g},{header:v(()=>[s("div",Tt,[L(T(o(e).title)+" ",1),d(_,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:g})])]),default:v(()=>[s("div",Mt,[s("form",{action:"",onSubmit:$e(l,["prevent"])},[s("div",Ct,[d(te,{layout:"one-column"},{default:v(()=>[d(O,{label:t.$t("items.name"),required:"",error:o(w).name.$error&&o(w).name.$errors[0].$message},{default:v(()=>[d(H,{modelValue:o(c).currentItem.name,"onUpdate:modelValue":y[0]||(y[0]=P=>o(c).currentItem.name=P),type:"text",invalid:o(w).name.$error,onInput:y[1]||(y[1]=P=>o(w).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),d(O,{label:t.$t("items.price")},{default:v(()=>[(h(),k(G,{key:o(M).selectedCompanyCurrency,modelValue:E.value,"onUpdate:modelValue":y[2]||(y[2]=P=>E.value=P),currency:o(M).selectedCompanyCurrency,"item-precision":o(R),class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency","item-precision"]))]),_:1},8,["label"]),d(O,{label:t.$t("items.unit")},{default:v(()=>[d(Z,{modelValue:o(c).currentItem.unit_id,"onUpdate:modelValue":y[3]||(y[3]=P=>o(c).currentItem.unit_id=P),label:"name",options:o(c).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:t.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),f.value?(h(),k(O,{key:0,label:t.$t("items.taxes")},{default:v(()=>[d(Z,{modelValue:I.value,"onUpdate:modelValue":y[4]||(y[4]=P=>I.value=P),options:U.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):K("",!0),d(O,{label:t.$t("items.description"),error:o(w).description.$error&&o(w).description.$errors[0].$message},{default:v(()=>[d(ee,{modelValue:o(c).currentItem.description,"onUpdate:modelValue":y[5]||(y[5]=P=>o(c).currentItem.description=P),rows:"4",cols:"50",invalid:o(w).description.$error,onInput:y[6]||(y[6]=P=>o(w).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),s("div",kt,[d(Q,{class:"mr-3",variant:"primary-outline",type:"button",onClick:g},{default:v(()=>[L(T(t.$t("general.cancel")),1)]),_:1}),d(Q,{loading:V.value,disabled:V.value,variant:"primary",type:"submit"},{left:v(P=>[d(_,{name:"SaveIcon",class:W(P.class)},null,8,["class"])]),default:v(()=>[L(" "+T(o(c).isEdit?t.$t("general.update"):t.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},Vt={class:"flex justify-between w-full"},qt={class:"flex flex-col"},Dt={class:"text-sm text-gray-500 mt-1"},Lt={class:"p-4 sm:p-6"},Et={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},At={__name:"TaxationAddressModal",emits:["addTax"],setup(m,{emit:x}){const p=ie();Ee();const e=Ae({state:"",city:"",address_street_1:"",zip:""}),c=F(!1),M=ve(),{t:i}=re(),b=u(()=>p.active&&p.componentName==="TaxationAddressModal"),V=u(()=>({state:{required:D.withMessage(i("validation.required"),Y)},city:{required:D.withMessage(i("validation.required"),Y)},address_street_1:{required:D.withMessage(i("validation.required"),Y)},zip:{required:D.withMessage(i("validation.required"),Y)}})),n=me(V,u(()=>e));async function C(){if(n.value.$touch(),n.value.$invalid)return!0;let I={address:e};p.id&&(I.customer_id=p.id),e.address_street_1=e.address_street_1.replace(/(\r\n|\n|\r)/gm,""),c.value=!0,await M.fetchSalesTax(I).then(f=>{c.value=!1,q("addTax",f.data.data),E()}).catch(f=>{c.value=!1})}const q=x;function A(){var I,f,$,w;e.state=(I=p==null?void 0:p.data)==null?void 0:I.state,e.city=(f=p==null?void 0:p.data)==null?void 0:f.city,e.address_street_1=($=p==null?void 0:p.data)==null?void 0:$.address_street_1,e.zip=(w=p==null?void 0:p.data)==null?void 0:w.zip}function E(){p.closeModal()}return(I,f)=>{const $=S("BaseIcon"),w=S("BaseInput"),U=S("BaseInputGroup"),l=S("BaseTextarea"),g=S("BaseInputGrid"),t=S("BaseButton"),y=S("BaseModal");return h(),k(y,{show:b.value,onClose:E,onOpen:A},{header:v(()=>[s("div",Vt,[s("div",qt,[L(T(o(p).title)+" ",1),s("p",Dt,T(o(p).content),1)]),d($,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:E})])]),default:v(()=>[s("form",{onSubmit:$e(C,["prevent"])},[s("div",Lt,[d(g,{layout:"one-column"},{default:v(()=>[d(U,{required:"",error:o(n).state.$error&&o(n).state.$errors[0].$message,label:I.$t("customers.state")},{default:v(()=>[d(w,{modelValue:e.state,"onUpdate:modelValue":f[0]||(f[0]=_=>e.state=_),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:o(n).state.$error,onInput:f[1]||(f[1]=_=>o(n).state.$touch()),placeholder:I.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),d(U,{required:"",error:o(n).city.$error&&o(n).city.$errors[0].$message,label:I.$t("customers.city")},{default:v(()=>[d(w,{modelValue:e.city,"onUpdate:modelValue":f[2]||(f[2]=_=>e.city=_),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:o(n).city.$error,onInput:f[3]||(f[3]=_=>o(n).city.$touch()),placeholder:I.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),d(U,{required:"",error:o(n).address_street_1.$error&&o(n).address_street_1.$errors[0].$message,label:I.$t("customers.address")},{default:v(()=>[d(l,{modelValue:e.address_street_1,"onUpdate:modelValue":f[4]||(f[4]=_=>e.address_street_1=_),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:o(n).address_street_1.$error,onInput:f[5]||(f[5]=_=>o(n).address_street_1.$touch()),placeholder:I.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),d(U,{required:"",error:o(n).zip.$error&&o(n).zip.$errors[0].$message,label:I.$t("customers.zip_code")},{default:v(()=>[d(w,{modelValue:e.zip,"onUpdate:modelValue":f[6]||(f[6]=_=>e.zip=_),invalid:o(n).zip.$error,onInput:f[7]||(f[7]=_=>o(n).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:I.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),s("div",Et,[d(t,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:E},{default:v(()=>[L(T(I.$t("general.cancel")),1)]),_:1}),d(t,{loading:c.value,variant:"primary",type:"submit"},{left:v(_=>[c.value?K("",!0):(h(),k($,{key:0,name:"SaveIcon",class:W(_.class)},null,8,["class"]))]),default:v(()=>[L(" "+T(I.$t("general.save")),1)]),_:1},8,["loading"])])],32)]),_:1},8,["show"])}}},ue="Sales Tax",pe="MODULE",Ot={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(m){const x=ie(),p=ne(),e=ve(),{t:c}=re(),M=F(!1),i=m,b=u(()=>i.isEdit?i.store[i.storeProp].sales_tax_address_type==="billing":p.selectedCompanySettings.sales_tax_address_type==="billing"),V=u(()=>p.selectedCompanySettings.sales_tax_us_enabled==="YES"),n=u(()=>i.isEdit?i.store[i.storeProp].sales_tax_type==="customer_level":p.selectedCompanySettings.sales_tax_type==="customer_level"),C=u(()=>i.isEdit?i.store[i.storeProp].sales_tax_type==="company_level":p.selectedCompanySettings.sales_tax_type==="company_level"),q=u(()=>{if(n.value&&A.value){let l=b.value?i.customer.billing:i.customer.shipping;return{address:J.exports.pick(l,["address_street_1","city","state","zip"]),customer_id:i.customer.id}}else if(C.value&&A.value)return{address:J.exports.pick(address,["address_street_1","city","state","zip"])}}),A=u(()=>{var l,g;if(n.value){let t=b.value?(l=i.customer)==null?void 0:l.billing:(g=i.customer)==null?void 0:g.shipping;return E(t)}else if(C.value)return E(p.selectedCompany.address);return!1});xe(()=>i.customer,(l,g)=>{if(l&&g&&n.value){I(l,g);return}!A.value&&n.value&&l?setTimeout(()=>{f()},500):n.value&&l?$():n.value&&!l&&U()}),be(()=>{C.value&&(A.value?$():f())});function E(l){return l?l.address_street_1&&l.city&&l.state&&l.zip:!1}function I(l,g){const t=b.value?l.billing:l.shipping,y=b.value?g.billing:g.shipping,_=J.exports.pick(t,["address_street_1","city","state","zip"]),H=J.exports.pick(y,["address_street_1","city","state","zip"]);J.exports.isEqual(_,H)||$()}function f(){var t,y;if(!V.value)return;let l=null,g="";n.value?b.value?(l=(t=i.customer)==null?void 0:t.billing,g=c("settings.taxations.add_billing_address")):(l=(y=i.customer)==null?void 0:y.shipping,g=c("settings.taxations.add_shipping_address")):(l=p.selectedCompany.address,g=c("settings.taxations.add_company_address")),x.openModal({title:g,content:c("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:l,id:n.value?i.customer.id:""})}async function $(){!V.value||(M.value=!0,await e.fetchSalesTax(q.value).then(l=>{w(l.data.data),M.value=!1}).catch(l=>{l.response.data.error&&setTimeout(()=>{f()},500),M.value=!1}))}function w(l){l.tax_type_id=l.id;const g=i.store[i.storeProp].taxes.findIndex(t=>t.name===ue&&t.type===pe);g>-1?Object.assign(i.store[i.storeProp].taxes[g],l):i.store[i.storeProp].taxes.push(l)}function U(){const l=i.store[i.storeProp].taxes.findIndex(t=>t.name===ue&&t.type===pe);l>-1&&i.store[i.storeProp].taxes.splice(l,1);let g=e.taxTypes.findIndex(t=>t.name===ue&&t.type===pe);g>-1&&e.taxTypes.splice(g,1)}return(l,g)=>(h(),k(At,{onAddTax:w}))}};export{Nt as _,Ft as a,Ot as b,jt as c};
