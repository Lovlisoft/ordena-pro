import{a3 as se,ab as X,I as J,u as ne,a8 as K,N as Q,l as W,M as Y,m as Z,r as _,o as v,j as y,h as a,a as l,x as r,z as u,t as c,g as k,Q as I,H as oe,d as w,e as M,p as G,q as le,L as ie,aj as re,b as N,w as ue,n as ce,K as de,E as me,an as fe,c as pe,F as ge}from"./main.d9f009a5.js";import{_ as ve}from"./EstimateIndexDropdown.1a9c324f.js";import{_ as ye}from"./SendEstimateModal.5edfc4c1.js";import{u as _e}from"./transaction.0debaf3b.js";import"./mail-driver.2e1553b1.js";const he={__name:"EstimateItemDropdown",props:{row:{type:Object,default:null},table:{type:Object,default:null}},setup(f){const E=f,b=se("utils"),A=X(),L=J(),T=ne(),o=K(),d=Q(),{t}=W(),S=Y(),C=Z();async function p(e){o.openDialog({title:t("general.are_you_sure"),message:t("estimates.confirm_delete"),yesLabel:t("general.ok"),noLabel:t("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(s=>{e=e,s&&A.deleteEstimate({ids:[e]}).then(i=>{i&&(E.table&&E.table.refresh(),i.data&&C.push("/admin/estimates"),A.$patch(m=>{m.selectedEstimates=[],m.selectAllField=!1}))})})}function h(e){o.openDialog({title:t("general.are_you_sure"),message:t("estimates.confirm_conversion"),yesLabel:t("general.ok"),noLabel:t("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(s=>{s&&A.convertToInvoice(e).then(i=>{i.data&&C.push(`/admin/invoices/${i.data.data.id}/edit`)})})}async function B(e){o.openDialog({title:t("general.are_you_sure"),message:t("estimates.confirm_mark_as_sent"),yesLabel:t("general.ok"),noLabel:t("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(s=>{const i={id:e,status:"SENT"};s&&A.markAsSent(i).then(m=>{E.table&&E.table.refresh()})})}function F(e){return(e.status=="SENT"||e.status=="VIEWED")&&S.name!=="estimates.view"&&d.hasAbilities(I.SEND_ESTIMATE)}async function g(e){L.openModal({title:t("estimates.send_estimate"),componentName:"SendEstimateModal",id:e.id,data:e,variant:"lg"})}async function j(e){o.openDialog({title:t("general.are_you_sure"),message:t("estimates.confirm_mark_as_accepted"),yesLabel:t("general.ok"),noLabel:t("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(s=>{const i={id:e,status:"ACCEPTED"};s&&A.markAsAccepted(i).then(m=>{E.table&&E.table.refresh()})})}async function R(e){o.openDialog({title:t("general.are_you_sure"),message:t("estimates.confirm_mark_as_rejected"),yesLabel:t("general.ok"),noLabel:t("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(s=>{const i={id:e,status:"REJECTED"};s&&A.markAsRejected(i).then(m=>{E.table&&E.table.refresh()})})}function P(){let e=`${window.location.origin}/estimates/pdf/${E.row.unique_hash}`;b.copyTextToClipboard(e),T.showNotification({type:"success",message:t("general.copied_pdf_url_clipboard")})}return(e,s)=>{const i=_("BaseIcon"),m=_("BaseDropdownItem"),V=_("router-link"),z=_("BaseDropdown");return v(),y(z,null,{activator:a(()=>[l(i,{class:"text-gray-500",name:"DotsHorizontalIcon"})]),default:a(()=>[r(S).name==="estimates.view"?(v(),y(m,{key:0,onClick:P},{default:a(()=>[l(i,{name:"LinkIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),u(" "+c(e.$t("general.copy_pdf_url")),1)]),_:1})):k("",!0),r(d).hasAbilities(r(I).EDIT_ESTIMATE)?(v(),y(V,{key:1,to:`/admin/estimates/${f.row.id}/edit`},{default:a(()=>[l(m,null,{default:a(()=>[l(i,{name:"PencilIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),u(" "+c(e.$t("general.edit")),1)]),_:1})]),_:1},8,["to"])):k("",!0),r(d).hasAbilities(r(I).DELETE_ESTIMATE)?(v(),y(m,{key:2,onClick:s[0]||(s[0]=$=>p(f.row.id))},{default:a(()=>[l(i,{name:"TrashIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),u(" "+c(e.$t("general.delete")),1)]),_:1})):k("",!0),r(S).name!=="estimates.view"&&r(d).hasAbilities(r(I).VIEW_ESTIMATE)?(v(),y(V,{key:3,to:`estimates/${f.row.id}/view`},{default:a(()=>[l(m,null,{default:a(()=>[l(i,{name:"EyeIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),u(" "+c(e.$t("general.view")),1)]),_:1})]),_:1},8,["to"])):k("",!0),r(d).hasAbilities(r(I).CREATE_INVOICE)?(v(),y(m,{key:4,onClick:s[1]||(s[1]=$=>h(f.row.id))},{default:a(()=>[l(i,{name:"DocumentTextIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),u(" "+c(e.$t("estimates.convert_to_invoice")),1)]),_:1})):k("",!0),f.row.status!=="SENT"&&r(S).name!=="estimates.view"&&r(d).hasAbilities(r(I).SEND_ESTIMATE)?(v(),y(m,{key:5,onClick:s[2]||(s[2]=$=>B(f.row.id))},{default:a(()=>[l(i,{name:"CheckCircleIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),u(" "+c(e.$t("estimates.mark_as_sent")),1)]),_:1})):k("",!0),f.row.status!=="SENT"&&r(S).name!=="estimates.view"&&r(d).hasAbilities(r(I).SEND_ESTIMATE)?(v(),y(m,{key:6,onClick:s[3]||(s[3]=$=>g(f.row))},{default:a(()=>[l(i,{name:"PaperAirplaneIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),u(" "+c(e.$t("estimates.send_estimate")),1)]),_:1})):k("",!0),F(f.row)?(v(),y(m,{key:7,onClick:s[4]||(s[4]=$=>g(f.row))},{default:a(()=>[l(i,{name:"PaperAirplaneIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),u(" "+c(e.$t("estimates.resend_estimate")),1)]),_:1})):k("",!0),f.row.status!=="ACCEPTED"&&r(d).hasAbilities(r(I).EDIT_ESTIMATE)?(v(),y(m,{key:8,onClick:s[5]||(s[5]=$=>j(f.row.id))},{default:a(()=>[l(i,{name:"CheckCircleIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),u(" "+c(e.$t("estimates.mark_as_accepted")),1)]),_:1})):k("",!0),f.row.status!=="REJECTED"&&r(d).hasAbilities(r(I).EDIT_ESTIMATE)?(v(),y(m,{key:9,onClick:s[6]||(s[6]=$=>R(f.row.id))},{default:a(()=>[l(i,{name:"XCircleIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),u(" "+c(e.$t("estimates.mark_as_rejected")),1)]),_:1})):k("",!0)]),_:1})}}},Ee={class:"flex justify-between w-full"},be={class:"item-modal"},ke={class:"px-8 py-8 sm:p-6"},we={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Te={__name:"EstimateFileUploadModal",emits:["newItem"],setup(f,{emit:E}){const b=J(),A=oe(),L=_e(),T=w(null),o=w(null),{t:d}=W(),t=w(!1);w(A.selectedCompanySettings.tax_per_item);const S=M(()=>b.active&&b.componentName==="EstimateFileUploadModal");G.withMessage(d("validation.required"),le),G.withMessage(d("validation.name_min_length",{count:3}),ie(3)),G.withMessage(d("validation.description_maxlength",{count:255}),re(255));async function C(){let h={bank_account:T,import_file:o};t.value=!0,await L.importTransactions(h).then(B=>{t.value=!1,B.data.data&&b.data&&b.refreshData(B.data.data),p()})}function p(){b.closeModal(),setTimeout(()=>{b.$reset(),v$.value.$reset()},300)}return(h,B)=>{const F=_("BaseIcon"),g=_("BaseFileUploader"),j=_("BaseInputGroup"),R=_("BaseInputGrid"),P=_("BaseButton"),e=_("BaseModal");return v(),y(e,{show:S.value,onClose:p},{header:a(()=>[N("div",Ee,[u(c(r(b).title)+" ",1),l(F,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:p})])]),default:a(()=>[N("div",be,[N("form",{action:"",onSubmit:ue(C,["prevent"])},[N("div",ke,[l(R,{layout:"one-column"},{default:a(()=>[l(j,{label:h.$t("expenses.receipt")},{default:a(()=>[l(g,{modelValue:o.value,"onUpdate:modelValue":B[0]||(B[0]=s=>o.value=s),accept:".csv,.xlsx,.xls",autoProcess:"true",uploadUrl:"/api/v1/files",onChange:h.onFileInputChange,onRemove:h.onFileInputRemove},null,8,["modelValue","onChange","onRemove"])]),_:1},8,["label"])]),_:1})]),N("div",we,[l(P,{class:"mr-3",variant:"primary-outline",type:"button",onClick:p},{default:a(()=>[u(c(h.$t("general.cancel")),1)]),_:1}),l(P,{loading:t.value,disabled:t.value,variant:"primary",type:"submit"},{left:a(s=>[l(F,{name:"SaveIcon",class:ce(s.class)},null,8,["class"])]),default:a(()=>[u(" Adjuntar Archivo ")]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},Se={class:"mr-3 text-sm"},Be={class:"relative table-container pt-5"},De={__name:"View",setup(f){const E=J(),b=X(),A=K(),L=Q(),{t:T}=W(),o=w(null),d=Y();Z();const t=w(!1),S=w(!1),C=w(!1),p=w(null),h=w(1),B=w(1),F=w(null),g=de({orderBy:null,orderByField:null,searchText:null}),j=M(()=>[{key:"id",label:"Partida"},{key:"name",label:"Producto"},{key:"quantity",label:"Litros"},{key:"precision_price",label:"Precio Unitario"},{key:"total",label:"Total"},{key:"actions",label:"Acciones",tdClass:"text-right text-sm font-medium pl-0",thClass:"text-right pl-0",sortable:!1}]),R=M(()=>"Previa: "+o.value.estimate_number),P=M(()=>g.orderBy==="asc"||g.orderBy==null);M(()=>P.value?T("general.ascending"):T("general.descending")),M(()=>`/estimates/pdf/${o.value.unique_hash}`),M(()=>o.value&&o.value.id?estimate.value.id:null),me(d,(n,U)=>{n.name==="estimates.view"&&V()}),e(),V(),z=fe.exports.debounce(z,500);async function e(n,U=!1){if(S.value)return;let D={};g.searchText!==""&&g.searchText!==null&&g.searchText!==void 0&&(D.search=g.searchText),g.orderBy!==null&&g.orderBy!==void 0&&(D.orderBy=g.orderBy),g.orderByField!==null&&g.orderByField!==void 0&&(D.orderByField=g.orderByField),S.value=!0;let q=await b.fetchEstimates({page:n,...D});S.value=!1,p.value=p.value?p.value:[],p.value=[...p.value,...q.data.data],h.value=n||1,B.value=q.data.meta.last_page;let H=p.value.find(O=>O.id==d.params.id);U==!1&&!H&&h.value<B.value&&Object.keys(D).length===0&&e(++h.value),H&&setTimeout(()=>{U==!1&&i()},500)}function s(){E.openModal({title:"Cargar Previa",componentName:"EstimateFileUploadModal",refreshData:n=>emit("select",n)})}function i(){const n=document.getElementById(`estimate-${d.params.id}`);n&&(n.scrollIntoView({behavior:"smooth"}),n.classList.add("shake"),m())}function m(){F.value.addEventListener("scroll",n=>{n.target.scrollTop>0&&n.target.scrollTop+n.target.clientHeight>n.target.scrollHeight-200&&h.value<B.value&&e(++h.value,!0)})}async function V(){C.value=!0;let n=await b.fetchEstimate(d.params.id);n.data&&(C.value=!1,o.value={...n.data.data})}async function z(){p.value=[],e()}async function $(){A.openDialog({title:T("general.are_you_sure"),message:T("estimates.confirm_mark_as_sent"),yesLabel:T("general.ok"),noLabel:T("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(n=>{t.value=!1,n&&(b.markAsSent({id:o.value.id,status:"SENT"}),o.value.status="SENT",t.value=!0),t.value=!1})}async function ee(n){E.openModal({title:T("estimates.send_estimate"),componentName:"SendEstimateModal",id:o.value.id,data:o.value})}function te(){let n=p.value.findIndex(U=>U.id===o.value.id);p.value[n]&&(p.value[n].status="SENT",o.value.status="SENT")}return(n,U)=>{const D=_("BaseButton"),q=_("BasePageHeader"),H=_("router-link"),O=_("BaseTable"),ae=_("BasePage");return v(),pe(ge,null,[l(ye,{onUpdate:te}),l(Te),o.value?(v(),y(ae,{key:0},{default:a(()=>[l(q,{title:R.value},{actions:a(()=>[N("div",Se,[o.value.status==="DRAFT"&&r(L).hasAbilities(r(I).EDIT_ESTIMATE)?(v(),y(D,{key:0,disabled:t.value,"content-loading":C.value,variant:"primary-outline",onClick:$},{default:a(()=>[u(c(n.$t("estimates.mark_as_sent")),1)]),_:1},8,["disabled","content-loading"])):k("",!0)]),o.value.status==="DRAFT"&&r(L).hasAbilities(r(I).SEND_ESTIMATE)?(v(),y(D,{key:0,"content-loading":C.value,variant:"primary",class:"text-sm",onClick:ee},{default:a(()=>[u(c(n.$t("estimates.send_estimate")),1)]),_:1},8,["content-loading"])):k("",!0),l(ve,{class:"ml-3",row:o.value},null,8,["row"])]),_:1},8,["title"]),N("div",Be,[l(O,{data:o.value.items,columns:j.value,loading:C.value},{"cell-id":a(({row:x})=>[l(H,{to:s,class:"font-medium text-primary-500"},{default:a(()=>[u(c(x.data.id),1)]),_:2},1024)]),"cell-name":a(({row:x})=>[u(c(x.data.name),1)]),"cell-quantity":a(({row:x})=>[u(c(x.data.quantity),1)]),"cell-precision_price":a(({row:x})=>[u(c(x.data.precision_price),1)]),"cell-total":a(({row:x})=>[u(c(x.data.total),1)]),"cell-actions":a(()=>[l(he,{class:"ml-3",row:o.value},null,8,["row"])]),_:1},8,["data","columns","loading"])])]),_:1})):k("",!0)],64)}}};export{De as default};
