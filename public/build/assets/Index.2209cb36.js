import{I as W,H as X,d as h,l as K,e as $,p as Y,q as se,L as le,aj as re,r as o,o as f,j as I,h as e,b as y,z as i,t as d,x as m,a,w as ie,n as w,K as ce,a8 as de,N as me,ad as ue,ae as pe,c as q,a9 as G,aa as R,g as z,a4 as H,Q as P,F as _e}from"./main.d9f009a5.js";import{u as fe}from"./payment.11ac5240.js";import{u as O}from"./transaction.0debaf3b.js";import{_ as ye}from"./CapsuleIcon.328475a3.js";import{_ as ve}from"./SendPaymentModal.d02178c9.js";import"./mail-driver.2e1553b1.js";const be={class:"flex justify-between w-full"},he={class:"item-modal"},Be={class:"px-8 py-8 sm:p-6"},ge={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},ke={__name:"BankImportModal",emits:["newItem"],setup(Q,{emit:B}){const l=W(),g=X(),k=O(),r=h(null),s=h(null),{t:v}=K(),p=h(!1);h(g.selectedCompanySettings.tax_per_item);const E=$(()=>l.active&&l.componentName==="BankImportModal");Y.withMessage(v("validation.required"),se),Y.withMessage(v("validation.name_min_length",{count:3}),le(3)),Y.withMessage(v("validation.description_maxlength",{count:255}),re(255));async function T(){let _={bank_account:r,import_file:s};p.value=!0,await k.importTransactions(_).then(c=>{p.value=!1,c.data.data&&l.data&&l.refreshData(c.data.data),C()})}function C(){l.closeModal(),setTimeout(()=>{l.$reset(),v$.value.$reset()},300)}return(_,c)=>{const M=o("BaseIcon"),F=o("BaseMultiselect"),x=o("BaseInputGroup"),V=o("BaseFileUploader"),N=o("BaseInputGrid"),A=o("BaseButton"),D=o("BaseModal");return f(),I(D,{show:E.value,onClose:C},{header:e(()=>[y("div",be,[i(d(m(l).title)+" ",1),a(M,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:C})])]),default:e(()=>[y("div",he,[y("form",{action:"",onSubmit:ie(T,["prevent"])},[y("div",Be,[a(N,{layout:"one-column"},{default:e(()=>[a(x,{label:"Cuenta Bancaria"},{default:e(()=>[a(F,{modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=n=>r.value=n),label:"alias",options:m(g).selectedCompany.bank_accounts,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:"Elige una cuenta",searchable:"","track-by":"name"},null,8,["modelValue","options"])]),_:1}),a(x,{label:_.$t("expenses.receipt")},{default:e(()=>[a(V,{modelValue:s.value,"onUpdate:modelValue":c[1]||(c[1]=n=>s.value=n),accept:".csv,.xlsx,.xls",autoProcess:"true",uploadUrl:"/api/v1/files",onChange:_.onFileInputChange,onRemove:_.onFileInputRemove},null,8,["modelValue","onChange","onRemove"])]),_:1},8,["label"])]),_:1})]),y("div",ge,[a(A,{class:"mr-3",variant:"primary-outline",type:"button",onClick:C},{default:e(()=>[i(d(_.$t("general.cancel")),1)]),_:1}),a(A,{loading:p.value,disabled:p.value,variant:"primary",type:"submit"},{left:e(n=>[a(M,{name:"SaveIcon",class:w(n.class)},null,8,["class"])]),default:e(()=>[i(" Importar Movimientos ")]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},Ce={class:"relative table-container"},Ie={class:"absolute items-center left-6 top-2.5 select-none"},Me={class:"relative block"},Se={key:1},Ee={__name:"Index",setup(Q){const{t:B}=K();let l=h(!1),g=h(!0),k=h(null);const r=ce({customer:"",payment_mode:"",payment_number:""}),s=fe(),v=O();X(),de();const p=me(),E=W(),T=$(()=>!v.transactionTotalCount&&!g.value);function C(){E.openModal({title:"Importar Movimientos",componentName:"BankImportModal",refreshData:n=>emit("select",n)})}const _=$(()=>[{key:"status",sortable:!1,thClass:"extra w-10",tdClass:"text-left text-sm font-medium extra"},{key:"date",label:B("transactions.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"account",label:B("transactions.bank")},{key:"reference",label:B("transactions.reference")},{key:"debit",label:B("transactions.debit")},{key:"credit",label:B("transactions.credit")},{key:"actions",label:"",tdClass:"text-right text-sm font-medium",sortable:!1}]),c=$({get:()=>s.selectedPayments,set:n=>s.selectPayment(n)}),M=$({get:()=>s.selectAllField,set:n=>s.setSelectAllState(n)});ue(r,()=>{N()},{debounce:500}),pe(()=>{s.selectAllField&&s.selectAllPayments()}),s.fetchPaymentModes({limit:"all"});function F(){return p.hasAbilities([P.DELETE_PAYMENT,P.EDIT_PAYMENT,P.VIEW_PAYMENT,P.SEND_PAYMENT])}async function x({page:n,filter:b,sort:S}){let U={customer_id:r.customer_id,payment_method_id:r.payment_mode!==null?r.payment_mode:"",payment_number:r.payment_number,orderByField:S.fieldName||"created_at",orderBy:S.order||"desc",page:n};g.value=!0;let u=await v.fetchTransactions(U);return g.value=!1,{data:u.data.data,pagination:{totalPages:u.data.meta.last_page,currentPage:u.data.meta.current_page,totalCount:u.data.meta.total,limit:10}}}function V(){k.value&&k.value.refresh()}function N(){V()}function A(){r.customer_id="",r.payment_mode="",r.payment_number=""}function D(){l.value&&A(),l.value=!l.value}return(n,b)=>{const S=o("BaseBreadcrumbItem"),U=o("BaseBreadcrumb"),u=o("BaseIcon"),L=o("BaseButton"),J=o("BasePageHeader"),Z=o("BaseEmptyPlaceholder"),j=o("BaseCheckbox"),ee=o("router-link"),te=o("PaymentDropdown"),ae=o("BaseTable"),ne=o("BasePage");return f(),q(_e,null,[a(ke),a(ne,{class:"payments"},{default:e(()=>[a(ve),a(J,{title:n.$t("transactions.title")},{actions:e(()=>[G(a(L,{variant:"primary-outline",onClick:D},{right:e(t=>[m(l)?(f(),I(u,{key:1,name:"XIcon",class:w(t.class)},null,8,["class"])):(f(),I(u,{key:0,class:w(t.class),name:"FilterIcon"},null,8,["class"]))]),default:e(()=>[i(d(n.$t("general.filter"))+" ",1)]),_:1},512),[[R,m(s).paymentTotalCount]]),m(p).currentUser.is_owner?(f(),I(L,{key:0,onClick:C},{left:e(t=>[a(u,{name:"PlusIcon",class:w(t.class),"aria-hidden":"true"},null,8,["class"])]),default:e(()=>[i(" Importar Movimientos ")]),_:1})):z("",!0)]),default:e(()=>[a(U,null,{default:e(()=>[a(S,{title:n.$t("general.home"),to:"dashboard"},null,8,["title"]),a(S,{title:n.$tc("transactions.transactions",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),T.value?(f(),I(Z,{key:0,title:n.$t("payments.no_payments"),description:n.$t("payments.list_of_payments")},H({default:e(()=>[a(ye,{class:"mt-5 mb-4"})]),_:2},[m(p).hasAbilities(m(P).CREATE_PAYMENT)?{name:"actions",fn:e(()=>[a(L,{variant:"primary-outline",onClick:b[0]||(b[0]=t=>n.$router.push("/admin/payments/create"))},{left:e(t=>[a(u,{name:"PlusIcon",class:w(t.class)},null,8,["class"])]),default:e(()=>[i(" "+d(n.$t("payments.add_new_payment")),1)]),_:1})]),key:"0"}:void 0]),1032,["title","description"])):z("",!0),G(y("div",Ce,[a(ae,{ref_key:"tableComponent",ref:k,data:x,columns:_.value,"placeholder-count":m(v).transactionTotalCount>=20?10:5,class:"mt-3"},H({header:e(()=>[y("div",Ie,[a(j,{modelValue:M.value,"onUpdate:modelValue":b[1]||(b[1]=t=>M.value=t),variant:"primary",onChange:m(s).selectAllPayments},null,8,["modelValue","onChange"])])]),"cell-status":e(({row:t})=>[y("div",Me,[a(j,{id:t.data.id,modelValue:c.value,"onUpdate:modelValue":b[2]||(b[2]=oe=>c.value=oe),value:t.data.id,variant:"primary"},null,8,["id","modelValue","value"])])]),"cell-date":e(({row:t})=>[i(d(t.data.date),1)]),"cell-account":e(({row:t})=>[i(d(t.data.account),1)]),"cell-reference":e(({row:t})=>[t.data.reference_link?(f(),I(ee,{key:0,to:{path:`${t.data.reference_link}`},class:"font-medium text-primary-500"},{default:e(()=>[i(d(t.data.reference),1)]),_:2},1032,["to"])):(f(),q("span",Se,d(t.data.reference),1))]),"cell-debit":e(({row:t})=>[i(d(t.data.debit),1)]),"cell-credit":e(({row:t})=>[i(d(t.data.credit),1)]),_:2},[F()?{name:"cell-actions",fn:e(({row:t})=>[a(te,{row:t.data,table:m(k)},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"])],512),[[R,!T.value]])]),_:1})],64)}}};export{Ee as default};
