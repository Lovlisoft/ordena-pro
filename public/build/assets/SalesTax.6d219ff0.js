import{H as ne,as as ye,ab as fe,M as Te,l as re,e as u,aH as R,d as N,E as xe,an as J,p as D,q as Y,aJ as _e,aj as oe,ay as Me,v as me,r as w,o as x,c as U,b as s,a as l,x as o,j as V,aL as de,h as v,g as K,z as L,aM as ce,t as T,aI as ge,aN as Ce,ap as ke,F as he,I as ie,N as Ve,i as qe,n as W,aw as ve,u as De,L as Le,f as be,w as $e,J as Ee,K as Ae}from"./main.fa881b19.js";import{D as Ue,d as ze}from"./DragIcon.1052e783.js";const je={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},Ne={colspan:"5",class:"p-0 text-left align-top pt-2"},Fe={class:"w-full"},Oe=s("colgroup",null,[s("col",{style:{width:"30%","min-width":"280px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}})],-1),Ge={class:"px-2 py-2 text-left align-top"},Xe={class:"flex justify-start"},Re={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},Ye={class:"px-2 py-2 text-right align-top"},He={class:"px-2 py-2 text-left align-top"},Je={class:"flex flex-col"},Ke={class:"flex-auto flex-fill bd-highlight"},Qe={class:"relative w-full"},We={class:"px-2 py-2 text-left align-top"},Ze={class:"flex flex-col"},et={class:"flex-auto flex-fill bd-highlight"},tt={class:"relative w-full"},at={class:"px-2 py-2 text-right align-top"},st={class:"flex items-center justify-end text-sm"},ot={class:"flex items-center justify-center w-6 h-10 mx-2"},nt={class:"px-12 pb-4 text-right"},rt={class:"text-sm pr-6"},it={key:0},lt={class:"text-sm pr-6"},dt={class:"text-sm"},ct={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(m,{emit:g}){const{getItemDecimalPrecisionMultiplier:p}=ge,e=m,c=ne(),M=ye(),i=fe();Te();const{t:b}=re(),C=u({get:()=>i.newEstimate.show_price_breakdown}),n=u({get:()=>e.itemData.quantity,set:a=>{G("quantity",parseFloat(a))}});u({get:()=>{const a=e.itemData.price;return parseFloat(a)>0?a/100:a},set:a=>{if(parseFloat(a)>0){let r=Math.round(a*100);G("price",r)}else G("price",a)}});const k=u({get:()=>{const a=e.itemData.precision_price;return parseFloat(a)>0?a/p(R):a},set:a=>{if(parseFloat(a)>0){let r=Math.round(a*p(R)),P=Math.round(a*100);G("precision_price",r),G("price",P)}else G("precision_price",a),G("price",a)}}),q=u({get:()=>$(y)}),A=u({get:()=>$(F)}),E=u({get:()=>$(H)});function $(a){return a.value.toLocaleString("es-MX",{style:"currency",currency:"MXN"})}N(null);const _=N(null),I=N(null),S=N(null),z=u(()=>e.itemData.precision_price*e.itemData.quantity),d=u(()=>e.itemData.precision_price*e.itemData.quantity/p(R)),h=u({get:()=>{var r;let a=(r=_.value)!=null?r:t.value/n.value;return I.value=a,a},set:a=>{t.value=a*n.value,_.value=parseFloat(a)}}),t=u({get:()=>{let a=y.value+F.value+H.value;return S.value=a,a},set:a=>{let r=Math.round((t.value+Number.EPSILON)*100)/100,P=Math.round((parseFloat(a)+Number.EPSILON)*100)/100;r!==P&&(_.value=parseFloat(a/n.value),f(parseFloat(a)))}});function f(a){let r=n.value,P=C.value?e.itemData.ieps:0,X=1.16,se=(a/r-P)/X+P;r>0&&se>0&&a>0&&(n.value=r,k.value=se)}const y=u({get:()=>d.value-H.value}),H=u({get:()=>C.value?e.itemData.quantity*e.itemData.ieps:0}),F=u({get:()=>y.value*.16});xe(()=>C.value,a=>{f(S.value)});const O=u(()=>e.currency?e.currency:c.selectedCompanyCurrency),Z=u(()=>e.store[e.storeProp].items.length!=1),ee=u(()=>Math.round(J.exports.sumBy(e.itemData.taxes,function(a){return a.compound_tax?0:a.amount}))),te=u(()=>Math.round(J.exports.sumBy(e.itemData.taxes,function(a){return a.compound_tax?a.amount:0}))),Q=u(()=>ee.value+te.value),le={name:{required:D.withMessage(b("validation.required"),Y)},quantity:{required:D.withMessage(b("validation.required"),Y),minValue:D.withMessage(b("validation.qty_must_greater_than_zero"),_e(0)),maxLength:D.withMessage(b("validation.amount_maxlength"),oe(20))},price:{required:D.withMessage(b("validation.required"),Y),minValue:D.withMessage(b("validation.number_length_minvalue"),_e(1)),maxLength:D.withMessage(b("validation.price_maxlength"),oe(20))},discount_val:{between:D.withMessage(b("validation.discount_maxlength"),Me(0,u(()=>z.value)))},description:{maxLength:D.withMessage(b("validation.notes_maxlength"),oe(65e3))}},B=me(le,u(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function Ie(a){e.store.$patch(P=>{P[e.storeProp].items[e.index].taxes[a.index]=a.item});let r=e.itemData.taxes[e.itemData.taxes.length-1];(r==null?void 0:r.tax_type_id)!==0&&e.store.$patch(P=>{P[e.storeProp].items[e.index].taxes.push({...Ce,id:ke.raw()})}),ae()}function we(a){G("name",a)}function Se(a){e.store.$patch(r=>{if(r[e.storeProp].items[e.index].name=a.name,r[e.storeProp].items[e.index].price=a.price,r[e.storeProp].items[e.index].item_id=a.id,r[e.storeProp].items[e.index].description=a.description,r[e.storeProp].items[e.index].precision=a.precision,r[e.storeProp].items[e.index].precision_price=a.precision_price,r[e.storeProp].items[e.index].ieps=a.ieps,a.unit&&(r[e.storeProp].items[e.index].unit_name=a.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&a.taxes){let P=0;a.taxes.forEach(X=>{Ie({index:P,item:{...X}}),P++})}r[e.storeProp].exchange_rate&&(r[e.storeProp].items[e.index].price/=r[e.storeProp].exchange_rate)}),M.fetchItems(),ae()}function ae(){var P,X;let a=(X=(P=e.store[e.storeProp])==null?void 0:P.items[e.index])==null?void 0:X.taxes;a||(a=[]);let r={...e.store[e.storeProp].items[e.index],index:e.index,total:t.value,sub_total:z.value,totalSimpleTax:ee.value,totalCompoundTax:te.value,totalTax:Q.value,tax:Q.value,taxes:[...a]};e.store.updateItem(r)}function G(a,r){e.store.$patch(P=>{P[e.storeProp].items[e.index][a]=r}),ae()}return(a,r)=>{const P=w("BaseItemSelect"),X=w("BaseInput"),se=w("BaseContentPlaceholdersText"),Be=w("BaseContentPlaceholders"),Pe=w("BaseIcon");return x(),U("tr",je,[s("td",Ne,[s("table",Fe,[Oe,s("tbody",null,[s("tr",null,[s("td",Ge,[s("div",Xe,[s("div",Re,[l(Ue)]),l(P,{type:"Invoice",item:m.itemData,invalid:o(B).name.$error,"invalid-description":o(B).description.$error,taxes:m.itemData.taxes,index:m.index,"store-prop":m.storeProp,store:m.store,onSearch:we,onSelect:Se},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),s("td",Ye,[l(X,{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=j=>n.value=j),invalid:o(B).quantity.$error,"content-loading":m.loading,type:"number",small:"",min:"0",step:"any",onChange:r[1]||(r[1]=j=>ae()),onInput:r[2]||(r[2]=j=>o(B).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),s("td",He,[s("div",Je,[s("div",Ke,[s("div",Qe,[(x(),V(de,{key:O.value,modelValue:k.value,"onUpdate:modelValue":r[3]||(r[3]=j=>k.value=j),invalid:o(B).price.$error,"content-loading":m.loading,currency:O.value,"item-precision":o(R),disabled:!0},null,8,["modelValue","invalid","content-loading","currency","item-precision"]))])])])]),s("td",We,[s("div",Ze,[s("div",et,[s("div",tt,[(x(),V(de,{key:O.value,modelValue:h.value,"onUpdate:modelValue":r[4]||(r[4]=j=>h.value=j),invalid:o(B).price.$error,"content-loading":m.loading,currency:O.value,"item-precision":o(R)},null,8,["modelValue","invalid","content-loading","currency","item-precision"]))])])])]),s("td",at,[s("div",st,[s("span",null,[m.loading?(x(),V(Be,{key:0},{default:v(()=>[l(se,{lines:1,class:"w-16 h-5"})]),_:1})):(x(),V(de,{key:O.value,modelValue:t.value,"onUpdate:modelValue":r[5]||(r[5]=j=>t.value=j),currency:O.value,"item-precision":2},null,8,["modelValue","currency"]))]),s("div",ot,[Z.value?(x(),V(Pe,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:r[6]||(r[6]=j=>m.store.removeItem(m.index))})):K("",!0)])])])])])]),s("div",nt,[l(ce,null,{default:v(()=>[L("Monto Base:")]),_:1}),L(),s("span",rt,T(q.value),1),C.value?(x(),U("span",it,[l(ce,null,{default:v(()=>[L("IEPS:")]),_:1}),L(),s("span",lt,T(E.value),1)])):K("",!0),l(ce,null,{default:v(()=>[L("IVA (16%): ")]),_:1}),L(),s("span",dt,T(A.value),1)])])])}}},ut={class:"text-center item-table min-w-full"},pt=s("colgroup",null,[s("col",{style:{width:"30%","min-width":"280px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}})],-1),mt={class:"bg-white border border-gray-200 border-solid"},vt={class:"px-2 text-sm not-italic font-medium text-left gap-2 text-gray-700 border-t border-b border-gray-200 border-solid"},_t={class:"py-3"},yt={key:1,class:"pl-10"},ft={key:1},xt={key:1},gt={key:1},ht={key:1,class:"pr-10 column-heading"},Nt={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(m){const g=m,p=ne(),e=u(()=>g.currency?g.currency:p.selectedCompanyCurrency);return(c,M)=>{const i=w("BaseContentPlaceholdersText"),b=w("BaseContentPlaceholders"),C=w("BaseIcon");return x(),U(he,null,[s("table",ut,[pt,s("thead",mt,[s("tr",vt,[s("th",_t,[m.isLoading?(x(),V(b,{key:0},{default:v(()=>[l(i,{lines:1,class:"w-16 h-5"})]),_:1})):(x(),U("span",yt,T(c.$tc("items.item",2)),1))]),s("th",null,[m.isLoading?(x(),V(b,{key:0},{default:v(()=>[l(i,{lines:1,class:"w-16 h-5"})]),_:1})):(x(),U("span",ft,T(c.$t("invoices.item.quantity")),1))]),s("th",null,[m.isLoading?(x(),V(b,{key:0},{default:v(()=>[l(i,{lines:1,class:"w-16 h-5"})]),_:1})):(x(),U("span",xt,T(c.$t("invoices.item.price")),1))]),s("th",null,[m.isLoading?(x(),V(b,{key:0},{default:v(()=>[l(i,{lines:1,class:"w-16 h-5"})]),_:1})):(x(),U("span",gt," Precio de Venta "))]),s("th",null,[m.isLoading?(x(),V(b,{key:0},{default:v(()=>[l(i,{lines:1,class:"w-16 h-5"})]),_:1})):(x(),U("span",ht,T(c.$t("invoices.item.amount")),1))])])]),l(o(ze),{modelValue:m.store[m.storeProp].items,"onUpdate:modelValue":M[0]||(M[0]=n=>m.store[m.storeProp].items=n),"item-key":"id",tag:"tbody",handle:".handle"},{item:v(({element:n,index:k})=>[(x(),V(ct,{key:n.id,index:k,"item-data":n,loading:m.isLoading,currency:e.value,"item-validation-scope":m.itemValidationScope,"invoice-items":m.store[m.storeProp].items,store:m.store,"store-prop":m.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),s("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:M[1]||(M[1]=(...n)=>m.store.addItem&&m.store.addItem(...n))},[l(C,{name:"PlusCircleIcon",class:"mr-2"}),L(" "+T(c.$t("general.add_new_item")),1)])],64)}}},bt={class:"flex justify-between w-full"},$t={class:"px-8 py-8 sm:p-6"},It={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},wt=["onClick"],St=["src","alt"],Bt=["alt","src"],Pt={key:1,class:"z-0 flex ml-3 pt-5"},Tt={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ft={__name:"SelectTemplateModal",setup(m){const g=ie(),p=Ve(),e=N(""),c=u(()=>g.active&&g.componentName==="SelectTemplate"),M=u(()=>g.title);function i(){g.data.store[g.data.storeProp].template_name?e.value=g.data.store[g.data.storeProp].template_name:e.value=g.data.templates[0]}async function b(){await g.data.store.setTemplate(e.value),!g.data.store.isEdit&&g.data.isMarkAsDefault&&(g.data.storeProp=="newEstimate"?await p.updateUserSettings({settings:{default_estimate_template:e.value}}):g.data.storeProp=="newInvoice"&&await p.updateUserSettings({settings:{default_invoice_template:e.value}})),n()}function C(){return new URL("/img/tick.png",self.location)}function n(){g.closeModal(),setTimeout(()=>{g.$reset()},300)}return(k,q)=>{const A=w("BaseIcon"),E=w("BaseCheckbox"),$=w("BaseButton"),_=w("BaseModal");return x(),V(_,{show:c.value,onClose:n,onOpen:i},{header:v(()=>[s("div",bt,[L(T(M.value)+" ",1),l(A,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:n})])]),default:v(()=>[s("div",$t,[o(g).data?(x(),U("div",It,[(x(!0),U(he,null,qe(o(g).data.templates,(I,S)=>(x(),U("div",{key:S,class:W([{"border border-solid border-primary-500":e.value===I.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:z=>e.value=I.name},[s("img",{src:I.path,alt:I.name,class:"w-full min-h-[100px]"},null,8,St),e.value===I.name?(x(),U("img",{key:0,alt:I.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:C()},null,8,Bt)):K("",!0),s("span",{class:W(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":e.value===I.name,"text-gray-600":e.value!=I.name}])},T(I.name),3)],10,wt))),128))])):K("",!0),o(g).data.store.isEdit?K("",!0):(x(),U("div",Pt,[l(E,{modelValue:o(g).data.isMarkAsDefault,"onUpdate:modelValue":q[0]||(q[0]=I=>o(g).data.isMarkAsDefault=I),"set-initial-value":!1,variant:"primary",label:k.$t("general.mark_as_default"),description:o(g).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),s("div",Tt,[l($,{class:"mr-3",variant:"primary-outline",onClick:n},{default:v(()=>[L(T(k.$t("general.cancel")),1)]),_:1}),l($,{variant:"primary",onClick:q[1]||(q[1]=I=>b())},{left:v(I=>[l(A,{name:"SaveIcon",class:W(I.class)},null,8,["class"])]),default:v(()=>[L(" "+T(k.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},Mt={class:"flex justify-between w-full"},Ct={class:"item-modal"},kt={class:"px-8 py-8 sm:p-6"},Vt={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ot={__name:"ItemModal",emits:["newItem"],setup(m,{emit:g}){const{getItemDecimalPrecisionMultiplier:p}=ge,e=ie(),c=ye(),M=ne(),i=ve();fe(),De();const{t:b}=re(),C=N(!1),n=N(M.selectedCompanySettings.tax_per_item),k=u(()=>e.active&&e.componentName==="ItemModal"),q=(t,f)=>{c.$patch(y=>{y.currentItem[t]=f})},A=u({get:()=>{const t=c.currentItem.price;return parseFloat(t)>0?t/100:t},set:t=>{if(parseFloat(t)>0){let f=Math.round(t*100);q("price",f)}else q("price",t)}}),E=u({get:()=>{const t=c.currentItem.precision_price;return parseFloat(t)>0?t/p(R):t},set:t=>{if(parseFloat(t)>0){let f=Math.round(t*p(R)),y=Math.round(t*100);q("precision_price",f),q("price",y)}else q("precision_price",t),q("price",t)}}),$=u({get:()=>c.currentItem.taxes.map(t=>{if(t)return{...t,tax_type_id:t.id,tax_name:t.name+" ("+t.percent+"%)"}}),set:t=>{c.$patch(f=>{f.currentItem.taxes=t})}}),_=u(()=>n.value==="YES"),I={name:{required:D.withMessage(b("validation.required"),Y),minLength:D.withMessage(b("validation.name_min_length",{count:3}),Le(3))},description:{maxLength:D.withMessage(b("validation.description_maxlength",{count:255}),oe(255))}},S=me(I,u(()=>c.currentItem)),z=u(()=>i.taxTypes.map(t=>({...t,tax_name:t.name+" ("+t.percent+"%)"})));be(()=>{S.value.$reset(),c.fetchItemUnits({limit:"all"})});async function d(){if(S.value.$touch(),S.value.$invalid)return!0;let t={...c.currentItem,taxes:c.currentItem.taxes.map(y=>({tax_type_id:y.id,amount:A.value*y.percent,percent:y.percent,name:y.name,collective_tax:0}))};C.value=!0,await(c.isEdit?c.updateItem:c.addItem)(t).then(y=>{C.value=!1,y.data.data&&e.data&&e.refreshData(y.data.data),h()})}function h(){e.closeModal(),setTimeout(()=>{c.resetCurrentItem(),e.$reset(),S.value.$reset()},300)}return(t,f)=>{const y=w("BaseIcon"),H=w("BaseInput"),F=w("BaseInputGroup"),O=w("BaseItemMoney"),Z=w("BaseMultiselect"),ee=w("BaseTextarea"),te=w("BaseInputGrid"),Q=w("BaseButton"),le=w("BaseModal");return x(),V(le,{show:k.value,onClose:h},{header:v(()=>[s("div",Mt,[L(T(o(e).title)+" ",1),l(y,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:h})])]),default:v(()=>[s("div",Ct,[s("form",{action:"",onSubmit:$e(d,["prevent"])},[s("div",kt,[l(te,{layout:"one-column"},{default:v(()=>[l(F,{label:t.$t("items.name"),required:"",error:o(S).name.$error&&o(S).name.$errors[0].$message},{default:v(()=>[l(H,{modelValue:o(c).currentItem.name,"onUpdate:modelValue":f[0]||(f[0]=B=>o(c).currentItem.name=B),type:"text",invalid:o(S).name.$error,onInput:f[1]||(f[1]=B=>o(S).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),l(F,{label:t.$t("items.price")},{default:v(()=>[(x(),V(O,{key:o(M).selectedCompanyCurrency,modelValue:E.value,"onUpdate:modelValue":f[2]||(f[2]=B=>E.value=B),currency:o(M).selectedCompanyCurrency,"item-precision":o(R),class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency","item-precision"]))]),_:1},8,["label"]),l(F,{label:t.$t("items.unit")},{default:v(()=>[l(Z,{modelValue:o(c).currentItem.unit_id,"onUpdate:modelValue":f[3]||(f[3]=B=>o(c).currentItem.unit_id=B),label:"name",options:o(c).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:t.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),_.value?(x(),V(F,{key:0,label:t.$t("items.taxes")},{default:v(()=>[l(Z,{modelValue:$.value,"onUpdate:modelValue":f[4]||(f[4]=B=>$.value=B),options:z.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):K("",!0),l(F,{label:t.$t("items.description"),error:o(S).description.$error&&o(S).description.$errors[0].$message},{default:v(()=>[l(ee,{modelValue:o(c).currentItem.description,"onUpdate:modelValue":f[5]||(f[5]=B=>o(c).currentItem.description=B),rows:"4",cols:"50",invalid:o(S).description.$error,onInput:f[6]||(f[6]=B=>o(S).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),s("div",Vt,[l(Q,{class:"mr-3",variant:"primary-outline",type:"button",onClick:h},{default:v(()=>[L(T(t.$t("general.cancel")),1)]),_:1}),l(Q,{loading:C.value,disabled:C.value,variant:"primary",type:"submit"},{left:v(B=>[l(y,{name:"SaveIcon",class:W(B.class)},null,8,["class"])]),default:v(()=>[L(" "+T(o(c).isEdit?t.$t("general.update"):t.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},qt={class:"flex justify-between w-full"},Dt={class:"flex flex-col"},Lt={class:"text-sm text-gray-500 mt-1"},Et={class:"p-4 sm:p-6"},At={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ut={__name:"TaxationAddressModal",emits:["addTax"],setup(m,{emit:g}){const p=ie();Ee();const e=Ae({state:"",city:"",address_street_1:"",zip:""}),c=N(!1),M=ve(),{t:i}=re(),b=u(()=>p.active&&p.componentName==="TaxationAddressModal"),C=u(()=>({state:{required:D.withMessage(i("validation.required"),Y)},city:{required:D.withMessage(i("validation.required"),Y)},address_street_1:{required:D.withMessage(i("validation.required"),Y)},zip:{required:D.withMessage(i("validation.required"),Y)}})),n=me(C,u(()=>e));async function k(){if(n.value.$touch(),n.value.$invalid)return!0;let $={address:e};p.id&&($.customer_id=p.id),e.address_street_1=e.address_street_1.replace(/(\r\n|\n|\r)/gm,""),c.value=!0,await M.fetchSalesTax($).then(_=>{c.value=!1,q("addTax",_.data.data),E()}).catch(_=>{c.value=!1})}const q=g;function A(){var $,_,I,S;e.state=($=p==null?void 0:p.data)==null?void 0:$.state,e.city=(_=p==null?void 0:p.data)==null?void 0:_.city,e.address_street_1=(I=p==null?void 0:p.data)==null?void 0:I.address_street_1,e.zip=(S=p==null?void 0:p.data)==null?void 0:S.zip}function E(){p.closeModal()}return($,_)=>{const I=w("BaseIcon"),S=w("BaseInput"),z=w("BaseInputGroup"),d=w("BaseTextarea"),h=w("BaseInputGrid"),t=w("BaseButton"),f=w("BaseModal");return x(),V(f,{show:b.value,onClose:E,onOpen:A},{header:v(()=>[s("div",qt,[s("div",Dt,[L(T(o(p).title)+" ",1),s("p",Lt,T(o(p).content),1)]),l(I,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:E})])]),default:v(()=>[s("form",{onSubmit:$e(k,["prevent"])},[s("div",Et,[l(h,{layout:"one-column"},{default:v(()=>[l(z,{required:"",error:o(n).state.$error&&o(n).state.$errors[0].$message,label:$.$t("customers.state")},{default:v(()=>[l(S,{modelValue:e.state,"onUpdate:modelValue":_[0]||(_[0]=y=>e.state=y),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:o(n).state.$error,onInput:_[1]||(_[1]=y=>o(n).state.$touch()),placeholder:$.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),l(z,{required:"",error:o(n).city.$error&&o(n).city.$errors[0].$message,label:$.$t("customers.city")},{default:v(()=>[l(S,{modelValue:e.city,"onUpdate:modelValue":_[2]||(_[2]=y=>e.city=y),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:o(n).city.$error,onInput:_[3]||(_[3]=y=>o(n).city.$touch()),placeholder:$.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),l(z,{required:"",error:o(n).address_street_1.$error&&o(n).address_street_1.$errors[0].$message,label:$.$t("customers.address")},{default:v(()=>[l(d,{modelValue:e.address_street_1,"onUpdate:modelValue":_[4]||(_[4]=y=>e.address_street_1=y),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:o(n).address_street_1.$error,onInput:_[5]||(_[5]=y=>o(n).address_street_1.$touch()),placeholder:$.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),l(z,{required:"",error:o(n).zip.$error&&o(n).zip.$errors[0].$message,label:$.$t("customers.zip_code")},{default:v(()=>[l(S,{modelValue:e.zip,"onUpdate:modelValue":_[6]||(_[6]=y=>e.zip=y),invalid:o(n).zip.$error,onInput:_[7]||(_[7]=y=>o(n).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:$.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),s("div",At,[l(t,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:E},{default:v(()=>[L(T($.$t("general.cancel")),1)]),_:1}),l(t,{loading:c.value,variant:"primary",type:"submit"},{left:v(y=>[c.value?K("",!0):(x(),V(I,{key:0,name:"SaveIcon",class:W(y.class)},null,8,["class"]))]),default:v(()=>[L(" "+T($.$t("general.save")),1)]),_:1},8,["loading"])])],32)]),_:1},8,["show"])}}},ue="Sales Tax",pe="MODULE",Gt={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(m){const g=ie(),p=ne(),e=ve(),{t:c}=re(),M=N(!1),i=m,b=u(()=>i.isEdit?i.store[i.storeProp].sales_tax_address_type==="billing":p.selectedCompanySettings.sales_tax_address_type==="billing"),C=u(()=>p.selectedCompanySettings.sales_tax_us_enabled==="YES"),n=u(()=>i.isEdit?i.store[i.storeProp].sales_tax_type==="customer_level":p.selectedCompanySettings.sales_tax_type==="customer_level"),k=u(()=>i.isEdit?i.store[i.storeProp].sales_tax_type==="company_level":p.selectedCompanySettings.sales_tax_type==="company_level"),q=u(()=>{if(n.value&&A.value){let d=b.value?i.customer.billing:i.customer.shipping;return{address:J.exports.pick(d,["address_street_1","city","state","zip"]),customer_id:i.customer.id}}else if(k.value&&A.value)return{address:J.exports.pick(address,["address_street_1","city","state","zip"])}}),A=u(()=>{var d,h;if(n.value){let t=b.value?(d=i.customer)==null?void 0:d.billing:(h=i.customer)==null?void 0:h.shipping;return E(t)}else if(k.value)return E(p.selectedCompany.address);return!1});xe(()=>i.customer,(d,h)=>{if(d&&h&&n.value){$(d,h);return}!A.value&&n.value&&d?setTimeout(()=>{_()},500):n.value&&d?I():n.value&&!d&&z()}),be(()=>{k.value&&(A.value?I():_())});function E(d){return d?d.address_street_1&&d.city&&d.state&&d.zip:!1}function $(d,h){const t=b.value?d.billing:d.shipping,f=b.value?h.billing:h.shipping,y=J.exports.pick(t,["address_street_1","city","state","zip"]),H=J.exports.pick(f,["address_street_1","city","state","zip"]);J.exports.isEqual(y,H)||I()}function _(){var t,f;if(!C.value)return;let d=null,h="";n.value?b.value?(d=(t=i.customer)==null?void 0:t.billing,h=c("settings.taxations.add_billing_address")):(d=(f=i.customer)==null?void 0:f.shipping,h=c("settings.taxations.add_shipping_address")):(d=p.selectedCompany.address,h=c("settings.taxations.add_company_address")),g.openModal({title:h,content:c("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:d,id:n.value?i.customer.id:""})}async function I(){!C.value||(M.value=!0,await e.fetchSalesTax(q.value).then(d=>{S(d.data.data),M.value=!1}).catch(d=>{d.response.data.error&&setTimeout(()=>{_()},500),M.value=!1}))}function S(d){d.tax_type_id=d.id;const h=i.store[i.storeProp].taxes.findIndex(t=>t.name===ue&&t.type===pe);h>-1?Object.assign(i.store[i.storeProp].taxes[h],d):i.store[i.storeProp].taxes.push(d)}function z(){const d=i.store[i.storeProp].taxes.findIndex(t=>t.name===ue&&t.type===pe);d>-1&&i.store[i.storeProp].taxes.splice(d,1);let h=e.taxTypes.findIndex(t=>t.name===ue&&t.type===pe);h>-1&&e.taxTypes.splice(h,1)}return(d,h)=>(x(),V(Ut,{onAddTax:S}))}};export{Ft as _,Ot as a,Gt as b,Nt as c};
