import{ac as Q,ag as W,J as X,H as Y,p as a,l as ee,m as te,M as se,d as p,e as _,v as ae,r as l,o as B,j as S,h as u,b as m,a as r,n as re,z as oe,t as b,x as e,g as q,c as ne,w as le,q as $,L as w,ah as V,s as ie,a0 as ue,ai as ce,aj as h}from"./main.16f93141.js";import{u as de}from"./users.0e4f36ce.js";import{_ as me}from"./CreateCustomFields.e65a9d58.js";const ge={class:"flex items-center justify-end"},pe={class:"grid grid-cols-5 gap-4 mb-8"},_e={class:"col-span-5 text-lg font-semibold text-left lg:col-span-1"},ve={class:"grid grid-cols-5 gap-2 mb-8"},fe={key:0,class:"col-span-5 text-lg font-semibold text-left lg:col-span-1"},he={class:"col-span-5 lg:col-span-4"},x="customFields",we={__name:"Create",setup(Ce){const t=Q(),M=W(),F=X(),L=Y(),R=de(),k=a.regex(/^([A-Z&]{3,4})\d{6}(?:[A-Z\d]{3})?$/),{t:s}=ee(),D=te(),G=se();let d=p(!1);p(!1),p(!1),p(!1);const v=p(!1),g=_(()=>G.name==="customers.edit");let P=_(()=>t.isFetchingInitialSettings);const y=_(()=>g.value?s("customers.edit_customer"):s("customers.new_customer")),U=_(()=>({currentCustomer:{name:{required:a.withMessage(s("validation.required"),$),minLength:a.withMessage(s("validation.name_min_length",{count:3}),w(3))},rfc:{required:a.withMessage(s("validation.required"),$),validRFC:a.withMessage("El formato del RFC no es correcto",k)},prefix:{minLength:a.withMessage(s("validation.name_min_length",{count:3}),w(3))},currency_id:{required:a.withMessage(s("validation.required"),$)},email:{required:a.withMessage(s("validation.required"),V(t.currentCustomer.enable_portal==!0)),email:a.withMessage(s("validation.email_incorrect"),ie)},password:{required:a.withMessage(s("validation.required"),V(t.currentCustomer.enable_portal==!0&&!t.currentCustomer.password_added)),minLength:a.withMessage(s("validation.password_min_length",{count:8}),w(8))},confirm_password:{sameAsPassword:a.withMessage(s("validation.password_incorrect"),ue(t.currentCustomer.password))},website:{url:a.withMessage(s("validation.invalid_url"),ce)},billing:{address_street_1:{maxLength:a.withMessage(s("validation.address_maxlength",{count:255}),h(255))},address_street_2:{maxLength:a.withMessage(s("validation.address_maxlength",{count:255}),h(255))}},shipping:{address_street_1:{maxLength:a.withMessage(s("validation.address_maxlength",{count:255}),h(255))},address_street_2:{maxLength:a.withMessage(s("validation.address_maxlength",{count:255}),h(255))}}}}));_(()=>`${window.location.origin}/${L.selectedCompany.slug}/customer/login`);const o=ae(U,t,{$scope:x});t.resetCurrentCustomer(),t.fetchCustomerInitialSettings(g.value),R.fetchUsers();async function A(){if(o.value.$touch(),o.value.$invalid)return!0;v.value=!0;let i={...t.currentCustomer},n=null;try{n=await(g.value?t.updateCustomer:t.addCustomer)(i)}catch{v.value=!1;return}D.push(`/admin/customers/${n.data.data.id}/view`)}return(i,n)=>{const f=l("BaseBreadcrumbItem"),N=l("BaseBreadcrumb-item"),j=l("BaseBreadcrumb"),E=l("BaseIcon"),H=l("BaseButton"),z=l("BasePageHeader"),I=l("BaseInput"),C=l("BaseInputGroup"),T=l("BaseMultiselect"),Z=l("BaseInputGrid"),J=l("BaseDivider"),K=l("BaseCard"),O=l("BasePage");return B(),S(O,null,{default:u(()=>[m("form",{onSubmit:le(A,["prevent"])},[r(z,{title:y.value},{actions:u(()=>[m("div",ge,[r(H,{type:"submit",loading:v.value,disabled:v.value},{left:u(c=>[r(E,{name:"SaveIcon",class:re(c.class)},null,8,["class"])]),default:u(()=>[oe(" "+b(g.value?i.$t("customers.update_customer"):i.$t("customers.save_customer")),1)]),_:1},8,["loading","disabled"])])]),default:u(()=>[r(j,null,{default:u(()=>[r(f,{title:i.$t("general.home"),to:"dashboard"},null,8,["title"]),r(f,{title:i.$tc("customers.customer",2),to:"/admin/customers"},null,8,["title"]),r(N,{title:y.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r(K,{class:"mt-5"},{default:u(()=>[m("div",pe,[m("h6",_e,b(i.$t("customers.basic_info")),1),r(Z,{class:"col-span-5 lg:col-span-4"},{default:u(()=>[r(C,{label:i.$t("customers.rfc"),required:"",error:e(o).currentCustomer.rfc.$error&&e(o).currentCustomer.rfc.$errors[0].$message,"content-loading":e(d)},{default:u(()=>[r(I,{modelValue:e(t).currentCustomer.rfc,"onUpdate:modelValue":n[0]||(n[0]=c=>e(t).currentCustomer.rfc=c),"content-loading":e(d),type:"text",name:"name",class:"",invalid:e(o).currentCustomer.rfc.$error,onInput:n[1]||(n[1]=c=>e(o).currentCustomer.rfc.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","error","content-loading"]),r(C,{label:i.$t("customers.legal_name"),required:"",error:e(o).currentCustomer.name.$error&&e(o).currentCustomer.name.$errors[0].$message,"content-loading":e(d)},{default:u(()=>[r(I,{modelValue:e(t).currentCustomer.name,"onUpdate:modelValue":n[2]||(n[2]=c=>e(t).currentCustomer.name=c),"content-loading":e(d),type:"text",name:"name",class:"",invalid:e(o).currentCustomer.name.$error,onInput:n[3]||(n[3]=c=>e(o).currentCustomer.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","error","content-loading"]),r(C,{label:"Regimen Fiscal","content-loading":e(d),error:e(o).currentCustomer.currency_id.$error&&e(o).currentCustomer.currency_id.$errors[0].$message,required:""},{default:u(()=>[r(T,{modelValue:e(t).currentCustomer.sat_regime_id,"onUpdate:modelValue":n[4]||(n[4]=c=>e(t).currentCustomer.sat_regime_id=c),"value-prop":"id",label:"name","track-by":"name","content-loading":e(d),options:e(F).satRegimes,searchable:"","can-deselect":!1,placeholder:i.$t("customers.select_currency"),invalid:e(o).currentCustomer.currency_id.$error,class:"w-full"},null,8,["modelValue","content-loading","options","placeholder","invalid"])]),_:1},8,["content-loading","error"])]),_:1})]),e(M).customFields.length>0?(B(),S(J,{key:0,class:"mb-5 md:mb-8"})):q("",!0),m("div",ve,[e(M).customFields.length>0?(B(),ne("h6",fe,b(i.$t("settings.custom_fields.title")),1)):q("",!0),m("div",he,[r(me,{type:"Customer",store:e(t),"store-prop":"currentCustomer","is-edit":g.value,"is-loading":e(P),"custom-field-scope":x},null,8,["store","is-edit","is-loading"])])])]),_:1})],32)]),_:1})}}};export{we as default};
