import{a3 as E,e as _,a6 as z,r as m,o as s,c as r,b as d,t as c,a as n,I as U,aw as Y,N as Q,l as R,d as V,h as i,x as B,aO as G,n as W,z as j,O as H,aP as X,F as L,i as N,Q as F,g as k,aQ as J,H as K,j as x,ap as Z}from"./main.77709028.js";const ee={class:"flex items-center justify-between w-full mt-2 text-sm"},te={class:"font-semibold leading-5 text-gray-500 uppercase"},oe={class:"flex items-center justify-center text-lg text-black"},se={__name:"CreateTotalTaxes",props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(t,{emit:S}){const e=t,v=S;E("$utils");const P=_(()=>e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);z(()=>{e.store.getSubtotalWithDiscount&&f(),e.store.getTotalSimpleTax&&f()});function f(){v("update",{...e.tax,amount:P.value})}return(T,p)=>{const b=m("BaseFormatMoney"),w=m("BaseIcon");return s(),r("div",ee,[d("label",te,c(t.tax.name)+" ("+c(t.tax.percent)+" %) ",1),d("label",oe,[n(b,{amount:t.tax.amount,currency:t.currency},null,8,["amount","currency"]),n(w,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:p[0]||(p[0]=C=>T.$emit("remove",t.tax.id))})])])}}},ae={class:"w-full mt-4 tax-select"},ne={class:"relative w-full max-w-md px-4"},re={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},le={class:"relative bg-white"},ie={class:"relative p-4"},ce={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},ue=["onClick"],de={class:"flex justify-between px-2"},me={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},pe={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},ye={key:1,class:"flex justify-center p-5 text-gray-400"},xe={class:"text-base text-gray-500 cursor-pointer"},fe={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},be={__name:"SelectTaxPopup",props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(t,{emit:S}){const e=t,v=S,P=U(),f=Y(),T=Q(),{t:p}=R(),b=V(null),w=_(()=>b.value?f.taxTypes.filter(function(o){return o.name.toLowerCase().indexOf(b.value.toLowerCase())!==-1}):f.taxTypes),C=_(()=>e.store[e.storeProp].taxes);function I(o,l){v("select:taxType",{...o}),l()}function D(){P.openModal({title:p("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:o=>v("select:taxType",o)})}return(o,l)=>{const a=m("BaseIcon"),u=m("BaseInput");return s(),r("div",ae,[n(B(J),{class:"relative"},{default:i(({isOpen:h})=>[n(B(G),{class:W([h?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:i(()=>[n(a,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),j(" "+c(o.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),d("div",ne,[n(H,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:i(()=>[n(B(X),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:i(({close:M})=>[d("div",re,[d("div",le,[d("div",ie,[n(u,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=g=>b.value=g),placeholder:o.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),w.value.length>0?(s(),r("div",ce,[(s(!0),r(L,null,N(w.value,(g,O)=>(s(),r("div",{key:O,class:W([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":C.value.find($=>$.tax_type_id===g.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:$=>I(g,M)},[d("div",de,[d("label",me,c(g.name),1),d("label",pe,c(g.percent)+" % ",1)])],10,ue))),128))])):(s(),r("div",ye,[d("label",xe,c(o.$t("general.no_tax_found")),1)]))]),B(T).hasAbilities(B(F).CREATE_TAX_TYPE)?(s(),r("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:D},[n(a,{name:"CheckCircleIcon",class:"text-primary-400"}),d("label",fe,c(o.$t("estimates.add_new_tax")),1)])):k("",!0)])]),_:1})]),_:1})])]),_:1})])}}},ge={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},he={class:"flex items-center justify-between w-full"},_e={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},ve={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},Pe={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},we={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ke={key:0,class:"flex items-center justify-between w-full mt-2"},Se={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},Te={key:3,class:"flex",style:{width:"140px"},role:"group"},$e={class:"flex items-center"},Be={key:1},Ce={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},je={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},Ie={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},Me={__name:"CreateTotal",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(t){const S=V(null),e=t;E("$utils");const v=K(),P=_({get:()=>e.store[e.storeProp].discount,set:o=>{e.store[e.storeProp].discount_type==="percentage"?e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*o/100):e.store[e.storeProp].discount_val=Math.round(o*100),e.store[e.storeProp].discount=o}}),f=_({get:()=>e.store[e.storeProp].taxes,set:o=>{e.store.$patch(l=>{l[e.storeProp].taxes=o})}}),T=_(()=>{let o=[];return e.store[e.storeProp].items.forEach(l=>{l.taxes&&l.taxes.forEach(a=>{let u=o.find(h=>h.tax_type_id===a.tax_type_id);u?u.amount+=a.amount:a.tax_type_id&&o.push({tax_type_id:a.tax_type_id,amount:a.amount,percent:a.percent,name:a.name})})}),o}),p=_(()=>e.currency?e.currency:v.selectedCompanyCurrency);function b(){e.store[e.storeProp].discount_type!=="fixed"&&(e.store[e.storeProp].discount_val=Math.round(e.store[e.storeProp].discount*100),e.store[e.storeProp].discount_type="fixed")}function w(){e.store[e.storeProp].discount_type!=="percentage"&&(e.store[e.storeProp].discount_val=e.store.getSubTotal*e.store[e.storeProp].discount/100,e.store[e.storeProp].discount_type="percentage")}function C(o){let l=0;o.compound_tax&&e.store.getSubtotalWithDiscount?l=Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*o.percent/100):e.store.getSubtotalWithDiscount&&o.percent&&(l=Math.round(e.store.getSubtotalWithDiscount*o.percent/100));let a={...F,id:Z.raw(),name:o.name,percent:o.percent,compound_tax:o.compound_tax,tax_type_id:o.id,amount:l};e.store.$patch(u=>{u[e.storeProp].taxes.push({...a})})}function I(o){const l=e.store[e.storeProp].taxes.find(a=>a.id===o.id);l&&Object.assign(l,{...o})}function D(o){const l=e.store[e.storeProp].taxes.findIndex(a=>a.id===o);e.store.$patch(a=>{a[e.storeProp].taxes.splice(l,1)})}return(o,l)=>{const a=m("BaseContentPlaceholdersText"),u=m("BaseContentPlaceholders"),h=m("BaseFormatMoney"),M=m("BaseInput"),g=m("BaseIcon"),O=m("BaseButton"),$=m("BaseDropdownItem"),A=m("BaseDropdown");return s(),r("div",ge,[d("div",he,[t.isLoading?(s(),x(u,{key:0},{default:i(()=>[n(a,{lines:1,class:"w-16 h-5"})]),_:1})):(s(),r("label",_e,c(o.$t("estimates.sub_total")),1)),t.isLoading?(s(),x(u,{key:2},{default:i(()=>[n(a,{lines:1,class:"w-16 h-5"})]),_:1})):(s(),r("label",ve,[n(h,{amount:t.store.getSubTotal,currency:p.value},null,8,["amount","currency"])]))]),(s(!0),r(L,null,N(T.value,y=>(s(),r("div",{key:y.tax_type_id,class:"flex items-center justify-between w-full"},[t.isLoading?(s(),x(u,{key:0},{default:i(()=>[n(a,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(s(),r("label",Pe,c(y.name)+" - "+c(y.percent)+"% ",1)):k("",!0),t.isLoading?(s(),x(u,{key:2},{default:i(()=>[n(a,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(s(),r("label",we,[n(h,{amount:y.amount,currency:p.value},null,8,["amount","currency"])])):k("",!0)]))),128)),t.store[t.storeProp].discount_per_item==="NO"||t.store[t.storeProp].discount_per_item===null?(s(),r("div",ke,[t.isLoading?(s(),x(u,{key:0},{default:i(()=>[n(a,{lines:1,class:"w-16 h-5"})]),_:1})):(s(),r("label",Se,c(o.$t("estimates.discount")),1)),t.isLoading?(s(),x(u,{key:2},{default:i(()=>[n(a,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(s(),r("div",Te,[n(M,{modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=y=>P.value=y),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),n(A,{position:"bottom-end"},{activator:i(()=>[n(O,{class:"p-2 rounded-none rounded-tr-md rounded-br-md",type:"button",variant:"white"},{default:i(()=>[d("span",$e,[j(c(t.store[t.storeProp].discount_type=="fixed"?p.value.symbol:"%")+" ",1),n(g,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1})]),default:i(()=>[n($,{onClick:b},{default:i(()=>[j(c(o.$t("general.fixed")),1)]),_:1}),n($,{onClick:w},{default:i(()=>[j(c(o.$t("general.percentage")),1)]),_:1})]),_:1})]))])):k("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(s(),r("div",Be,[(s(!0),r(L,null,N(f.value,(y,q)=>(s(),x(se,{key:y.id,index:q,tax:y,taxes:f.value,currency:t.currency,store:t.store,onRemove:D,onUpdate:I},null,8,["index","tax","taxes","currency","store"]))),128))])):k("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(s(),r("div",{key:2,ref_key:"taxModal",ref:S,class:"float-right pt-2 pb-4"},[n(be,{"store-prop":t.storeProp,store:t.store,type:t.taxPopupType,"onSelect:taxType":C},null,8,["store-prop","store","type"])],512)):k("",!0),d("div",Ce,[t.isLoading?(s(),x(u,{key:0},{default:i(()=>[n(a,{lines:1,class:"w-16 h-5"})]),_:1})):(s(),r("label",je,c(o.$t("estimates.total"))+" "+c(o.$t("estimates.amount"))+":",1)),t.isLoading?(s(),x(u,{key:2},{default:i(()=>[n(a,{lines:1,class:"w-16 h-5"})]),_:1})):(s(),r("label",Ie,[n(h,{amount:t.store.getTotal,currency:p.value},null,8,["amount","currency"])]))])])}}};export{Me as _};
