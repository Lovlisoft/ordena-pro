var ue=Object.defineProperty;var F=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var R=(_,s,c)=>s in _?ue(_,s,{enumerable:!0,configurable:!0,writable:!0,value:c}):_[s]=c,L=(_,s)=>{for(var c in s||(s={}))me.call(s,c)&&R(_,c,s[c]);if(F)for(var c of F(s))ie.call(s,c)&&R(_,c,s[c]);return _};import{G as ce,aN as de,ah as ye,J as pe,B as V,a0 as _e,k as I,L as $,M as w,aX as ve,O as fe,aP as Pe,T as ge,a7 as be,b1 as Be,r as m,o as q,e as $e,f as r,w as l,h as j,u as e,l as N,m as T,j as U,i as k,t as b,x as he,U as Ie,F as Ce}from"./vendor.ae2d842a.js";import{_ as Se}from"./ExchangeRateConverter.9ec2bb40.js";import{u as Me,l as Ve,m as we,b as qe,c as ke,i as je,d as Ne}from"./main.88a58514.js";import{u as Ue}from"./payment.b2a65568.js";import{_ as Ae}from"./PaymentModeModal.39caf8f9.js";import"./exchange-rate.8fabf773.js";const Ee=["onSubmit"],De={class:"absolute left-3.5"},xe={class:"relative w-full"},Je={setup(_){const s=ce(),c=de(),t=Ue();Me();const C=Ve();we(),qe();const H=ke(),A=je();Ne();const E=ye("utils"),{t:p}=pe();let P=V(!1),S=V(!1),g=V([]);const M=V([]),z="newEstimate";_e(["customer","company","customerCustom","payment","paymentCustom"]);const h=I({get:()=>t.currentPayment.amount/100,set:n=>{t.currentPayment.amount=Math.round(n*100)}}),u=I(()=>t.isFetchingInitialData),y=I(()=>s.name==="payments.edit"),D=I(()=>y.value?p("payments.edit_payment"):p("payments.new_payment")),J=I(()=>({currentPayment:{customer_id:{required:$.withMessage(p("validation.required"),w)},payment_date:{required:$.withMessage(p("validation.required"),w)},amount:{required:$.withMessage(p("validation.required"),w),between:$.withMessage(p("validation.payment_greater_than_due_amount"),ve(0,t.currentPayment.maxPayableAmount))},exchange_rate:{required:fe(function(){return $.withMessage(p("validation.required"),w),t.showExchangeRate}),decimal:$.withMessage(p("validation.valid_exchange_rate"),Pe)}}})),i=ge(J,t,{$scope:z});be(()=>{t.currentPayment.customer_id&&Q(t.currentPayment.customer_id),s.query.customer&&(t.currentPayment.customer_id=s.query.customer)}),t.resetCurrentPayment(),s.query.customer&&(t.currentPayment.customer_id=s.query.customer),t.fetchPaymentInitialData(y.value),s.params.id&&!y.value&&X();async function O(){H.openModal({title:p("settings.payment_modes.add_payment_mode"),componentName:"PaymentModeModal"})}async function X(){var a;let n=await A.fetchInvoice((a=s==null?void 0:s.params)==null?void 0:a.id);t.currentPayment.customer_id=n.data.data.customer.id,t.currentPayment.invoice_id=n.data.data.id}async function K(n){if(n){let a=0;t.currentPayment.selectedInvoices.forEach(function(d){a=a+d.due_amount}),t.currentPayment.maxPayableAmount=a}console.log(t.currentPayment.maxPayableAmount)}function Q(n){if(n){let a={customer_id:n,status:"DUE",limit:"all"};y.value&&(a.status=""),S.value=!0,Promise.all([A.fetchInvoices(a),C.fetchCustomer(n)]).then(async([d,v])=>{d&&(g.value=[...d.data.data]),v&&v.data&&(t.currentPayment.selectedCustomer=v.data.data,t.currentPayment.customer=v.data.data,t.currentPayment.currency=v.data.data.currency,y.value&&!C.editCustomer&&t.currentPayment.customer_id&&(C.editCustomer=v.data.data)),t.currentPayment.invoice_id&&(M.value=g.value.find(f=>f.id===t.currentPayment.invoice_id),t.currentPayment.maxPayableAmount=M.value.due_amount+t.currentPayment.amount,h.value===0&&(h.value=M.value.due_amount/100)),y.value&&(g.value=g.value.filter(f=>f.due_amount>0||f.id==t.currentPayment.invoice_id)),S.value=!1}).catch(d=>{S.value=!1,console.error(d,"error")})}}Be(()=>{t.resetCurrentPayment(),g.value=[],C.editCustomer=null});async function W(){if(i.value.$touch(),i.value.$invalid)return!1;P.value=!0;let n=L({},t.currentPayment),a=null;try{a=await(y.value?t.updatePayment:t.addPayment)(n),c.push(`/admin/payments/${a.data.data.id}/view`)}catch{P.value=!1}}function Y(n){let a={userId:n};s.params.id&&(a.model_id=s.params.id),t.currentPayment.invoice_id=M.value=null,t.currentPayment.amount=0,g.value=[],t.getNextNumber(a,!0)}return(n,a)=>{const d=m("BaseBreadcrumbItem"),v=m("BaseBreadcrumb"),f=m("BaseIcon"),x=m("BaseButton"),Z=m("BasePageHeader"),ee=m("BaseDatePicker"),B=m("BaseInputGroup"),te=m("BaseInput"),ae=m("BaseCustomerSelectInput"),G=m("BaseMultiselect"),ne=m("BaseMoney"),oe=m("BaseSelectAction"),re=m("BaseInputGrid"),se=m("BaseCard"),le=m("BasePage");return q(),$e(Ce,null,[r(Ae),r(le,{class:"relative payment-create"},{default:l(()=>[j("form",{action:"",onSubmit:Ie(W,["prevent"])},[r(Z,{title:e(D),class:"mb-5"},{actions:l(()=>[r(x,{loading:e(P),disabled:e(P),variant:"primary",type:"submit",class:"hidden sm:flex"},{left:l(o=>[e(P)?U("",!0):(q(),N(f,{key:0,name:"SaveIcon",class:T(o.class)},null,8,["class"]))]),default:l(()=>[k(" "+b(e(y)?n.$t("payments.update_payment"):n.$t("payments.save_payment")),1)]),_:1},8,["loading","disabled"])]),default:l(()=>[r(v,null,{default:l(()=>[r(d,{title:n.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),r(d,{title:n.$tc("payments.payment",2),to:"/admin/payments"},null,8,["title"]),r(d,{title:e(D),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r(se,null,{default:l(()=>[r(re,null,{default:l(()=>[r(B,{label:n.$t("payments.date"),"content-loading":e(u),required:"",error:e(i).currentPayment.payment_date.$error&&e(i).currentPayment.payment_date.$errors[0].$message},{default:l(()=>[r(ee,{modelValue:e(t).currentPayment.payment_date,"onUpdate:modelValue":[a[0]||(a[0]=o=>e(t).currentPayment.payment_date=o),a[1]||(a[1]=o=>e(i).currentPayment.payment_date.$touch())],"content-loading":e(u),"calendar-button":!0,"calendar-button-icon":"calendar",invalid:e(i).currentPayment.payment_date.$error},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),r(B,{label:n.$t("payments.payment_number"),"content-loading":e(u),required:""},{default:l(()=>[r(te,{modelValue:e(t).currentPayment.payment_number,"onUpdate:modelValue":a[2]||(a[2]=o=>e(t).currentPayment.payment_number=o),"content-loading":e(u)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),r(B,{label:n.$t("payments.customer"),error:e(i).currentPayment.customer_id.$error&&e(i).currentPayment.customer_id.$errors[0].$message,"content-loading":e(u),required:""},{default:l(()=>[e(u)?U("",!0):(q(),N(ae,{key:0,modelValue:e(t).currentPayment.customer_id,"onUpdate:modelValue":[a[3]||(a[3]=o=>e(t).currentPayment.customer_id=o),a[4]||(a[4]=o=>Y(e(t).currentPayment.customer_id))],"content-loading":e(u),invalid:e(i).currentPayment.customer_id.$error,placeholder:n.$t("customers.select_a_customer"),"show-action":""},null,8,["modelValue","content-loading","invalid","placeholder"]))]),_:1},8,["label","error","content-loading"]),r(B,{"content-loading":e(u),label:n.$t("payments.invoice"),"help-text":e(t).currentPayment.selectedInvoices?`Monto a pagar: ${e(t).currentPayment.maxPayableAmount/100}`:""},{default:l(()=>[r(G,{modelValue:e(t).currentPayment.selectedInvoices,"onUpdate:modelValue":a[5]||(a[5]=o=>e(t).currentPayment.selectedInvoices=o),mode:"tags",object:!0,label:"invoice_number",options:e(g),"content-loading":e(u),"value-prop":"id","track-by":"invoice_number",loading:e(S),placeholder:n.$t("invoices.select_invoice"),"can-deselect":!0,onSelect:K},{singlelabel:l(({value:o})=>[j("div",De,b(o.invoice_number)+" ("+b(e(E).formatMoney(o.total,o.customer.currency))+") ",1)]),option:l(({option:o})=>[k(b(o.invoice_number)+" ("+b(e(E).formatMoney(o.total,o.customer.currency))+") ",1)]),_:1},8,["modelValue","options","content-loading","loading","placeholder"])]),_:1},8,["content-loading","label","help-text"]),r(B,{label:n.$t("payments.amount"),"content-loading":e(u),error:e(i).currentPayment.amount.$error&&e(i).currentPayment.amount.$errors[0].$message,required:""},{default:l(()=>[j("div",xe,[r(ne,{key:e(t).currentPayment.currency,modelValue:e(h),"onUpdate:modelValue":[a[6]||(a[6]=o=>he(h)?h.value=o:null),a[7]||(a[7]=o=>e(i).currentPayment.amount.$touch())],currency:e(t).currentPayment.currency,"content-loading":e(u),invalid:e(i).currentPayment.amount.$error},null,8,["modelValue","currency","content-loading","invalid"])])]),_:1},8,["label","content-loading","error"]),r(B,{"content-loading":e(u),label:n.$t("payments.payment_mode")},{default:l(()=>[r(G,{modelValue:e(t).currentPayment.payment_method_id,"onUpdate:modelValue":a[8]||(a[8]=o=>e(t).currentPayment.payment_method_id=o),"content-loading":e(u),label:"name","value-prop":"id","track-by":"name",options:e(t).paymentModes,placeholder:n.$t("payments.select_payment_mode"),searchable:""},{action:l(()=>[r(oe,{onClick:O},{default:l(()=>[r(f,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),k(" "+b(n.$t("settings.payment_modes.add_payment_mode")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),r(Se,{store:e(t),"store-prop":"currentPayment",v:e(i).currentPayment,"is-loading":e(u),"is-edit":e(y),"customer-currency":e(t).currentPayment.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1}),r(x,{loading:e(P),"content-loading":e(u),variant:"primary",type:"submit",class:"flex justify-center w-full mt-4 sm:hidden md:hidden"},{left:l(o=>[e(P)?U("",!0):(q(),N(f,{key:0,name:"SaveIcon",class:T(o.class)},null,8,["class"]))]),default:l(()=>[k(" "+b(e(y)?n.$t("payments.update_payment"):n.$t("payments.save_payment")),1)]),_:1},8,["loading","content-loading"])]),_:1})],40,Ee)]),_:1})],64)}}};export{Je as default};
