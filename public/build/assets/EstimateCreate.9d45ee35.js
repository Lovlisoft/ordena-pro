import{ab as x,r as o,o as d,c as L,a,x as t,h as i,n as M,ax as D,H as O,ag as W,l as Y,d as h,M as A,m as J,e as f,p as _,q as y,aj as K,ah as Q,W as X,v as Z,E as ee,j as v,g as S,b as C,t as q,z as te,w as ae,F as se}from"./main.67344fb0.js";import{_ as ne,a as oe,b as ie,c as re}from"./SalesTax.fa1790ec.js";/* empty css                                                  */import{_ as le}from"./ExchangeRateConverter.bfcdbe7b.js";import{_ as me}from"./TaxTypeModal.a9e7fab2.js";import"./DragIcon.97c3bac4.js";import"./exchange-rate.18a1e4db.js";const ue={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},ce={__name:"EstimateCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(s){const e=x();return(w,r)=>{const E=o("BaseCustomerSelectPopup"),l=o("BaseInput"),c=o("BaseInputGroup"),b=o("BaseIcon"),$=o("BaseSwitch"),g=o("BaseInputGrid");return d(),L("div",ue,[a(E,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":r[0]||(r[0]=m=>t(e).newEstimate.customer=m),valid:s.v.customer_id,"content-loading":s.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),a(g,{class:"col-span-7"},{default:i(()=>[a(c,{label:w.$t("estimates.estimate_number"),"content-loading":s.isLoading,required:"",error:s.v.estimate_number.$error&&s.v.estimate_number.$errors[0].$message},{default:i(()=>[a(l,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":r[1]||(r[1]=m=>t(e).newEstimate.estimate_number=m),"content-loading":s.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(c,{label:w.$t("estimates.show_price_breakdown"),"content-loading":s.isLoading,error:s.v.reference_number.$error&&s.v.reference_number.$errors[0].$message},{default:i(()=>[a($,{modelValue:t(e).newEstimate.show_price_breakdown,"onUpdate:modelValue":r[2]||(r[2]=m=>t(e).newEstimate.show_price_breakdown=m),"content-loading":s.isLoading,onInput:r[3]||(r[3]=m=>s.v.reference_number.$touch())},{left:i(m=>[a(b,{name:"HashtagIcon",class:M(m.class)},null,8,["class"])]),_:1},8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(le,{store:t(e),"store-prop":"newEstimate",v:s.v,"is-loading":s.isLoading,"is-edit":s.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},de={class:"flex"},ge=C("div",{class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},null,-1),V="newEstimate",ye={__name:"EstimateCreate",setup(s){const e=x(),w=D(),r=O(),E=W(),{t:l}=Y();let c=h(!1);h(!1),h(["customer","company","customerCustom","estimate","estimateCustom"]);let b=A(),$=J(),g=f(()=>e.isFetchingInitialSettings),m=f(()=>p.value?l("estimates.edit_estimate"):l("estimates.new_estimate")),p=f(()=>b.name==="estimates.edit");const F=f(()=>r.selectedCompanySettings.sales_tax_us_enabled==="YES"&&w.salesTaxUSEnabled),P={estimate_date:{required:_.withMessage(l("validation.required"),y)},estimate_number:{required:_.withMessage(l("validation.required"),y)},reference_number:{maxLength:_.withMessage(l("validation.price_maxlength"),K(255))},customer_id:{required:_.withMessage(l("validation.required"),y)},exchange_rate:{required:Q(function(){return _.withMessage(l("validation.required"),y),e.showExchangeRate}),decimal:_.withMessage(l("validation.valid_exchange_rate"),X)}},B=Z(P,f(()=>e.newEstimate),{$scope:V});ee(()=>e.newEstimate.customer,n=>{n&&n.currency?e.newEstimate.selectedCurrency=n.currency:e.newEstimate.selectedCurrency=r.selectedCompanyCurrency}),e.resetCurrentEstimate(),E.resetCustomFields(),B.value.$reset,e.fetchEstimateInitialSettings(p.value);async function T(){if(B.value.$touch(),B.value.$invalid)return!1;c.value=!0;let n={...e.newEstimate,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};const I=p.value?e.updateEstimate:e.addEstimate;try{let u=await I(n);u.data.data&&$.push(`/admin/estimates/${u.data.data.id}/view`)}catch(u){console.error(u)}c.value=!1}return(n,I)=>{const u=o("BaseBreadcrumbItem"),j=o("BaseBreadcrumb"),k=o("BaseButton"),G=o("router-link"),H=o("BaseIcon"),N=o("BasePageHeader"),U=o("BaseScrollPane"),R=o("BasePage");return d(),L(se,null,[a(ne),a(oe),a(me),F.value&&(!t(g)||t(b).query.customer)?(d(),v(ie,{key:0,store:t(e),"store-prop":"newEstimate","is-edit":t(p),customer:t(e).newEstimate.customer},null,8,["store","is-edit","customer"])):S("",!0),a(R,{class:"relative estimate-create-page"},{default:i(()=>[C("form",{onSubmit:ae(T,["prevent"])},[a(N,{title:t(m)},{actions:i(()=>[n.$route.name==="estimates.edit"?(d(),v(G,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:i(()=>[a(k,{class:"mr-3",variant:"primary-outline",type:"button"},{default:i(()=>[C("span",de,q(n.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):S("",!0),a(k,{loading:t(c),disabled:t(c),"content-loading":t(g),variant:"primary",type:"submit"},{left:i(z=>[t(c)?S("",!0):(d(),v(H,{key:0,class:M(z.class),name:"SaveIcon"},null,8,["class"]))]),default:i(()=>[te(" "+q(n.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:i(()=>[a(j,null,{default:i(()=>[a(u,{title:n.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(u,{title:n.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),n.$route.name==="estimates.edit"?(d(),v(u,{key:0,title:n.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(d(),v(u,{key:1,title:n.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),a(ce,{v:t(B),"is-loading":t(g),"is-edit":t(p)},null,8,["v","is-loading","is-edit"]),a(U,null,{default:i(()=>[a(re,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(g),"item-validation-scope":V,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),ge]),_:1})],32)]),_:1})],64)}}};export{ye as default};
