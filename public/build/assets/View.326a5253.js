import{d as r,o as $,c as A,b as e,w as Y,t as l,x as h,a as c,h as n,z as k,aO as z,aP as ee,n as Z,$ as te,aI as Q,I as ae,ab as se,a8 as le,N as ie,l as oe,M as ne,m as re,K as de,e as b,E as ce,an as ue,r as D,j as q,Q as me,g as H,aQ as U,F as fe}from"./main.ae77f388.js";import{_ as he}from"./EstimateIndexDropdown.2c9dc9b1.js";const ve={class:"sticky top-16 bg-gradient-to-b from-gray-100 to-white dark:from-[#151D2C] dark:to-gray-900 overflow-x-hidden overflow-y-auto no-scrollbar shrink-0 border-l border-gray-200 dark:border-gray-700/60 w-full sm:w-[calc(100dvw/2-128px)] 2xl:w-[calc(100dvw/3-80px)] h-[calc(100dvh-64px)]"},ge=e("svg",{class:"fill-gray-400 group-hover:fill-gray-600 pointer-events-none",width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"m7.95 6.536 4.242-4.243a1 1 0 1 1 1.415 1.414L9.364 7.95l4.243 4.242a1 1 0 1 1-1.415 1.415L7.95 9.364l-4.243 4.243a1 1 0 0 1-1.414-1.415L6.536 7.95 2.293 3.707a1 1 0 0 1 1.414-1.414L7.95 6.536Z"})],-1),pe=[ge],_e={class:"py-8 px-4 lg:px-8"},ye={class:"max-w-sm mx-auto lg:max-w-none"},xe={class:"text-gray-800 dark:text-gray-100 font-semibold text-center mb-1"},we={class:"text-sm text-center italic"},be={class:"drop-shadow-md mt-5"},ke={class:"bg-white dark:bg-gray-800 rounded-t-xl px-5 pb-2.5 text-center pt-5"},Be={class:"text-2xl font-semibold text-green-500 mb-1"},Ie={class:"text-sm font-medium text-gray-800 dark:text-gray-100 mb-3"},De=te('<div class="flex justify-between items-center" aria-hidden="true"><svg class="fill-white dark:fill-gray-800" width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 20c5.523 0 10-4.477 10-10S5.523 0 0 0h20v20H0Z"></path></svg><div class="grow w-full h-5 bg-white dark:bg-gray-800 flex flex-col justify-center"><div class="h-px w-full border-t border-dashed border-gray-200 dark:border-gray-700"></div></div><svg class="fill-white dark:fill-gray-800 rotate-180" width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 20c5.523 0 10-4.477 10-10S5.523 0 0 0h20v20H0Z"></path></svg></div>',1),Ee={class:"bg-white dark:bg-gray-800 rounded-b-xl p-5 pt-2.5 text-sm space-y-3"},Ce={class:"flex justify-between space-x-1"},Se=e("span",{class:"italic"},"Partida:",-1),Te={class:"font-medium text-gray-700 dark:text-gray-100 text-right"},Pe={class:"flex justify-between space-x-1"},Le=e("span",{class:"italic"},"Producto:",-1),je={class:"font-medium text-gray-700 dark:text-gray-100 text-right"},Fe={class:"flex justify-between space-x-1"},Oe=e("span",{class:"italic"},"Litros:",-1),$e={class:"font-medium text-gray-700 dark:text-gray-100 text-right"},Me={class:"flex justify-between space-x-1"},Ne=e("span",{class:"italic"},"Precio Unitario:",-1),Ve={class:"font-medium text-gray-700 dark:text-gray-100 text-right"},Re={class:"mt-6"},qe=e("div",{class:"text-sm font-semibold text-gray-800 dark:text-gray-100 mb-2"},"Adjuntar Previa",-1),He={__name:"EstimateItemDetail",props:{estimateItemDetailOpen:{type:Boolean,default:!1},estimateItem:{type:Object},estimateData:{type:Object,required:!0}},emits:["close-estimateitemdetail"],setup(i,{emit:K}){const{formatMoney:B,formatNumber:E}=Q,C=r(null),M=r(null),y=r(null);return(a,u)=>{var x,v,d,f,w,S,m,s,T,P,L,g,I;return $(),A("div",{ref_key:"panelContent",ref:C,class:Z(["absolute inset-0 sm:left-auto z-20 shadow-xl transition-transform duration-200 ease-in-out",i.estimateItemDetailOpen?"translate-x-0":"translate-x-full"])},[e("div",ve,[e("button",{ref_key:"closeBtn",ref:M,onClick:u[0]||(u[0]=Y(p=>a.$emit("close-estimateitemdetail"),["stop"])),class:"absolute top-0 right-0 mt-6 mr-6 group p-2"},pe,512),e("div",_e,[e("div",ye,[e("div",xe,l((v=(x=i.estimateData)==null?void 0:x.customer)==null?void 0:v.rfc)+" "+l((f=(d=i.estimateData)==null?void 0:d.customer)==null?void 0:f.name),1),e("div",we,"Solicita: "+l((S=(w=i.estimateData)==null?void 0:w.creator)==null?void 0:S.name),1),e("div",be,[e("div",ke,[e("div",Be,l(h(B)((m=i.estimateItem)==null?void 0:m.total)),1),e("div",Ie,l((s=i.estimateItem)==null?void 0:s.name),1),c(z,{status:(T=i.estimateItem)==null?void 0:T.status,class:"px-3 py-1"},{default:n(()=>{var p;return[k(l((p=i.estimateItem)==null?void 0:p.status_name),1)]}),_:1},8,["status"])]),De,e("div",Ee,[e("div",Ce,[Se,e("span",Te,l(h(E)((P=i.estimateItem)==null?void 0:P.id)),1)]),e("div",Pe,[Le,e("span",je,l((L=i.estimateItem)==null?void 0:L.name),1)]),e("div",Fe,[Oe,e("span",$e,l(h(E)((g=i.estimateItem)==null?void 0:g.quantity)),1)]),e("div",Me,[Ne,e("span",Ve,l(h(B)((I=i.estimateItem)==null?void 0:I.precision_price,0,{itemPrecision:6})),1)])])]),e("div",Re,[qe,c(ee,{modelValue:y.value,"onUpdate:modelValue":u[1]||(u[1]=p=>y.value=p),accept:".pdf",onChange:a.onFileInputChange,onRemove:a.onFileInputRemove},null,8,["modelValue","onChange","onRemove"])])])])])],2)}}},Ue={class:"relative table-container pt-5"},Ze={__name:"View",setup(i){const{formatMoney:K,formatNumber:B}=Q,E=ae(),C=se();le();const M=ie(),{t:y}=oe(),a=r(null),u=ne();re(),r(!1);const x=r(!1),v=r(!1),d=r(null),f=r(1),w=r(1),S=r(null),m=r(null),s=de({orderBy:null,orderByField:null,searchText:null}),T=b(()=>[{key:"id",label:"Partida"},{key:"name",label:"Producto"},{key:"quantity",label:"Litros",thClass:"text-right",tdClass:"text-right"},{key:"precision_price",label:"Precio Unitario",thClass:"text-right",tdClass:"text-right"},{key:"total",label:"Total",thClass:"text-right",tdClass:"text-right"},{key:"status",label:"Estatus"}]),P=b(()=>"Previa: "+a.value.estimate_number),L=b(()=>s.orderBy==="asc"||s.orderBy==null);b(()=>L.value?y("general.ascending"):y("general.descending")),b(()=>`/estimates/pdf/${a.value.unique_hash}`),b(()=>a.value&&a.value.id?estimate.value.id:null),ce(u,(t,j)=>{t.name==="estimates.view"&&V()}),g(),V(),R=ue.exports.debounce(R,500);async function g(t,j=!1){if(x.value)return;let _={};s.searchText!==""&&s.searchText!==null&&s.searchText!==void 0&&(_.search=s.searchText),s.orderBy!==null&&s.orderBy!==void 0&&(_.orderBy=s.orderBy),s.orderByField!==null&&s.orderByField!==void 0&&(_.orderByField=s.orderByField),x.value=!0;let F=await C.fetchEstimates({page:t,..._});x.value=!1,d.value=d.value?d.value:[],d.value=[...d.value,...F.data.data],f.value=t||1,w.value=F.data.meta.last_page;let O=d.value.find(N=>N.id==u.params.id);j==!1&&!O&&f.value<w.value&&Object.keys(_).length===0&&g(++f.value),O&&setTimeout(()=>{j==!1&&G()},500)}function I(t){m.value=t}function p(){m.value=null}function G(){const t=document.getElementById(`estimate-${u.params.id}`);t&&(t.scrollIntoView({behavior:"smooth"}),t.classList.add("shake"),J())}function J(){S.value.addEventListener("scroll",t=>{t.target.scrollTop>0&&t.target.scrollTop+t.target.clientHeight>t.target.scrollHeight-200&&f.value<w.value&&g(++f.value,!0)})}async function V(){v.value=!0;let t=await C.fetchEstimate(u.params.id);t.data&&(v.value=!1,a.value={...t.data.data})}async function R(){d.value=[],g()}async function W(t){E.openModal({title:y("estimates.send_estimate"),componentName:"SendEstimateModal",id:a.value.id,data:a.value})}return(t,j)=>{const _=D("BaseButton"),F=D("BasePageHeader"),O=D("router-link"),N=D("BaseTable"),X=D("BasePage");return $(),A(fe,null,[a.value?($(),q(X,{key:0,class:Z({"sm:w-1/2 lg:w-2/3":m.value!==null})},{default:n(()=>[c(F,{title:P.value},{actions:n(()=>[a.value.status==="DRAFT"&&h(M).hasAbilities(h(me).SEND_ESTIMATE)?($(),q(_,{key:0,"content-loading":v.value,variant:"primary",class:"text-sm",onClick:W},{default:n(()=>[k(" Enviar a revisi\xF3n ")]),_:1},8,["content-loading"])):H("",!0),c(he,{class:"ml-3",row:a.value},null,8,["row"])]),_:1},8,["title"]),e("div",Ue,[c(N,{data:a.value.items,columns:T.value,loading:v.value,actionRow:"openItemDetail",selectedRow:m.value,onOpenItemDetail:I},{"cell-id":n(({row:o})=>[c(O,{to:I,class:"font-medium text-primary-500"},{default:n(()=>[k(l(h(B)(o.data.id)),1)]),_:2},1024)]),"cell-name":n(({row:o})=>[k(l(o.data.name),1)]),"cell-quantity":n(({row:o})=>[k(l(h(B)(o.data.quantity)),1)]),"cell-precision_price":n(({row:o})=>[c(U,{amount:o.data.precision_price,precision:"6"},null,8,["amount"])]),"cell-total":n(({row:o})=>[c(U,{amount:o.data.total},null,8,["amount"])]),"cell-status":n(({row:o})=>[c(z,{status:o.data.status,class:"px-3 py-1"},{default:n(()=>[k(l(o.data.status_name),1)]),_:2},1032,["status"])]),_:1},8,["data","columns","loading","selectedRow"])])]),_:1},8,["class"])):H("",!0),c(He,{estimateItemDetailOpen:m.value!==null,estimateItem:m.value,estimateData:a.value,onCloseEstimateitemdetail:p},null,8,["estimateItemDetailOpen","estimateItem","estimateData"])],64)}}};export{Ze as default};
