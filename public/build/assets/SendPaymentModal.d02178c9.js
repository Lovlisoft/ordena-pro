import{H as O,I as H,u as K,a8 as X,l as J,d as B,K as Q,e as M,p,q as h,s as P,v as W,r as d,o as _,j as V,h as n,b as f,z as v,t as $,a as o,c as x,x as e,n as Y,g as N}from"./main.d9f009a5.js";import{u as Z}from"./payment.11ac5240.js";import{u as ee}from"./mail-driver.2e1553b1.js";const te={class:"flex justify-between w-full"},ae={key:0,action:""},oe={class:"px-8 py-8 sm:p-6"},re={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},se={key:1},le={class:"my-6 mx-4 border border-gray-200 relative"},ne=["src"],ie={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},pe={__name:"SendPaymentModal",setup(ue){const S=Z(),j=O(),m=H(),D=K();ee(),X();const{t:u}=J();let i=B(!1);const I=B(""),y=B(!1),U=B(["customer","customerCustom","payments","paymentsCustom","company"]),r=Q({id:null,from:null,to:null,subject:"New Payment",body:null}),z=M(()=>m.active&&m.componentName==="SendPaymentModal"),G=M(()=>m.title),q=M(()=>m.data),E={from:{required:p.withMessage(u("validation.required"),h),email:p.withMessage(u("validation.email_incorrect"),P)},to:{required:p.withMessage(u("validation.required"),h),email:p.withMessage(u("validation.email_incorrect"),P)},subject:{required:p.withMessage(u("validation.required"),h)},body:{required:p.withMessage(u("validation.required"),h)}},a=W(E,r);function L(){y.value=!1}async function R(){let s=await j.fetchBasicMailConfig();r.id=m.id,s.data&&(r.from=s.data.from_mail),q.value&&(r.to=q.value.customer.email),r.body=j.selectedCompanySettings.payment_mail_body}async function k(){if(a.value.$touch(),a.value.$invalid)return!0;try{if(i.value=!0,!y.value){const c=await S.previewPayment(r);i.value=!1,y.value=!0;var s=new Blob([c.data],{type:"text/html"});I.value=URL.createObjectURL(s);return}const t=await S.sendEmail(r);if(i.value=!1,t.data.success)return b(),!0}catch{i.value=!1,D.showNotification({type:"error",message:u("payments.something_went_wrong")})}}function b(){setTimeout(()=>{a.value.$reset(),y.value=!1,I.value=null,m.resetModalData()},300)}return(s,t)=>{const c=d("BaseIcon"),C=d("BaseInput"),w=d("BaseInputGroup"),T=d("BaseCustomInput"),A=d("BaseInputGrid"),g=d("BaseButton"),F=d("BaseModal");return _(),V(F,{show:z.value,onClose:b,onOpen:R},{header:n(()=>[f("div",te,[v($(G.value)+" ",1),o(c,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:b})])]),default:n(()=>[y.value?(_(),x("div",se,[f("div",le,[o(g,{class:"absolute top-4 right-4",disabled:e(i),variant:"primary-outline",onClick:L},{default:n(()=>[o(c,{name:"PencilIcon",class:"h-5 mr-2"}),v(" Edit ")]),_:1},8,["disabled"]),f("iframe",{src:I.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,ne)]),f("div",ie,[o(g,{class:"mr-3",variant:"primary-outline",type:"button",onClick:b},{default:n(()=>[v($(s.$t("general.cancel")),1)]),_:1}),o(g,{loading:e(i),disabled:e(i),variant:"primary",type:"button",onClick:t[7]||(t[7]=l=>k())},{default:n(()=>[e(i)?N("",!0):(_(),V(c,{key:0,name:"PaperAirplaneIcon",class:"h-5 mr-2"})),v(" "+$(s.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(_(),x("form",ae,[f("div",oe,[o(A,{layout:"one-column",class:"col-span-7"},{default:n(()=>[o(w,{label:s.$t("general.from"),required:"",error:e(a).from.$error&&e(a).from.$errors[0].$message},{default:n(()=>[o(C,{modelValue:r.from,"onUpdate:modelValue":t[0]||(t[0]=l=>r.from=l),type:"text",invalid:e(a).from.$error,onInput:t[1]||(t[1]=l=>e(a).from.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),o(w,{label:s.$t("general.to"),required:"",error:e(a).to.$error&&e(a).to.$errors[0].$message},{default:n(()=>[o(C,{modelValue:r.to,"onUpdate:modelValue":t[2]||(t[2]=l=>r.to=l),type:"text",invalid:e(a).to.$error,onInput:t[3]||(t[3]=l=>e(a).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),o(w,{error:e(a).subject.$error&&e(a).subject.$errors[0].$message,label:s.$t("general.subject"),required:""},{default:n(()=>[o(C,{modelValue:r.subject,"onUpdate:modelValue":t[4]||(t[4]=l=>r.subject=l),type:"text",invalid:e(a).subject.$error,onInput:t[5]||(t[5]=l=>e(a).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["error","label"]),o(w,{label:s.$t("general.body"),error:e(a).body.$error&&e(a).body.$errors[0].$message,required:""},{default:n(()=>[o(T,{modelValue:r.body,"onUpdate:modelValue":t[6]||(t[6]=l=>r.body=l),fields:U.value},null,8,["modelValue","fields"])]),_:1},8,["label","error"])]),_:1})]),f("div",re,[o(g,{class:"mr-3",variant:"primary-outline",type:"button",onClick:b},{default:n(()=>[v($(s.$t("general.cancel")),1)]),_:1}),o(g,{loading:e(i),disabled:e(i),variant:"primary",type:"button",class:"mr-3",onClick:k},{left:n(l=>[e(i)?N("",!0):(_(),V(c,{key:0,class:Y(l.class),name:"PhotographIcon"},null,8,["class"]))]),default:n(()=>[v(" "+$(s.$t("general.preview")),1)]),_:1},8,["loading","disabled"])])]))]),_:1},8,["show"])}}};export{pe as _};
