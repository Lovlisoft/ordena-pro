import{H as ee,as as pe,ab as ye,M as $e,l as te,e as c,aH as X,an as G,p as V,q as F,aJ as ue,aj as Z,ay as Ie,v as de,r as w,o as h,c as z,b as s,a as l,x as o,j as k,aL as me,h as y,g as R,z as D,aM as re,t as T,aI as _e,aN as we,ap as Se,F as ve,I as ae,N as Be,d as Q,i as Te,n as K,aw as ce,u as Me,L as Pe,f as fe,w as xe,J as Ce,K as ke,E as Ve}from"./main.77709028.js";import{D as De,d as qe}from"./DragIcon.81b7c04a.js";const Ae={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},Ee={colspan:"5",class:"p-0 text-left align-top pt-2"},Le={class:"w-full"},Ue=s("colgroup",null,[s("col",{style:{width:"30%","min-width":"280px"}}),s("col",{style:{width:"10%","min-width":"120px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}})],-1),ze={class:"px-2 py-2 text-left align-top"},je={class:"flex justify-start"},Ne={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},Oe={class:"px-2 py-2 text-right align-top"},Fe={class:"px-2 py-2 text-left align-top"},Ge={class:"flex flex-col"},Xe={class:"flex-auto flex-fill bd-highlight"},Re={class:"relative w-full"},Ye={class:"px-2 py-2 text-right align-top"},He={class:"flex items-center justify-end text-sm"},Je={class:"flex items-center justify-center w-6 h-10 mx-2"},Ke={class:"px-12 pb-4 text-right"},Qe={class:"text-sm pr-6"},We={class:"text-sm pr-6"},Ze={class:"text-sm"},et={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(m,{emit:g}){const{getItemDecimalPrecisionMultiplier:u}=_e,e=m,d=ee(),P=pe(),n=ye();$e();const{t:b}=te(),q=c({get:()=>n.newEstimate.show_price_breakdown}),i=c({get:()=>e.itemData.quantity,set:a=>{B("quantity",parseFloat(a))}});c({get:()=>{const a=e.itemData.price;return parseFloat(a)>0?a/100:a},set:a=>{if(parseFloat(a)>0){let p=Math.round(a*100);B("price",p)}else B("price",a)}});const C=c({get:()=>{const a=e.itemData.precision_price;return parseFloat(a)>0?a/u(X):a},set:a=>{if(parseFloat(a)>0){let p=Math.round(a*u(X)),L=Math.round(a*100);B("precision_price",p),B("price",L)}else B("precision_price",a),B("price",a)}}),M=c({get:()=>q.value?r.value:r.value-A.value}),A=c({get:()=>e.itemData.quantity*e.itemData.ieps}),E=c({get:()=>M.value*.16}),S=c({get:()=>I(M)}),v=c({get:()=>I(E)}),$=c({get:()=>I(A)});function I(a){return a.value.toLocaleString("es-MX",{style:"currency",currency:"MXN"})}const U=c(()=>e.itemData.precision_price*e.itemData.quantity),r=c(()=>e.itemData.precision_price*e.itemData.quantity/u(X));c({get:()=>e.itemData.discount,set:a=>{e.itemData.discount_type==="percentage"?B("discount_val",U.value*a/100):B("discount_val",Math.round(a*100)),B("discount",a)}});const x=c(()=>M.value+A.value+E.value);c(()=>r.value-e.itemData.discount_val);const t=c(()=>e.currency?e.currency:d.selectedCompanyCurrency),f=c(()=>e.store[e.storeProp].items.length!=1),_=c(()=>Math.round(G.exports.sumBy(e.itemData.taxes,function(a){return a.compound_tax?0:a.amount}))),Y=c(()=>Math.round(G.exports.sumBy(e.itemData.taxes,function(a){return a.compound_tax?a.amount:0}))),j=c(()=>_.value+Y.value),se={name:{required:V.withMessage(b("validation.required"),F)},quantity:{required:V.withMessage(b("validation.required"),F),minValue:V.withMessage(b("validation.qty_must_greater_than_zero"),ue(0)),maxLength:V.withMessage(b("validation.amount_maxlength"),Z(20))},price:{required:V.withMessage(b("validation.required"),F),minValue:V.withMessage(b("validation.number_length_minvalue"),ue(1)),maxLength:V.withMessage(b("validation.price_maxlength"),Z(20))},discount_val:{between:V.withMessage(b("validation.discount_maxlength"),Ie(0,c(()=>U.value)))},description:{maxLength:V.withMessage(b("validation.notes_maxlength"),Z(65e3))}},N=de(se,c(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function oe(a){e.store.$patch(L=>{L[e.storeProp].items[e.index].taxes[a.index]=a.item});let p=e.itemData.taxes[e.itemData.taxes.length-1];(p==null?void 0:p.tax_type_id)!==0&&e.store.$patch(L=>{L[e.storeProp].items[e.index].taxes.push({...we,id:Se.raw()})}),H()}function ne(a){B("name",a)}function W(a){e.store.$patch(p=>{if(p[e.storeProp].items[e.index].name=a.name,p[e.storeProp].items[e.index].price=a.price,p[e.storeProp].items[e.index].item_id=a.id,p[e.storeProp].items[e.index].description=a.description,p[e.storeProp].items[e.index].precision=a.precision,p[e.storeProp].items[e.index].precision_price=a.precision_price,p[e.storeProp].items[e.index].ieps=a.ieps,a.unit&&(p[e.storeProp].items[e.index].unit_name=a.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&a.taxes){let L=0;a.taxes.forEach(J=>{oe({index:L,item:{...J}}),L++})}p[e.storeProp].exchange_rate&&(p[e.storeProp].items[e.index].price/=p[e.storeProp].exchange_rate)}),P.fetchItems(),H()}function H(){var L,J;let a=(J=(L=e.store[e.storeProp])==null?void 0:L.items[e.index])==null?void 0:J.taxes;a||(a=[]);let p={...e.store[e.storeProp].items[e.index],index:e.index,total:x.value,sub_total:U.value,totalSimpleTax:_.value,totalCompoundTax:Y.value,totalTax:j.value,tax:j.value,taxes:[...a]};e.store.updateItem(p)}function B(a,p){e.store.$patch(L=>{L[e.storeProp].items[e.index][a]=p}),H()}return(a,p)=>{const L=w("BaseItemSelect"),J=w("BaseInput"),ge=w("BaseContentPlaceholdersText"),he=w("BaseContentPlaceholders"),be=w("BaseIcon");return h(),z("tr",Ae,[s("td",Ee,[s("table",Le,[Ue,s("tbody",null,[s("tr",null,[s("td",ze,[s("div",je,[s("div",Ne,[l(De)]),l(L,{type:"Invoice",item:m.itemData,invalid:o(N).name.$error,"invalid-description":o(N).description.$error,taxes:m.itemData.taxes,index:m.index,"store-prop":m.storeProp,store:m.store,onSearch:ne,onSelect:W},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),s("td",Oe,[l(J,{modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=O=>i.value=O),invalid:o(N).quantity.$error,"content-loading":m.loading,type:"number",small:"",min:"0",step:"any",onChange:p[1]||(p[1]=O=>H()),onInput:p[2]||(p[2]=O=>o(N).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),s("td",Fe,[s("div",Ge,[s("div",Xe,[s("div",Re,[(h(),k(me,{key:t.value,modelValue:C.value,"onUpdate:modelValue":p[3]||(p[3]=O=>C.value=O),invalid:o(N).price.$error,"content-loading":m.loading,currency:t.value,"item-precision":o(X)},null,8,["modelValue","invalid","content-loading","currency","item-precision"]))])])])]),s("td",Ye,[s("div",He,[s("span",null,[m.loading?(h(),k(he,{key:0},{default:y(()=>[l(ge,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),k(me,{key:t.value,modelValue:x.value,"onUpdate:modelValue":p[4]||(p[4]=O=>x.value=O),currency:t.value,"item-precision":2},null,8,["modelValue","currency"]))]),s("div",Je,[f.value?(h(),k(be,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:p[5]||(p[5]=O=>m.store.removeItem(m.index))})):R("",!0)])])])])])]),s("div",Ke,[l(re,null,{default:y(()=>[D("Monto Base:")]),_:1}),D(),s("span",Qe,T(S.value),1),l(re,null,{default:y(()=>[D("IEPS:")]),_:1}),D(),s("span",We,T($.value),1),l(re,null,{default:y(()=>[D("IVA (16%): ")]),_:1}),D(),s("span",Ze,T(v.value),1)])])])}}},tt={class:"text-center item-table min-w-full"},at=s("colgroup",null,[s("col",{style:{width:"30%","min-width":"280px"}}),s("col",{style:{width:"10%","min-width":"120px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}})],-1),st={class:"bg-white border border-gray-200 border-solid"},ot={class:"px-2 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},nt={key:1,class:"pl-7"},rt={class:"px-2 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},it={key:1},lt={class:"px-2 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},dt={key:1},ct={key:0,class:"px-2 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},ut={key:1},mt={class:"px-2 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},pt={key:1,class:"pr-10 column-heading"},qt={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(m){const g=m,u=ee(),e=c(()=>g.currency?g.currency:u.selectedCompanyCurrency);return(d,P)=>{const n=w("BaseContentPlaceholdersText"),b=w("BaseContentPlaceholders"),q=w("BaseIcon");return h(),z(ve,null,[s("table",tt,[at,s("thead",st,[s("tr",null,[s("th",ot,[m.isLoading?(h(),k(b,{key:0},{default:y(()=>[l(n,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),z("span",nt,T(d.$tc("items.item",2)),1))]),s("th",rt,[m.isLoading?(h(),k(b,{key:0},{default:y(()=>[l(n,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),z("span",it,T(d.$t("invoices.item.quantity")),1))]),s("th",lt,[m.isLoading?(h(),k(b,{key:0},{default:y(()=>[l(n,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),z("span",dt,T(d.$t("invoices.item.price")),1))]),m.store[m.storeProp].discount_per_item==="YES"?(h(),z("th",ct,[m.isLoading?(h(),k(b,{key:0},{default:y(()=>[l(n,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),z("span",ut,T(d.$t("invoices.item.discount")),1))])):R("",!0),s("th",mt,[m.isLoading?(h(),k(b,{key:0},{default:y(()=>[l(n,{lines:1,class:"w-16 h-5"})]),_:1})):(h(),z("span",pt,T(d.$t("invoices.item.amount")),1))])])]),l(o(qe),{modelValue:m.store[m.storeProp].items,"onUpdate:modelValue":P[0]||(P[0]=i=>m.store[m.storeProp].items=i),"item-key":"id",tag:"tbody",handle:".handle"},{item:y(({element:i,index:C})=>[(h(),k(et,{key:i.id,index:C,"item-data":i,loading:m.isLoading,currency:e.value,"item-validation-scope":m.itemValidationScope,"invoice-items":m.store[m.storeProp].items,store:m.store,"store-prop":m.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),s("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:P[1]||(P[1]=(...i)=>m.store.addItem&&m.store.addItem(...i))},[l(q,{name:"PlusCircleIcon",class:"mr-2"}),D(" "+T(d.$t("general.add_new_item")),1)])],64)}}},yt={class:"flex justify-between w-full"},_t={class:"px-8 py-8 sm:p-6"},vt={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},ft=["onClick"],xt=["src","alt"],gt=["alt","src"],ht={key:1,class:"z-0 flex ml-3 pt-5"},bt={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},At={__name:"SelectTemplateModal",setup(m){const g=ae(),u=Be(),e=Q(""),d=c(()=>g.active&&g.componentName==="SelectTemplate"),P=c(()=>g.title);function n(){g.data.store[g.data.storeProp].template_name?e.value=g.data.store[g.data.storeProp].template_name:e.value=g.data.templates[0]}async function b(){await g.data.store.setTemplate(e.value),!g.data.store.isEdit&&g.data.isMarkAsDefault&&(g.data.storeProp=="newEstimate"?await u.updateUserSettings({settings:{default_estimate_template:e.value}}):g.data.storeProp=="newInvoice"&&await u.updateUserSettings({settings:{default_invoice_template:e.value}})),i()}function q(){return new URL("/img/tick.png",self.location)}function i(){g.closeModal(),setTimeout(()=>{g.$reset()},300)}return(C,M)=>{const A=w("BaseIcon"),E=w("BaseCheckbox"),S=w("BaseButton"),v=w("BaseModal");return h(),k(v,{show:d.value,onClose:i,onOpen:n},{header:y(()=>[s("div",yt,[D(T(P.value)+" ",1),l(A,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:i})])]),default:y(()=>[s("div",_t,[o(g).data?(h(),z("div",vt,[(h(!0),z(ve,null,Te(o(g).data.templates,($,I)=>(h(),z("div",{key:I,class:K([{"border border-solid border-primary-500":e.value===$.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:U=>e.value=$.name},[s("img",{src:$.path,alt:$.name,class:"w-full min-h-[100px]"},null,8,xt),e.value===$.name?(h(),z("img",{key:0,alt:$.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:q()},null,8,gt)):R("",!0),s("span",{class:K(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":e.value===$.name,"text-gray-600":e.value!=$.name}])},T($.name),3)],10,ft))),128))])):R("",!0),o(g).data.store.isEdit?R("",!0):(h(),z("div",ht,[l(E,{modelValue:o(g).data.isMarkAsDefault,"onUpdate:modelValue":M[0]||(M[0]=$=>o(g).data.isMarkAsDefault=$),"set-initial-value":!1,variant:"primary",label:C.$t("general.mark_as_default"),description:o(g).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),s("div",bt,[l(S,{class:"mr-3",variant:"primary-outline",onClick:i},{default:y(()=>[D(T(C.$t("general.cancel")),1)]),_:1}),l(S,{variant:"primary",onClick:M[1]||(M[1]=$=>b())},{left:y($=>[l(A,{name:"SaveIcon",class:K($.class)},null,8,["class"])]),default:y(()=>[D(" "+T(C.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},$t={class:"flex justify-between w-full"},It={class:"item-modal"},wt={class:"px-8 py-8 sm:p-6"},St={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Et={__name:"ItemModal",emits:["newItem"],setup(m,{emit:g}){const{getItemDecimalPrecisionMultiplier:u}=_e,e=ae(),d=pe(),P=ee(),n=ce();ye(),Me();const{t:b}=te(),q=Q(!1),i=Q(P.selectedCompanySettings.tax_per_item),C=c(()=>e.active&&e.componentName==="ItemModal"),M=(t,f)=>{d.$patch(_=>{_.currentItem[t]=f})},A=c({get:()=>{const t=d.currentItem.price;return parseFloat(t)>0?t/100:t},set:t=>{if(parseFloat(t)>0){let f=Math.round(t*100);M("price",f)}else M("price",t)}}),E=c({get:()=>{const t=d.currentItem.precision_price;return parseFloat(t)>0?t/u(X):t},set:t=>{if(parseFloat(t)>0){let f=Math.round(t*u(X)),_=Math.round(t*100);M("precision_price",f),M("price",_)}else M("precision_price",t),M("price",t)}}),S=c({get:()=>d.currentItem.taxes.map(t=>{if(t)return{...t,tax_type_id:t.id,tax_name:t.name+" ("+t.percent+"%)"}}),set:t=>{d.$patch(f=>{f.currentItem.taxes=t})}}),v=c(()=>i.value==="YES"),$={name:{required:V.withMessage(b("validation.required"),F),minLength:V.withMessage(b("validation.name_min_length",{count:3}),Pe(3))},description:{maxLength:V.withMessage(b("validation.description_maxlength",{count:255}),Z(255))}},I=de($,c(()=>d.currentItem)),U=c(()=>n.taxTypes.map(t=>({...t,tax_name:t.name+" ("+t.percent+"%)"})));fe(()=>{I.value.$reset(),d.fetchItemUnits({limit:"all"})});async function r(){if(I.value.$touch(),I.value.$invalid)return!0;let t={...d.currentItem,taxes:d.currentItem.taxes.map(_=>({tax_type_id:_.id,amount:A.value*_.percent,percent:_.percent,name:_.name,collective_tax:0}))};q.value=!0,await(d.isEdit?d.updateItem:d.addItem)(t).then(_=>{q.value=!1,_.data.data&&e.data&&e.refreshData(_.data.data),x()})}function x(){e.closeModal(),setTimeout(()=>{d.resetCurrentItem(),e.$reset(),I.value.$reset()},300)}return(t,f)=>{const _=w("BaseIcon"),Y=w("BaseInput"),j=w("BaseInputGroup"),se=w("BaseItemMoney"),N=w("BaseMultiselect"),oe=w("BaseTextarea"),ne=w("BaseInputGrid"),W=w("BaseButton"),H=w("BaseModal");return h(),k(H,{show:C.value,onClose:x},{header:y(()=>[s("div",$t,[D(T(o(e).title)+" ",1),l(_,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:x})])]),default:y(()=>[s("div",It,[s("form",{action:"",onSubmit:xe(r,["prevent"])},[s("div",wt,[l(ne,{layout:"one-column"},{default:y(()=>[l(j,{label:t.$t("items.name"),required:"",error:o(I).name.$error&&o(I).name.$errors[0].$message},{default:y(()=>[l(Y,{modelValue:o(d).currentItem.name,"onUpdate:modelValue":f[0]||(f[0]=B=>o(d).currentItem.name=B),type:"text",invalid:o(I).name.$error,onInput:f[1]||(f[1]=B=>o(I).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),l(j,{label:t.$t("items.price")},{default:y(()=>[(h(),k(se,{key:o(P).selectedCompanyCurrency,modelValue:E.value,"onUpdate:modelValue":f[2]||(f[2]=B=>E.value=B),currency:o(P).selectedCompanyCurrency,"item-precision":o(X),class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency","item-precision"]))]),_:1},8,["label"]),l(j,{label:t.$t("items.unit")},{default:y(()=>[l(N,{modelValue:o(d).currentItem.unit_id,"onUpdate:modelValue":f[3]||(f[3]=B=>o(d).currentItem.unit_id=B),label:"name",options:o(d).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:t.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),v.value?(h(),k(j,{key:0,label:t.$t("items.taxes")},{default:y(()=>[l(N,{modelValue:S.value,"onUpdate:modelValue":f[4]||(f[4]=B=>S.value=B),options:U.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):R("",!0),l(j,{label:t.$t("items.description"),error:o(I).description.$error&&o(I).description.$errors[0].$message},{default:y(()=>[l(oe,{modelValue:o(d).currentItem.description,"onUpdate:modelValue":f[5]||(f[5]=B=>o(d).currentItem.description=B),rows:"4",cols:"50",invalid:o(I).description.$error,onInput:f[6]||(f[6]=B=>o(I).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),s("div",St,[l(W,{class:"mr-3",variant:"primary-outline",type:"button",onClick:x},{default:y(()=>[D(T(t.$t("general.cancel")),1)]),_:1}),l(W,{loading:q.value,disabled:q.value,variant:"primary",type:"submit"},{left:y(B=>[l(_,{name:"SaveIcon",class:K(B.class)},null,8,["class"])]),default:y(()=>[D(" "+T(o(d).isEdit?t.$t("general.update"):t.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},Bt={class:"flex justify-between w-full"},Tt={class:"flex flex-col"},Mt={class:"text-sm text-gray-500 mt-1"},Pt={class:"p-4 sm:p-6"},Ct={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},kt={__name:"TaxationAddressModal",emits:["addTax"],setup(m,{emit:g}){const u=ae();Ce();const e=ke({state:"",city:"",address_street_1:"",zip:""}),d=Q(!1),P=ce(),{t:n}=te(),b=c(()=>u.active&&u.componentName==="TaxationAddressModal"),q=c(()=>({state:{required:V.withMessage(n("validation.required"),F)},city:{required:V.withMessage(n("validation.required"),F)},address_street_1:{required:V.withMessage(n("validation.required"),F)},zip:{required:V.withMessage(n("validation.required"),F)}})),i=de(q,c(()=>e));async function C(){if(i.value.$touch(),i.value.$invalid)return!0;let S={address:e};u.id&&(S.customer_id=u.id),e.address_street_1=e.address_street_1.replace(/(\r\n|\n|\r)/gm,""),d.value=!0,await P.fetchSalesTax(S).then(v=>{d.value=!1,M("addTax",v.data.data),E()}).catch(v=>{d.value=!1})}const M=g;function A(){var S,v,$,I;e.state=(S=u==null?void 0:u.data)==null?void 0:S.state,e.city=(v=u==null?void 0:u.data)==null?void 0:v.city,e.address_street_1=($=u==null?void 0:u.data)==null?void 0:$.address_street_1,e.zip=(I=u==null?void 0:u.data)==null?void 0:I.zip}function E(){u.closeModal()}return(S,v)=>{const $=w("BaseIcon"),I=w("BaseInput"),U=w("BaseInputGroup"),r=w("BaseTextarea"),x=w("BaseInputGrid"),t=w("BaseButton"),f=w("BaseModal");return h(),k(f,{show:b.value,onClose:E,onOpen:A},{header:y(()=>[s("div",Bt,[s("div",Tt,[D(T(o(u).title)+" ",1),s("p",Mt,T(o(u).content),1)]),l($,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:E})])]),default:y(()=>[s("form",{onSubmit:xe(C,["prevent"])},[s("div",Pt,[l(x,{layout:"one-column"},{default:y(()=>[l(U,{required:"",error:o(i).state.$error&&o(i).state.$errors[0].$message,label:S.$t("customers.state")},{default:y(()=>[l(I,{modelValue:e.state,"onUpdate:modelValue":v[0]||(v[0]=_=>e.state=_),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:o(i).state.$error,onInput:v[1]||(v[1]=_=>o(i).state.$touch()),placeholder:S.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),l(U,{required:"",error:o(i).city.$error&&o(i).city.$errors[0].$message,label:S.$t("customers.city")},{default:y(()=>[l(I,{modelValue:e.city,"onUpdate:modelValue":v[2]||(v[2]=_=>e.city=_),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:o(i).city.$error,onInput:v[3]||(v[3]=_=>o(i).city.$touch()),placeholder:S.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),l(U,{required:"",error:o(i).address_street_1.$error&&o(i).address_street_1.$errors[0].$message,label:S.$t("customers.address")},{default:y(()=>[l(r,{modelValue:e.address_street_1,"onUpdate:modelValue":v[4]||(v[4]=_=>e.address_street_1=_),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:o(i).address_street_1.$error,onInput:v[5]||(v[5]=_=>o(i).address_street_1.$touch()),placeholder:S.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),l(U,{required:"",error:o(i).zip.$error&&o(i).zip.$errors[0].$message,label:S.$t("customers.zip_code")},{default:y(()=>[l(I,{modelValue:e.zip,"onUpdate:modelValue":v[6]||(v[6]=_=>e.zip=_),invalid:o(i).zip.$error,onInput:v[7]||(v[7]=_=>o(i).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:S.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),s("div",Ct,[l(t,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:E},{default:y(()=>[D(T(S.$t("general.cancel")),1)]),_:1}),l(t,{loading:d.value,variant:"primary",type:"submit"},{left:y(_=>[d.value?R("",!0):(h(),k($,{key:0,name:"SaveIcon",class:K(_.class)},null,8,["class"]))]),default:y(()=>[D(" "+T(S.$t("general.save")),1)]),_:1},8,["loading"])])],32)]),_:1},8,["show"])}}},ie="Sales Tax",le="MODULE",Lt={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(m){const g=ae(),u=ee(),e=ce(),{t:d}=te(),P=Q(!1),n=m,b=c(()=>n.isEdit?n.store[n.storeProp].sales_tax_address_type==="billing":u.selectedCompanySettings.sales_tax_address_type==="billing"),q=c(()=>u.selectedCompanySettings.sales_tax_us_enabled==="YES"),i=c(()=>n.isEdit?n.store[n.storeProp].sales_tax_type==="customer_level":u.selectedCompanySettings.sales_tax_type==="customer_level"),C=c(()=>n.isEdit?n.store[n.storeProp].sales_tax_type==="company_level":u.selectedCompanySettings.sales_tax_type==="company_level"),M=c(()=>{if(i.value&&A.value){let r=b.value?n.customer.billing:n.customer.shipping;return{address:G.exports.pick(r,["address_street_1","city","state","zip"]),customer_id:n.customer.id}}else if(C.value&&A.value)return{address:G.exports.pick(address,["address_street_1","city","state","zip"])}}),A=c(()=>{var r,x;if(i.value){let t=b.value?(r=n.customer)==null?void 0:r.billing:(x=n.customer)==null?void 0:x.shipping;return E(t)}else if(C.value)return E(u.selectedCompany.address);return!1});Ve(()=>n.customer,(r,x)=>{if(r&&x&&i.value){S(r,x);return}!A.value&&i.value&&r?setTimeout(()=>{v()},500):i.value&&r?$():i.value&&!r&&U()}),fe(()=>{C.value&&(A.value?$():v())});function E(r){return r?r.address_street_1&&r.city&&r.state&&r.zip:!1}function S(r,x){const t=b.value?r.billing:r.shipping,f=b.value?x.billing:x.shipping,_=G.exports.pick(t,["address_street_1","city","state","zip"]),Y=G.exports.pick(f,["address_street_1","city","state","zip"]);G.exports.isEqual(_,Y)||$()}function v(){var t,f;if(!q.value)return;let r=null,x="";i.value?b.value?(r=(t=n.customer)==null?void 0:t.billing,x=d("settings.taxations.add_billing_address")):(r=(f=n.customer)==null?void 0:f.shipping,x=d("settings.taxations.add_shipping_address")):(r=u.selectedCompany.address,x=d("settings.taxations.add_company_address")),g.openModal({title:x,content:d("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:r,id:i.value?n.customer.id:""})}async function $(){!q.value||(P.value=!0,await e.fetchSalesTax(M.value).then(r=>{I(r.data.data),P.value=!1}).catch(r=>{r.response.data.error&&setTimeout(()=>{v()},500),P.value=!1}))}function I(r){r.tax_type_id=r.id;const x=n.store[n.storeProp].taxes.findIndex(t=>t.name===ie&&t.type===le);x>-1?Object.assign(n.store[n.storeProp].taxes[x],r):n.store[n.storeProp].taxes.push(r)}function U(){const r=n.store[n.storeProp].taxes.findIndex(t=>t.name===ie&&t.type===le);r>-1&&n.store[n.storeProp].taxes.splice(r,1);let x=e.taxTypes.findIndex(t=>t.name===ie&&t.type===le);x>-1&&e.taxTypes.splice(x,1)}return(r,x)=>(h(),k(kt,{onAddTax:I}))}};export{At as _,Et as a,Lt as b,qt as c};
