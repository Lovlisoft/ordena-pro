import{H as oe,as as fe,ab as _e,M as Be,l as ne,e as u,aH as H,d as K,E as xe,an as Y,p as D,q as X,aJ as ve,aj as se,ay as Me,v as pe,r as w,o as b,c as z,b as s,a as d,x as o,j as V,aL as ye,h as v,g as J,z as q,aM as de,t as T,aI as ge,aN as Te,ap as Pe,F as he,I as re,N as Ce,i as ke,n as Z,aw as me,u as Ve,L as De,f as be,w as $e,J as qe,K as Ee}from"./main.39f33818.js";import{D as Le,d as Ae}from"./DragIcon.f997cd14.js";const Ue={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},ze={colspan:"5",class:"p-0 text-left align-top pt-2"},je={class:"w-full"},Ne=s("colgroup",null,[s("col",{style:{width:"30%","min-width":"280px"}}),s("col",{style:{width:"10%","min-width":"120px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}})],-1),Fe={class:"px-2 py-2 text-left align-top"},Oe={class:"flex justify-start"},Ge={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},Xe={class:"px-2 py-2 text-right align-top"},Re={class:"px-2 py-2 text-left align-top"},Ye={class:"flex flex-col"},He={class:"flex-auto flex-fill bd-highlight"},Je={class:"relative w-full"},Ke={class:"px-2 py-2 text-right align-top"},Qe={class:"flex items-center justify-end text-sm"},We={class:"flex items-center justify-center w-6 h-10 mx-2"},Ze={class:"px-12 pb-4 text-right"},et={class:"text-sm pr-6"},tt={class:"text-sm pr-6"},at={class:"text-sm"},st={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(m,{emit:g}){const{getItemDecimalPrecisionMultiplier:p}=ge,e=m,c=oe(),P=fe(),r=_e();Be();const{t:$}=ne(),C=u({get:()=>r.newEstimate.show_price_breakdown}),i=u({get:()=>e.itemData.quantity,set:a=>{O("quantity",parseFloat(a))}});u({get:()=>{const a=e.itemData.price;return parseFloat(a)>0?a/100:a},set:a=>{if(parseFloat(a)>0){let l=Math.round(a*100);O("price",l)}else O("price",a)}});const M=u({get:()=>{const a=e.itemData.precision_price;return parseFloat(a)>0?a/p(H):a},set:a=>{if(parseFloat(a)>0){let l=Math.round(a*p(H)),B=Math.round(a*100);O("precision_price",l),O("price",B)}else O("precision_price",a),O("price",a)}}),k=u({get:()=>I(t)}),A=u({get:()=>I(_)}),L=u({get:()=>I(y)});function I(a){return a.value.toLocaleString("es-MX",{style:"currency",currency:"MXN"})}const f=K(null),x=K(null),S=u(()=>e.itemData.precision_price*e.itemData.quantity),U=u(()=>e.itemData.precision_price*e.itemData.quantity/p(H)),n=u({get:()=>{var a;return(a=x.value)!=null?a:t.value+_.value+y.value},set:a=>{let l=Math.round((n.value+Number.EPSILON)*100)/100,B=Math.round((parseFloat(a)+Number.EPSILON)*100)/100;l!==B&&(f.value=Math.floor(Date.now())+300,setTimeout(function(j){Math.floor(Date.now())>f.value&&(h(parseFloat(a)),x.value=parseFloat(a))},300))}});function h(a){let l=0,B=e.itemData.ieps,j=1.16;l=C.value?Math.round(a/(B+(M.value-B)*j)):Math.round(a/(B+M.value*j));let W=C.value?(a/l-B)/j+B:(a/l-B)/j;l>0&&W>0&&a>0&&(i.value=l,M.value=W)}const t=u({get:()=>C.value?U.value-y.value:U.value}),y=u({get:()=>e.itemData.quantity*e.itemData.ieps}),_=u({get:()=>t.value*.16});xe(()=>C.value,a=>{x.value&&h(x.value)}),u(()=>U.value-e.itemData.discount_val);const N=u(()=>e.currency?e.currency:c.selectedCompanyCurrency),R=u(()=>e.store[e.storeProp].items.length!=1),ee=u(()=>Math.round(Y.exports.sumBy(e.itemData.taxes,function(a){return a.compound_tax?0:a.amount}))),Q=u(()=>Math.round(Y.exports.sumBy(e.itemData.taxes,function(a){return a.compound_tax?a.amount:0}))),te=u(()=>ee.value+Q.value),ie={name:{required:D.withMessage($("validation.required"),X)},quantity:{required:D.withMessage($("validation.required"),X),minValue:D.withMessage($("validation.qty_must_greater_than_zero"),ve(0)),maxLength:D.withMessage($("validation.amount_maxlength"),se(20))},price:{required:D.withMessage($("validation.required"),X),minValue:D.withMessage($("validation.number_length_minvalue"),ve(1)),maxLength:D.withMessage($("validation.price_maxlength"),se(20))},discount_val:{between:D.withMessage($("validation.discount_maxlength"),Me(0,u(()=>S.value)))},description:{maxLength:D.withMessage($("validation.notes_maxlength"),se(65e3))}},F=pe(ie,u(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function le(a){e.store.$patch(B=>{B[e.storeProp].items[e.index].taxes[a.index]=a.item});let l=e.itemData.taxes[e.itemData.taxes.length-1];(l==null?void 0:l.tax_type_id)!==0&&e.store.$patch(B=>{B[e.storeProp].items[e.index].taxes.push({...Te,id:Pe.raw()})}),ae()}function E(a){O("name",a)}function Ie(a){e.store.$patch(l=>{if(l[e.storeProp].items[e.index].name=a.name,l[e.storeProp].items[e.index].price=a.price,l[e.storeProp].items[e.index].item_id=a.id,l[e.storeProp].items[e.index].description=a.description,l[e.storeProp].items[e.index].precision=a.precision,l[e.storeProp].items[e.index].precision_price=a.precision_price,l[e.storeProp].items[e.index].ieps=a.ieps,a.unit&&(l[e.storeProp].items[e.index].unit_name=a.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&a.taxes){let B=0;a.taxes.forEach(j=>{le({index:B,item:{...j}}),B++})}l[e.storeProp].exchange_rate&&(l[e.storeProp].items[e.index].price/=l[e.storeProp].exchange_rate)}),P.fetchItems(),ae()}function ae(){var B,j;let a=(j=(B=e.store[e.storeProp])==null?void 0:B.items[e.index])==null?void 0:j.taxes;a||(a=[]);let l={...e.store[e.storeProp].items[e.index],index:e.index,total:n.value,sub_total:S.value,totalSimpleTax:ee.value,totalCompoundTax:Q.value,totalTax:te.value,tax:te.value,taxes:[...a]};e.store.updateItem(l)}function O(a,l){e.store.$patch(B=>{B[e.storeProp].items[e.index][a]=l}),ae()}return(a,l)=>{const B=w("BaseItemSelect"),j=w("BaseInput"),W=w("BaseContentPlaceholdersText"),we=w("BaseContentPlaceholders"),Se=w("BaseIcon");return b(),z("tr",Ue,[s("td",ze,[s("table",je,[Ne,s("tbody",null,[s("tr",null,[s("td",Fe,[s("div",Oe,[s("div",Ge,[d(Le)]),d(B,{type:"Invoice",item:m.itemData,invalid:o(F).name.$error,"invalid-description":o(F).description.$error,taxes:m.itemData.taxes,index:m.index,"store-prop":m.storeProp,store:m.store,onSearch:E,onSelect:Ie},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),s("td",Xe,[d(j,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=G=>i.value=G),invalid:o(F).quantity.$error,"content-loading":m.loading,type:"number",small:"",min:"0",step:"any",onChange:l[1]||(l[1]=G=>ae()),onInput:l[2]||(l[2]=G=>o(F).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),s("td",Re,[s("div",Ye,[s("div",He,[s("div",Je,[(b(),V(ye,{key:N.value,modelValue:M.value,"onUpdate:modelValue":l[3]||(l[3]=G=>M.value=G),invalid:o(F).price.$error,"content-loading":m.loading,currency:N.value,"item-precision":o(H)},null,8,["modelValue","invalid","content-loading","currency","item-precision"]))])])])]),s("td",Ke,[s("div",Qe,[s("span",null,[m.loading?(b(),V(we,{key:0},{default:v(()=>[d(W,{lines:1,class:"w-16 h-5"})]),_:1})):(b(),V(ye,{key:N.value,modelValue:n.value,"onUpdate:modelValue":l[4]||(l[4]=G=>n.value=G),currency:N.value,"item-precision":2},null,8,["modelValue","currency"]))]),s("div",We,[R.value?(b(),V(Se,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:l[5]||(l[5]=G=>m.store.removeItem(m.index))})):J("",!0)])])])])])]),s("div",Ze,[d(de,null,{default:v(()=>[q("Monto Base:")]),_:1}),q(),s("span",et,T(k.value),1),d(de,null,{default:v(()=>[q("IEPS:")]),_:1}),q(),s("span",tt,T(L.value),1),d(de,null,{default:v(()=>[q("IVA (16%): ")]),_:1}),q(),s("span",at,T(A.value),1)])])])}}},ot={class:"text-center item-table min-w-full"},nt=s("colgroup",null,[s("col",{style:{width:"30%","min-width":"280px"}}),s("col",{style:{width:"10%","min-width":"120px"}}),s("col",{style:{width:"20%","min-width":"120px"}}),s("col",{style:{width:"15%","min-width":"120px"}})],-1),rt={class:"bg-white border border-gray-200 border-solid"},it={class:"px-2 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},lt={key:1,class:"pl-7"},dt={class:"px-2 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},ct={key:1},ut={class:"px-2 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},pt={key:1},mt={key:0,class:"px-2 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},vt={key:1},yt={class:"px-2 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},ft={key:1,class:"pr-10 column-heading"},At={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(m){const g=m,p=oe(),e=u(()=>g.currency?g.currency:p.selectedCompanyCurrency);return(c,P)=>{const r=w("BaseContentPlaceholdersText"),$=w("BaseContentPlaceholders"),C=w("BaseIcon");return b(),z(he,null,[s("table",ot,[nt,s("thead",rt,[s("tr",null,[s("th",it,[m.isLoading?(b(),V($,{key:0},{default:v(()=>[d(r,{lines:1,class:"w-16 h-5"})]),_:1})):(b(),z("span",lt,T(c.$tc("items.item",2)),1))]),s("th",dt,[m.isLoading?(b(),V($,{key:0},{default:v(()=>[d(r,{lines:1,class:"w-16 h-5"})]),_:1})):(b(),z("span",ct,T(c.$t("invoices.item.quantity")),1))]),s("th",ut,[m.isLoading?(b(),V($,{key:0},{default:v(()=>[d(r,{lines:1,class:"w-16 h-5"})]),_:1})):(b(),z("span",pt,T(c.$t("invoices.item.price")),1))]),m.store[m.storeProp].discount_per_item==="YES"?(b(),z("th",mt,[m.isLoading?(b(),V($,{key:0},{default:v(()=>[d(r,{lines:1,class:"w-16 h-5"})]),_:1})):(b(),z("span",vt,T(c.$t("invoices.item.discount")),1))])):J("",!0),s("th",yt,[m.isLoading?(b(),V($,{key:0},{default:v(()=>[d(r,{lines:1,class:"w-16 h-5"})]),_:1})):(b(),z("span",ft,T(c.$t("invoices.item.amount")),1))])])]),d(o(Ae),{modelValue:m.store[m.storeProp].items,"onUpdate:modelValue":P[0]||(P[0]=i=>m.store[m.storeProp].items=i),"item-key":"id",tag:"tbody",handle:".handle"},{item:v(({element:i,index:M})=>[(b(),V(st,{key:i.id,index:M,"item-data":i,loading:m.isLoading,currency:e.value,"item-validation-scope":m.itemValidationScope,"invoice-items":m.store[m.storeProp].items,store:m.store,"store-prop":m.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),s("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:P[1]||(P[1]=(...i)=>m.store.addItem&&m.store.addItem(...i))},[d(C,{name:"PlusCircleIcon",class:"mr-2"}),q(" "+T(c.$t("general.add_new_item")),1)])],64)}}},_t={class:"flex justify-between w-full"},xt={class:"px-8 py-8 sm:p-6"},gt={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},ht=["onClick"],bt=["src","alt"],$t=["alt","src"],It={key:1,class:"z-0 flex ml-3 pt-5"},wt={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ut={__name:"SelectTemplateModal",setup(m){const g=re(),p=Ce(),e=K(""),c=u(()=>g.active&&g.componentName==="SelectTemplate"),P=u(()=>g.title);function r(){g.data.store[g.data.storeProp].template_name?e.value=g.data.store[g.data.storeProp].template_name:e.value=g.data.templates[0]}async function $(){await g.data.store.setTemplate(e.value),!g.data.store.isEdit&&g.data.isMarkAsDefault&&(g.data.storeProp=="newEstimate"?await p.updateUserSettings({settings:{default_estimate_template:e.value}}):g.data.storeProp=="newInvoice"&&await p.updateUserSettings({settings:{default_invoice_template:e.value}})),i()}function C(){return new URL("/img/tick.png",self.location)}function i(){g.closeModal(),setTimeout(()=>{g.$reset()},300)}return(M,k)=>{const A=w("BaseIcon"),L=w("BaseCheckbox"),I=w("BaseButton"),f=w("BaseModal");return b(),V(f,{show:c.value,onClose:i,onOpen:r},{header:v(()=>[s("div",_t,[q(T(P.value)+" ",1),d(A,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:i})])]),default:v(()=>[s("div",xt,[o(g).data?(b(),z("div",gt,[(b(!0),z(he,null,ke(o(g).data.templates,(x,S)=>(b(),z("div",{key:S,class:Z([{"border border-solid border-primary-500":e.value===x.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:U=>e.value=x.name},[s("img",{src:x.path,alt:x.name,class:"w-full min-h-[100px]"},null,8,bt),e.value===x.name?(b(),z("img",{key:0,alt:x.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:C()},null,8,$t)):J("",!0),s("span",{class:Z(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":e.value===x.name,"text-gray-600":e.value!=x.name}])},T(x.name),3)],10,ht))),128))])):J("",!0),o(g).data.store.isEdit?J("",!0):(b(),z("div",It,[d(L,{modelValue:o(g).data.isMarkAsDefault,"onUpdate:modelValue":k[0]||(k[0]=x=>o(g).data.isMarkAsDefault=x),"set-initial-value":!1,variant:"primary",label:M.$t("general.mark_as_default"),description:o(g).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),s("div",wt,[d(I,{class:"mr-3",variant:"primary-outline",onClick:i},{default:v(()=>[q(T(M.$t("general.cancel")),1)]),_:1}),d(I,{variant:"primary",onClick:k[1]||(k[1]=x=>$())},{left:v(x=>[d(A,{name:"SaveIcon",class:Z(x.class)},null,8,["class"])]),default:v(()=>[q(" "+T(M.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},St={class:"flex justify-between w-full"},Bt={class:"item-modal"},Mt={class:"px-8 py-8 sm:p-6"},Tt={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},zt={__name:"ItemModal",emits:["newItem"],setup(m,{emit:g}){const{getItemDecimalPrecisionMultiplier:p}=ge,e=re(),c=fe(),P=oe(),r=me();_e(),Ve();const{t:$}=ne(),C=K(!1),i=K(P.selectedCompanySettings.tax_per_item),M=u(()=>e.active&&e.componentName==="ItemModal"),k=(t,y)=>{c.$patch(_=>{_.currentItem[t]=y})},A=u({get:()=>{const t=c.currentItem.price;return parseFloat(t)>0?t/100:t},set:t=>{if(parseFloat(t)>0){let y=Math.round(t*100);k("price",y)}else k("price",t)}}),L=u({get:()=>{const t=c.currentItem.precision_price;return parseFloat(t)>0?t/p(H):t},set:t=>{if(parseFloat(t)>0){let y=Math.round(t*p(H)),_=Math.round(t*100);k("precision_price",y),k("price",_)}else k("precision_price",t),k("price",t)}}),I=u({get:()=>c.currentItem.taxes.map(t=>{if(t)return{...t,tax_type_id:t.id,tax_name:t.name+" ("+t.percent+"%)"}}),set:t=>{c.$patch(y=>{y.currentItem.taxes=t})}}),f=u(()=>i.value==="YES"),x={name:{required:D.withMessage($("validation.required"),X),minLength:D.withMessage($("validation.name_min_length",{count:3}),De(3))},description:{maxLength:D.withMessage($("validation.description_maxlength",{count:255}),se(255))}},S=pe(x,u(()=>c.currentItem)),U=u(()=>r.taxTypes.map(t=>({...t,tax_name:t.name+" ("+t.percent+"%)"})));be(()=>{S.value.$reset(),c.fetchItemUnits({limit:"all"})});async function n(){if(S.value.$touch(),S.value.$invalid)return!0;let t={...c.currentItem,taxes:c.currentItem.taxes.map(_=>({tax_type_id:_.id,amount:A.value*_.percent,percent:_.percent,name:_.name,collective_tax:0}))};C.value=!0,await(c.isEdit?c.updateItem:c.addItem)(t).then(_=>{C.value=!1,_.data.data&&e.data&&e.refreshData(_.data.data),h()})}function h(){e.closeModal(),setTimeout(()=>{c.resetCurrentItem(),e.$reset(),S.value.$reset()},300)}return(t,y)=>{const _=w("BaseIcon"),N=w("BaseInput"),R=w("BaseInputGroup"),ee=w("BaseItemMoney"),Q=w("BaseMultiselect"),te=w("BaseTextarea"),ie=w("BaseInputGrid"),F=w("BaseButton"),le=w("BaseModal");return b(),V(le,{show:M.value,onClose:h},{header:v(()=>[s("div",St,[q(T(o(e).title)+" ",1),d(_,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:h})])]),default:v(()=>[s("div",Bt,[s("form",{action:"",onSubmit:$e(n,["prevent"])},[s("div",Mt,[d(ie,{layout:"one-column"},{default:v(()=>[d(R,{label:t.$t("items.name"),required:"",error:o(S).name.$error&&o(S).name.$errors[0].$message},{default:v(()=>[d(N,{modelValue:o(c).currentItem.name,"onUpdate:modelValue":y[0]||(y[0]=E=>o(c).currentItem.name=E),type:"text",invalid:o(S).name.$error,onInput:y[1]||(y[1]=E=>o(S).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),d(R,{label:t.$t("items.price")},{default:v(()=>[(b(),V(ee,{key:o(P).selectedCompanyCurrency,modelValue:L.value,"onUpdate:modelValue":y[2]||(y[2]=E=>L.value=E),currency:o(P).selectedCompanyCurrency,"item-precision":o(H),class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency","item-precision"]))]),_:1},8,["label"]),d(R,{label:t.$t("items.unit")},{default:v(()=>[d(Q,{modelValue:o(c).currentItem.unit_id,"onUpdate:modelValue":y[3]||(y[3]=E=>o(c).currentItem.unit_id=E),label:"name",options:o(c).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:t.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),f.value?(b(),V(R,{key:0,label:t.$t("items.taxes")},{default:v(()=>[d(Q,{modelValue:I.value,"onUpdate:modelValue":y[4]||(y[4]=E=>I.value=E),options:U.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):J("",!0),d(R,{label:t.$t("items.description"),error:o(S).description.$error&&o(S).description.$errors[0].$message},{default:v(()=>[d(te,{modelValue:o(c).currentItem.description,"onUpdate:modelValue":y[5]||(y[5]=E=>o(c).currentItem.description=E),rows:"4",cols:"50",invalid:o(S).description.$error,onInput:y[6]||(y[6]=E=>o(S).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),s("div",Tt,[d(F,{class:"mr-3",variant:"primary-outline",type:"button",onClick:h},{default:v(()=>[q(T(t.$t("general.cancel")),1)]),_:1}),d(F,{loading:C.value,disabled:C.value,variant:"primary",type:"submit"},{left:v(E=>[d(_,{name:"SaveIcon",class:Z(E.class)},null,8,["class"])]),default:v(()=>[q(" "+T(o(c).isEdit?t.$t("general.update"):t.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},Pt={class:"flex justify-between w-full"},Ct={class:"flex flex-col"},kt={class:"text-sm text-gray-500 mt-1"},Vt={class:"p-4 sm:p-6"},Dt={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},qt={__name:"TaxationAddressModal",emits:["addTax"],setup(m,{emit:g}){const p=re();qe();const e=Ee({state:"",city:"",address_street_1:"",zip:""}),c=K(!1),P=me(),{t:r}=ne(),$=u(()=>p.active&&p.componentName==="TaxationAddressModal"),C=u(()=>({state:{required:D.withMessage(r("validation.required"),X)},city:{required:D.withMessage(r("validation.required"),X)},address_street_1:{required:D.withMessage(r("validation.required"),X)},zip:{required:D.withMessage(r("validation.required"),X)}})),i=pe(C,u(()=>e));async function M(){if(i.value.$touch(),i.value.$invalid)return!0;let I={address:e};p.id&&(I.customer_id=p.id),e.address_street_1=e.address_street_1.replace(/(\r\n|\n|\r)/gm,""),c.value=!0,await P.fetchSalesTax(I).then(f=>{c.value=!1,k("addTax",f.data.data),L()}).catch(f=>{c.value=!1})}const k=g;function A(){var I,f,x,S;e.state=(I=p==null?void 0:p.data)==null?void 0:I.state,e.city=(f=p==null?void 0:p.data)==null?void 0:f.city,e.address_street_1=(x=p==null?void 0:p.data)==null?void 0:x.address_street_1,e.zip=(S=p==null?void 0:p.data)==null?void 0:S.zip}function L(){p.closeModal()}return(I,f)=>{const x=w("BaseIcon"),S=w("BaseInput"),U=w("BaseInputGroup"),n=w("BaseTextarea"),h=w("BaseInputGrid"),t=w("BaseButton"),y=w("BaseModal");return b(),V(y,{show:$.value,onClose:L,onOpen:A},{header:v(()=>[s("div",Pt,[s("div",Ct,[q(T(o(p).title)+" ",1),s("p",kt,T(o(p).content),1)]),d(x,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:L})])]),default:v(()=>[s("form",{onSubmit:$e(M,["prevent"])},[s("div",Vt,[d(h,{layout:"one-column"},{default:v(()=>[d(U,{required:"",error:o(i).state.$error&&o(i).state.$errors[0].$message,label:I.$t("customers.state")},{default:v(()=>[d(S,{modelValue:e.state,"onUpdate:modelValue":f[0]||(f[0]=_=>e.state=_),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:o(i).state.$error,onInput:f[1]||(f[1]=_=>o(i).state.$touch()),placeholder:I.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),d(U,{required:"",error:o(i).city.$error&&o(i).city.$errors[0].$message,label:I.$t("customers.city")},{default:v(()=>[d(S,{modelValue:e.city,"onUpdate:modelValue":f[2]||(f[2]=_=>e.city=_),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:o(i).city.$error,onInput:f[3]||(f[3]=_=>o(i).city.$touch()),placeholder:I.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),d(U,{required:"",error:o(i).address_street_1.$error&&o(i).address_street_1.$errors[0].$message,label:I.$t("customers.address")},{default:v(()=>[d(n,{modelValue:e.address_street_1,"onUpdate:modelValue":f[4]||(f[4]=_=>e.address_street_1=_),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:o(i).address_street_1.$error,onInput:f[5]||(f[5]=_=>o(i).address_street_1.$touch()),placeholder:I.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),d(U,{required:"",error:o(i).zip.$error&&o(i).zip.$errors[0].$message,label:I.$t("customers.zip_code")},{default:v(()=>[d(S,{modelValue:e.zip,"onUpdate:modelValue":f[6]||(f[6]=_=>e.zip=_),invalid:o(i).zip.$error,onInput:f[7]||(f[7]=_=>o(i).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:I.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),s("div",Dt,[d(t,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:L},{default:v(()=>[q(T(I.$t("general.cancel")),1)]),_:1}),d(t,{loading:c.value,variant:"primary",type:"submit"},{left:v(_=>[c.value?J("",!0):(b(),V(x,{key:0,name:"SaveIcon",class:Z(_.class)},null,8,["class"]))]),default:v(()=>[q(" "+T(I.$t("general.save")),1)]),_:1},8,["loading"])])],32)]),_:1},8,["show"])}}},ce="Sales Tax",ue="MODULE",jt={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(m){const g=re(),p=oe(),e=me(),{t:c}=ne(),P=K(!1),r=m,$=u(()=>r.isEdit?r.store[r.storeProp].sales_tax_address_type==="billing":p.selectedCompanySettings.sales_tax_address_type==="billing"),C=u(()=>p.selectedCompanySettings.sales_tax_us_enabled==="YES"),i=u(()=>r.isEdit?r.store[r.storeProp].sales_tax_type==="customer_level":p.selectedCompanySettings.sales_tax_type==="customer_level"),M=u(()=>r.isEdit?r.store[r.storeProp].sales_tax_type==="company_level":p.selectedCompanySettings.sales_tax_type==="company_level"),k=u(()=>{if(i.value&&A.value){let n=$.value?r.customer.billing:r.customer.shipping;return{address:Y.exports.pick(n,["address_street_1","city","state","zip"]),customer_id:r.customer.id}}else if(M.value&&A.value)return{address:Y.exports.pick(address,["address_street_1","city","state","zip"])}}),A=u(()=>{var n,h;if(i.value){let t=$.value?(n=r.customer)==null?void 0:n.billing:(h=r.customer)==null?void 0:h.shipping;return L(t)}else if(M.value)return L(p.selectedCompany.address);return!1});xe(()=>r.customer,(n,h)=>{if(n&&h&&i.value){I(n,h);return}!A.value&&i.value&&n?setTimeout(()=>{f()},500):i.value&&n?x():i.value&&!n&&U()}),be(()=>{M.value&&(A.value?x():f())});function L(n){return n?n.address_street_1&&n.city&&n.state&&n.zip:!1}function I(n,h){const t=$.value?n.billing:n.shipping,y=$.value?h.billing:h.shipping,_=Y.exports.pick(t,["address_street_1","city","state","zip"]),N=Y.exports.pick(y,["address_street_1","city","state","zip"]);Y.exports.isEqual(_,N)||x()}function f(){var t,y;if(!C.value)return;let n=null,h="";i.value?$.value?(n=(t=r.customer)==null?void 0:t.billing,h=c("settings.taxations.add_billing_address")):(n=(y=r.customer)==null?void 0:y.shipping,h=c("settings.taxations.add_shipping_address")):(n=p.selectedCompany.address,h=c("settings.taxations.add_company_address")),g.openModal({title:h,content:c("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:n,id:i.value?r.customer.id:""})}async function x(){!C.value||(P.value=!0,await e.fetchSalesTax(k.value).then(n=>{S(n.data.data),P.value=!1}).catch(n=>{n.response.data.error&&setTimeout(()=>{f()},500),P.value=!1}))}function S(n){n.tax_type_id=n.id;const h=r.store[r.storeProp].taxes.findIndex(t=>t.name===ce&&t.type===ue);h>-1?Object.assign(r.store[r.storeProp].taxes[h],n):r.store[r.storeProp].taxes.push(n)}function U(){const n=r.store[r.storeProp].taxes.findIndex(t=>t.name===ce&&t.type===ue);n>-1&&r.store[r.storeProp].taxes.splice(n,1);let h=e.taxTypes.findIndex(t=>t.name===ce&&t.type===ue);h>-1&&e.taxTypes.splice(h,1)}return(n,h)=>(b(),V(qt,{onAddTax:S}))}};export{Ut as _,zt as a,jt as b,At as c};
