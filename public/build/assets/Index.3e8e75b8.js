import{X as et,H,M as at,af as nt,Y as c,A as l,u as _,l as st,d as C,K as it,a8 as ot,N as ct,e as N,ad as rt,ae as lt,r as f,o as k,j as w,h as o,a as h,a9 as D,aa as V,x as v,n as A,z as T,t as y,a4 as Y,Q as S,g as dt,b as M,c as ut}from"./main.3f3e0763.js";import{u as mt}from"./payment.b559ad46.js";import{_ as ht}from"./CapsuleIcon.79f3e270.js";import{_ as ft}from"./SendPaymentModal.e5617f0f.js";import"./mail-driver.79f51228.js";var U={date:"fecha"};const pt=(x=!1)=>{const b=x?window.pinia.defineStore:et,{global:m}=window.i18n;return b({id:"transaction",state:()=>({transactions:[],transactionTotalCount:0,selectAllField:!1,selectedTransactions:[],selectedNote:null,showExchangeRate:!1,drivers:[],providers:[],transactionProviders:{id:null,name:"",driver:"",active:!1,settings:{key:"",secret:""}},currentTransaction:{...U},transactionModes:[],currentTransactionMode:{id:"",name:null},isFetchingInitialData:!1}),getters:{isEdit:e=>!!e.transactionProviders.id},actions:{fetchTransactionInitialData(e){const s=H(),n=at();this.isFetchingInitialData=!0;let t=[];e&&(t=[this.fetchTransaction(n.params.id)]),Promise.all([this.fetchTransactionModes({limit:"all"}),this.getNextNumber(),...t]).then(async([a,d,r])=>{e?r.data.data.invoice&&(this.currentTransaction.maxPayableAmount=parseInt(r.data.data.invoice.due_amount)):!e&&d.data&&(this.currentTransaction.transaction_date=nt().format("YYYY-MM-DD"),this.currentTransaction.transaction_number=d.data.nextNumber,this.currentTransaction.currency=s.selectedCompanyCurrency),this.isFetchingInitialData=!1}).catch(a=>{c(a)})},fetchTransactions(e){return new Promise((s,n)=>{l.get("/api/v1/bank-transactions",{params:e}).then(t=>{this.transactions=t.data.data,this.transactionTotalCount=t.data.meta.total,s(t)}).catch(t=>{c(t),n(t)})})},fetchTransaction(e){return new Promise((s,n)=>{l.get(`/api/v1/bank-transactions/${e}`).then(t=>{Object.assign(this.currentTransaction,t.data.data),s(t)}).catch(t=>{c(t),n(t)})})},addTransaction(e){return new Promise((s,n)=>{l.post("/api/v1/bank-transactions",e).then(t=>{this.transactions.push(t.data),_().showNotification({type:"success",message:m.t("transactions.created_message")}),s(t)}).catch(t=>{c(t),n(t)})})},updateTransaction(e){return new Promise((s,n)=>{l.put(`/api/v1/bank-transactions/${e.id}`,e).then(t=>{if(t.data){let a=this.transactions.findIndex(r=>r.id===t.data.data.id);this.transactions[a]=e.transaction,_().showNotification({type:"success",message:m.t("transactions.updated_message")})}s(t)}).catch(t=>{c(t),n(t)})})},deleteTransaction(e){const s=_();return new Promise((n,t)=>{l.post("/api/v1/bank-transactions/delete",e).then(a=>{let d=this.transactions.findIndex(r=>r.id===e);this.transactions.splice(d,1),s.showNotification({type:"success",message:m.t("transactions.deleted_message",1)}),n(a)}).catch(a=>{c(a),t(a)})})},deleteMultipleTransactions(){const e=_();return new Promise((s,n)=>{l.post("/api/v1/bank-transactions/delete",{ids:this.selectedTransactions}).then(t=>{this.selectedTransactions.forEach(a=>{let d=this.transactions.findIndex(r=>r.id===a.id);this.transactions.splice(d,1)}),e.showNotification({type:"success",message:m.tc("transactions.deleted_message",2)}),s(t)}).catch(t=>{c(t),n(t)})})},setSelectAllState(e){this.selectAllField=e},selectTransaction(e){this.selectedTransactions=e,this.selectedTransactions.length===this.transactions.length?this.selectAllField=!0:this.selectAllField=!1},selectAllTransactions(){if(this.selectedTransactions.length===this.transactions.length)this.selectedTransactions=[],this.selectAllField=!1;else{let e=this.transactions.map(s=>s.id);this.selectedTransactions=e,this.selectAllField=!0}},selectNote(e){this.selectedNote=null,this.selectedNote=e},resetSelectedNote(e){this.selectedNote=null},searchTransaction(e){return new Promise((s,n)=>{l.get("/api/v1/bank-transactions",{params:e}).then(t=>{this.transactions=t.data,s(t)}).catch(t=>{c(t),n(t)})})},previewTransaction(e){return new Promise((s,n)=>{l.get(`/api/v1/bank-transactions/${e.id}/send/preview`,{params:e}).then(t=>{s(t)}).catch(t=>{c(t),n(t)})})},sendEmail(e){return new Promise((s,n)=>{l.post(`/api/v1/bank-transactions/${e.id}/send`,e).then(t=>{_().showNotification({type:"success",message:m.t("transactions.send_transaction_successfully")}),s(t)}).catch(t=>{c(t),n(t)})})},getNextNumber(e,s=!1){return new Promise((n,t)=>{l.get("/api/v1/next-number?key=transaction",{params:e}).then(a=>{s&&(this.currentTransaction.transaction_number=a.data.nextNumber),n(a)}).catch(a=>{c(a),t(a)})})},resetCurrentTransaction(){this.currentTransaction={...U}},fetchTransactionModes(e){return new Promise((s,n)=>{l.get("/api/v1/transaction-methods",{params:e}).then(t=>{this.transactionModes=t.data.data,s(t)}).catch(t=>{c(t),n(t)})})},fetchTransactionMode(e){return new Promise((s,n)=>{l.get(`/api/v1/transaction-methods/${e}`).then(t=>{this.currentTransactionMode=t.data.data,s(t)}).catch(t=>{c(t),n(t)})})},addTransactionMode(e){const s=_();return new Promise((n,t)=>{l.post("/api/v1/transaction-methods",e).then(a=>{this.transactionModes.push(a.data.data),s.showNotification({type:"success",message:m.t("settings.transaction_modes.transaction_mode_added")}),n(a)}).catch(a=>{c(a),t(a)})})},updateTransactionMode(e){const s=_();return new Promise((n,t)=>{l.put(`/api/v1/transaction-methods/${e.id}`,e).then(a=>{if(a.data){let d=this.transactionModes.findIndex(r=>r.id===a.data.data.id);this.transactionModes[d]=e.transactionModes,s.showNotification({type:"success",message:m.t("settings.transaction_modes.transaction_mode_updated")})}n(a)}).catch(a=>{c(a),t(a)})})},deleteTransactionMode(e){const s=_();return new Promise((n,t)=>{l.delete(`/api/v1/transaction-methods/${e}`).then(a=>{let d=this.transactionModes.findIndex(r=>r.id===e);this.transactionModes.splice(d,1),a.data.success&&s.showNotification({type:"success",message:m.t("settings.transaction_modes.deleted_message")}),n(a)}).catch(a=>{c(a),t(a)})})}}})()},_t={class:"relative table-container"},yt={class:"absolute items-center left-6 top-2.5 select-none"},bt={class:"relative block"},gt={key:1},St={__name:"Index",setup(x){const{t:b}=st();let m=C(!1),e=C(!0),s=C(null);const n=it({customer:"",payment_mode:"",payment_number:""}),t=mt(),a=pt();H(),ot();const d=ct(),r=N(()=>!a.transactionTotalCount&&!e.value),R=N(()=>[{key:"status",sortable:!1,thClass:"extra w-10",tdClass:"text-left text-sm font-medium extra"},{key:"date",label:b("transactions.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"account",label:b("transactions.bank")},{key:"reference",label:b("transactions.reference")},{key:"debit",label:b("transactions.debit")},{key:"credit",label:b("transactions.credit")},{key:"actions",label:"",tdClass:"text-right text-sm font-medium",sortable:!1}]),I=N({get:()=>t.selectedPayments,set:u=>t.selectPayment(u)}),F=N({get:()=>t.selectAllField,set:u=>t.setSelectAllState(u)});rt(n,()=>{W()},{debounce:500}),lt(()=>{t.selectAllField&&t.selectAllPayments()}),t.fetchPaymentModes({limit:"all"});function j(){return d.hasAbilities([S.DELETE_PAYMENT,S.EDIT_PAYMENT,S.VIEW_PAYMENT,S.SEND_PAYMENT])}async function z({page:u,filter:g,sort:P}){let B={customer_id:n.customer_id,payment_method_id:n.payment_mode!==null?n.payment_mode:"",payment_number:n.payment_number,orderByField:P.fieldName||"created_at",orderBy:P.order||"desc",page:u};e.value=!0;let p=await a.fetchTransactions(B);return e.value=!1,{data:p.data.data,pagination:{totalPages:p.data.meta.last_page,currentPage:p.data.meta.current_page,totalCount:p.data.meta.total,limit:10}}}function O(){s.value&&s.value.refresh()}function W(){O()}function X(){n.customer_id="",n.payment_mode="",n.payment_number=""}function K(){m.value&&X(),m.value=!m.value}return(u,g)=>{const P=f("BaseBreadcrumbItem"),B=f("BaseBreadcrumb"),p=f("BaseIcon"),E=f("BaseButton"),L=f("BasePageHeader"),Q=f("BaseEmptyPlaceholder"),$=f("BaseCheckbox"),q=f("router-link"),G=f("PaymentDropdown"),J=f("BaseTable"),Z=f("BasePage");return k(),w(Z,{class:"payments"},{default:o(()=>[h(ft),h(L,{title:u.$t("transactions.title")},{actions:o(()=>[D(h(E,{variant:"primary-outline",onClick:K},{right:o(i=>[v(m)?(k(),w(p,{key:1,name:"XIcon",class:A(i.class)},null,8,["class"])):(k(),w(p,{key:0,class:A(i.class),name:"FilterIcon"},null,8,["class"]))]),default:o(()=>[T(y(u.$t("general.filter"))+" ",1)]),_:1},512),[[V,v(t).paymentTotalCount]])]),default:o(()=>[h(B,null,{default:o(()=>[h(P,{title:u.$t("general.home"),to:"dashboard"},null,8,["title"]),h(P,{title:u.$tc("transactions.transactions",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r.value?(k(),w(Q,{key:0,title:u.$t("payments.no_payments"),description:u.$t("payments.list_of_payments")},Y({default:o(()=>[h(ht,{class:"mt-5 mb-4"})]),_:2},[v(d).hasAbilities(v(S).CREATE_PAYMENT)?{name:"actions",fn:o(()=>[h(E,{variant:"primary-outline",onClick:g[0]||(g[0]=i=>u.$router.push("/admin/payments/create"))},{left:o(i=>[h(p,{name:"PlusIcon",class:A(i.class)},null,8,["class"])]),default:o(()=>[T(" "+y(u.$t("payments.add_new_payment")),1)]),_:1})]),key:"0"}:void 0]),1032,["title","description"])):dt("",!0),D(M("div",_t,[h(J,{ref_key:"tableComponent",ref:s,data:z,columns:R.value,"placeholder-count":v(a).transactionTotalCount>=20?10:5,class:"mt-3"},Y({header:o(()=>[M("div",yt,[h($,{modelValue:F.value,"onUpdate:modelValue":g[1]||(g[1]=i=>F.value=i),variant:"primary",onChange:v(t).selectAllPayments},null,8,["modelValue","onChange"])])]),"cell-status":o(({row:i})=>[M("div",bt,[h($,{id:i.data.id,modelValue:I.value,"onUpdate:modelValue":g[2]||(g[2]=tt=>I.value=tt),value:i.data.id,variant:"primary"},null,8,["id","modelValue","value"])])]),"cell-date":o(({row:i})=>[T(y(i.data.date),1)]),"cell-account":o(({row:i})=>[T(y(i.data.account),1)]),"cell-reference":o(({row:i})=>[i.data.reference_link?(k(),w(q,{key:0,to:{path:`${i.data.reference_link}`},class:"font-medium text-primary-500"},{default:o(()=>[T(y(i.data.reference),1)]),_:2},1032,["to"])):(k(),ut("span",gt,y(i.data.reference),1))]),"cell-debit":o(({row:i})=>[T(y(i.data.debit),1)]),"cell-credit":o(({row:i})=>[T(y(i.data.credit),1)]),_:2},[j()?{name:"cell-actions",fn:o(({row:i})=>[h(G,{row:i.data,table:v(s)},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"])],512),[[V,!r.value]])]),_:1})}}};export{St as default};
